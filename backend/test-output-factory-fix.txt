
  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\FullPaymentLifecycleActivationTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mduplicate webhook does not double credit[39m[90m                                                                    [39m [90m1.52s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfull payment lifecycle from subscription to bonus[39m[90m                                                           [39m [90m1.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlifecycle triggers progressive bonus at month 4[39m[90m                                                             [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfailed payment does not activate subscription[39m[90m                                                               [39m [90m0.81s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\CompleteUserJourneyTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal request to completion flow[39m[90m                                                                       [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mauto debit failure and retry flow[39m[90m                                                                           [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus complete flow[39m[90m                                                                               [39m [90m0.91s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcelebration bonus on birthday flow[39m[90m                                                                          [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mkyc submission to approval flow[39m[90m                                                                             [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mregistration to first payment flow[39m[90m                                                                          [39m [90m0.86s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreferral bonus complete flow[39m[90m                                                                                [39m [90m0.96s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription pause and resume flow[39m[90m                                                                          [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mkyc rejection and resubmission flow[39m[90m                                                                         [39m [90m0.99s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlucky draw entry to winner flow[39m[90m                                                                             [39m [90m0.88s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprofit share distribution flow[39m[90m                                                                              [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription cancellation flow[39m[90m                                                                              [39m [90m0.83s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\DailyDisputeSnapshotTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msnapshot platform wide scope works[39m[90m                                                                          [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90maggregate command skips existing without force[39m[90m                                                              [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msnapshot enforces unique date plan constraint[39m[90m                                                               [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msnapshot allows same date different plans[39m[90m                                                                   [39m [90m0.25s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msnapshot records correct severity counts[39m[90m                                                                    [39m [90m0.35s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90maggregate command creates per plan snapshots[39m[90m                                                                [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90maggregate command overwrites with force[39m[90m                                                                     [39m [90m0.28s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msnapshot records chargeback metrics[39m[90m                                                                         [39m [90m0.34s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msnapshot records blocked user count[39m[90m                                                                         [39m [90m0.41s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msnapshot date range scope works[39m[90m                                                                             [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msnapshot model calculates rupee amounts[39m[90m                                                                     [39m [90m0.26s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msnapshot records correct status counts[39m[90m                                                                      [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90maggregate command creates platform snapshot[39m[90m                                                                 [39m [90m0.33s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\UserSettingsControllerTest[39m
  [32;1mâœ“[39;22m[90m [39m[90muser can get default settings when none exist[39m[90m                                                               [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate merges with existing settings[39m[90m                                                                        [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can update security settings[39m[90m                                                                           [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can update preference settings[39m[90m                                                                         [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can get saved settings[39m[90m                                                                                 [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munauthenticated user cannot access settings[39m[90m                                                                 [39m [90m0.74s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msettings timestamps are updated[39m[90m                                                                             [39m [90m1.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can only update their own settings[39m[90m                                                                     [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can update notification settings[39m[90m                                                                       [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msettings are stored as valid json[39m[90m                                                                           [39m [90m0.75s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser cannot access another users settings[39m[90m                                                                   [39m [90m0.77s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\FullUserJourneyIntegrationTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mconcurrent wallet operations maintain integrity[39m[90m                                                             [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreferral multiplier affects bonus calculation[39m[90m                                                               [39m [90m0.85s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal flow with locked balance[39m[90m                                                                         [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus awarded at correct month[39m[90m                                                                    [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk bonus award to multiple users[39m[90m                                                                          [39m [90m0.90s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msettings update clears cache correctly[39m[90m                                                                      [39m [90m0.88s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin wallet adjustment flow[39m[90m                                                                                [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcomplete user registration to first bonus journey[39m[90m                                                           [39m [90m0.86s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\UserWithdrawalEndpointTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser can cancel pending withdrawal[39m[90m                                                                          [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal notification sent[39m[90m                                                                                [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser cannot withdraw more than balance[39m[90m                                                                      [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdrawal requires bank details[39m[90m                                                                            [39m [90m0.28s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser can view withdrawal history[39m[90m                                                                            [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal respects rate limiting[39m[90m                                                                           [39m [90m0.34s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser can request withdrawal[39m[90m                                                                                 [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdrawal respects minimum amount[39m[90m                                                                          [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal locks balance[39m[90m                                                                                    [39m [90m0.30s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\FinancialGuaranteesTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mledger debits equal credits[39m[90m                                                                                 [39m [90m0.95s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mno negative wallet balances exist[39m[90m                                                                           [39m [90m0.92s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msubscription revenue matches paid payments[39m[90m                                                                  [39m [90m1.04s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfull financial reconciliation passes[39m[90m                                                                        [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreceivables match outstanding chargebacks[39m[90m                                                                   [39m [90m1.01s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mno orphaned wallet transactions exist[39m[90m                                                                       [39m [90m0.94s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus payouts reconcile with wallet credits[39m[90m                                                                 [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwallet balances reconcile with transaction history[39m[90m                                                          [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwallet balances mirror liability ledger[39m[90m                                                                     [39m [90m0.86s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\LuckyDrawTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can execute draw[39m[90m                                                                                      [39m [90m0.32s[39m  

  [30;43;1m WARN [39;49;22m[39m Tests\Feature\WebhookValidationTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mmissing signature rejected[39m[90m                                                                                  [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90minvalid signature rejected[39m[90m                                                                                  [39m [90m0.75s[39m  
  [33;1m-[39;22m[90m [39m[90mwebhook retry handling[39m[90m [39m[33mâ†’ Covered by testWebhookIdempotency, as a retry is a duplicate event.[39m[90m                [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook idempotency[39m[90m                                                                                         [39m [90m0.91s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook without secret configured[39m[90m                                                                           [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mrazorpay webhook signature validation[39m[90m                                                                       [39m [90m0.81s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\BonusTdsIntegrationTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mwallet credits net amount after tds[39m[90m                                                                         [39m [90m0.92s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mledger contains gross and tds entries[39m[90m                                                                       [39m [90m0.84s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus calculations have no rounding drift[39m[90m                                                                   [39m [90m0.94s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtds not deducted for bonus below threshold[39m[90m                                                                  [39m [90m0.97s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus transaction creates balanced ledger entries[39m[90m                                                           [39m [90m0.91s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtds correctly deducted for bonus above threshold[39m[90m                                                            [39m [90m0.86s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtds exemption at exact threshold boundary[39m[90m                                                                   [39m [90m0.84s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\AutoDebitMultiCycleTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msuspended subscription not picked for auto debit[39m[90m                                                            [39m [90m0.87s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreminders sent exactly 3 days before[39m[90m                                                                        [39m [90m0.75s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mresume after suspension allows fresh retry cycle[39m[90m                                                            [39m [90m1.14s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mno duplicate payments created for same cycle[39m[90m                                                                [39m [90m1.17s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfull failure to suspension flow[39m[90m                                                                             [39m [90m1.14s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mno date drift over multiple billing cycles[39m[90m                                                                  [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtwelve month billing cycle completes without drift[39m[90m                                                          [39m [90m0.87s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mretry threshold enforced at 3 attempts[39m[90m                                                                      [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mno ghost retries without razorpay linkage[39m[90m                                                                   [39m [90m0.86s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\MaintenanceModeTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mmaintenance mode blocks all users[39m[90m                                                                           [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmaintenance mode shows custom message[39m[90m                                                                       [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmaintenance mode allows admins[39m[90m                                                                              [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmaintenance mode respects ip whitelist[39m[90m                                                                      [39m [90m0.79s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\SocialLoginReferralTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mgoogle redirect includes referral code in state[39m[90m                                                             [39m [90m0.30s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit prevents self referral[39m[90m                                                                                   [39m [90m2.04s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit handles invalid referral code gracefully[39m[90m                                                                 [39m [90m1.88s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit can process referral code during google login[39m[90m                                                            [39m [90m0.81s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\UserLuckyDrawEndpointsTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser can view own entries[39m[90m                                                                                   [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can view current draw[39m[90m                                                                                  [39m [90m0.27s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\EdgeCaseResilienceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msubscription cancel during retry stops retries[39m[90m                                                              [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrefund after bonus claws back correctly[39m[90m                                                                     [39m [90m0.92s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconcurrent payment and cancel resolves safely[39m[90m                                                               [39m [90m0.92s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment during pause handled correctly[39m[90m                                                                      [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrefund larger than payment rejected[39m[90m                                                                         [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment exceeding inventory handled gracefully[39m[90m                                                           [39m [90m0.92s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdouble webhook delivery is idempotent[39m[90m                                                                       [39m [90m0.93s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrapid fire webhooks processed safely[39m[90m                                                                        [39m [90m0.93s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback on already chargebacked payment rejected[39m[90m                                                         [39m [90m0.86s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mchargeback during plan upgrade maintains integrity[39m[90m                                                          [39m [90m0.91s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ReferralSystemTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mreferrer gets bonus and tier upgrade on referee payment[39m[90m                                                     [39m [90m0.93s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\SnapshotIntegrityTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus contract snapshot preserved through payments[39m[90m                                                          [39m [90m0.86s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mno floating point drift in calculations[39m[90m                                                                     [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreporting queries are consistent[39m[90m                                                                            [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mno negative liabilities in ledger[39m[90m                                                                           [39m [90m0.92s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwallet balances match transaction sums[39m[90m                                                                      [39m [90m0.90s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment sum matches revenue ledger[39m[90m                                                                          [39m [90m0.86s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msnapshot hash detects tampering[39m[90m                                                                             [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90maggregates match raw ledger sums[39m[90m                                                                            [39m [90m0.94s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment snapshots are immutable[39m[90m                                                                          [39m [90m0.90s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\ChargebackIntegrationTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mchargeback uses wallet service not direct mutation[39m[90m                                                          [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback ledger entry has correct accounts[39m[90m                                                                [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback succeeds when wallet has sufficient balance[39m[90m                                                      [39m [90m0.38s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet liability mirror partial receivable[39m[90m                                                                  [39m [90m0.45s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback creates receivable when wallet insufficient[39m[90m                                                      [39m [90m0.40s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpartial investment chargeback scenario[39m[90m                                                                      [39m [90m0.39s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback exceeding refundable amount is rejected[39m[90m                                                          [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mrefund after chargeback confirmed is rejected[39m[90m                                                               [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mrefund creates ledger entries and credits wallet[39m[90m                                                            [39m [90m0.35s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mfull investment chargeback creates full receivable[39m[90m                                                          [39m [90m0.36s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback replay same gateway id is idempotent[39m[90m                                                             [39m [90m0.35s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mledger balanced after chargeback[39m[90m                                                                            [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback state transitions are enforced[39m[90m                                                                   [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback confirmation replay is idempotent[39m[90m                                                                [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mduplicate webhook concurrency protection[39m[90m                                                                    [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mraw db ledger symmetry assertion[39m[90m                                                                            [39m [90m0.35s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mfull lifecycle deposit chargeback unwinds to zero[39m[90m                                                           [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback after full refund is rejected[39m[90m                                                                    [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback within refundable amount succeeds[39m[90m                                                                [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munique constraint on chargeback gateway id[39m[90m                                                                  [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet liability mirror without receivable[39m[90m                                                                  [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet liability mirror with receivable[39m[90m                                                                     [39m [90m0.38s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\FinalSanityTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mwallet integer integrity[39m[90m                                                                                    [39m [90m0.12s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ReferralTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mmultiplier increases to tier 2 at 5 referrals[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mmultiplier increases when referrals complete[39m

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\UserNotificationEndpointsTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mget notifications returns user notifications[39m[90m                                                                [39m [90m0.41s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmark all notifications as read[39m[90m                                                                              [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdelete notification[39m[90m                                                                                         [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmark notification as read[39m[90m                                                                                   [39m [90m0.33s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mnotifications paginated[39m[90m                                                                                     [39m [90m0.35s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\FinancialDriftTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mmath consistency across scenarios[39m[90m                                                                           [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\AdminWorkflowTest[39m
  [32;1mâœ“[39;22m[90m [39m[90madmin can suspend user[39m[90m                                                                                      [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can approve kyc[39m[90m                                                                                       [39m [90m0.85s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can approve and complete withdrawal[39m[90m                                                                   [39m [90m0.78s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\WebhookRetrySystemTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mexponential backoff is calculated correctly[39m[90m                                                                 [39m [90m0.08s[39m  
  [33;1m-[39;22m[90m [39m[90mwebhook log is created for incoming webhook[39m[90m [39m[33mâ†’ Requires webhook signature verification setup[39m[90m                 [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mretry job can be dispatched[39m[90m                                                                                 [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwebhook can be marked as failed and scheduled for retry[39m[90m                                                     [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook is marked as max retries reached after limit[39m[90m                                                        [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpending retries scope returns due webhooks[39m[90m                                                                  [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook can be marked as success[39m[90m                                                                            [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\RateLimitingTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mrate limit returns correct headers[39m[90m                                                                          [39m [90m0.13s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrate limit blocks after max attempts[39m[90m                                                                        [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrate limit allows within limit[39m[90m                                                                              [39m [90m0.06s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrate limit resets after time window[39m[90m                                                                         [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\PaymentRequestTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mvalidates amount positive[39m[90m                                                                                   [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates payment method enum[39m[90m                                                                               [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates user owns subscription[39m[90m                                                                            [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpasses with valid data[39m[90m                                                                                      [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates subscription exists[39m[90m                                                                               [39m [90m0.30s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\UserSupportEndpointsTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser can attach files to ticket[39m[90m                                                                             [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser receives notification on reply[39m[90m                                                                         [39m [90m0.87s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can view own tickets[39m[90m                                                                                   [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can reply to ticket[39m[90m                                                                                    [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser can rate ticket resolution[39m[90m                                                                             [39m [90m0.95s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser cannot view other users tickets[39m[90m                                                                        [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can create ticket[39m[90m                                                                                      [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can close ticket[39m[90m                                                                                       [39m [90m0.83s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\PaymentToBonusIntegrationTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus records created with correct metadata[39m[90m                                                                 [39m [90m1.00s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreferral multiplier applied to all bonuses[39m[90m                                                                  [39m [90m0.95s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment success triggers all bonus calculations[39m[90m                                                             [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus notifications generated[39m[90m                                                                               [39m [90m0.91s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment refund reverses bonuses[39m[90m                                                                             [39m [90m0.88s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlate payment skips consistency bonus[39m[90m                                                                        [39m [90m0.93s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbonuses correctly credited to wallet[39m[90m                                                                        [39m [90m0.86s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbonus calculation handles edge cases[39m[90m                                                                        [39m [90m0.82s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\WithdrawalRequestTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates sufficient balance[39m[90m                                                                                [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates amount positive[39m[90m                                                                                   [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates bank details present[39m[90m                                                                              [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates withdrawal limit per day[39m[90m                                                                          [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates amount minimum[39m[90m                                                                                    [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates kyc approved[39m[90m                                                                                      [39m [90m0.33s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\OtpTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mit rejects expired otp[39m[90m                                                                                      [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit verifies correct otp successfully[39m[90m                                                                        [39m [90m0.32s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit rejects incorrect otp[39m[90m                                                                                    [39m [90m0.29s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\PermissionMiddlewareTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mpermission checks granular permissions[39m[90m                                                                      [39m [90m1.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpermission allows authorized user[39m[90m                                                                           [39m [90m1.38s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpermission logs unauthorized attempts[39m[90m                                                                       [39m [90m1.24s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpermission blocks unauthorized user[39m[90m                                                                         [39m [90m1.30s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ProfitShareTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can calculate profit share[39m[90m                                                                            [39m [90m0.34s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can distribute profit share[39m[90m                                                                           [39m [90m0.32s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\KycSubmitRequestTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates document uploads[39m[90m                                                                                  [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates bank account format[39m[90m                                                                               [39m [90m0.06s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates aadhaar format[39m[90m                                                                                    [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates ifsc code format[39m[90m                                                                                  [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates pan format[39m[90m                                                                                        [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ProcessMonthlyLuckyDrawTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mexecutes draw and selects winners[39m[90m                                                                           [39m [90m0.77s[39m  
  [33;1m-[39;22m[90m [39m[90mallocates entries to active users[39m[90m [39m[33mâ†’ Allocation logic is correctly placed in GenerateLuckyDrawEntryJob, not[39m[90mâ€¦ [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcreates draw for current month[39m[90m                                                                              [39m [90m0.77s[39m  

  [30;43;1m WARN [39;49;22m[39m Tests\Feature\PaymentLifecycleTest[39m
  [33;1m-[39;22m[90m [39m[90mfull payment lifecycle succeeds[39m[90m [39m[33mâ†’ Skipping until production SIP lifecycle is implemented.[39m[90m                   [39m [90m0.79s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ProcessAutoDebitsTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mretries failed payments[39m[90m                                                                                     [39m [90m1.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msends reminder before due date[39m[90m                                                                              [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90midentifies subscriptions due for payment[39m[90m                                                                    [39m [90m0.76s[39m  
  [32;1mâœ“[39;22m[90m [39m[90minitiates payment for each subscription[39m[90m                                                                     [39m [90m0.81s[39m  
  [33;1m-[39;22m[90m [39m[90msuspends subscription after max failures[39m[90m [39m[33mâ†’ Suspension logic is in RetryAutoDebitJob, not the main command.[39m[90mâ€¦ [39m [90m0.78s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\AdminUserControllerTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can export users to csv[39m[90m                                                                               [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can bulk award bonus[39m[90m                                                                                  [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore creates associated records[39m[90m                                                                            [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munsuspend logs activity[39m[90m                                                                                     [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msuspend logs activity[39m[90m                                                                                       [39m [90m0.85s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can bulk activate users[39m[90m                                                                               [39m [90m0.85s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mforce payment logs activity[39m[90m                                                                                 [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mshow returns stats summary[39m[90m                                                                                  [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msuspend requires reason[39m[90m                                                                                     [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can debit user wallet[39m[90m                                                                                 [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munblock logs activity[39m[90m                                                                                       [39m [90m0.85s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can update user status[39m[90m                                                                                [39m [90m0.93s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mshow masks sensitive data[39m[90m                                                                                   [39m [90m0.85s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can search users by email[39m[90m                                                                             [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregular user cannot list users[39m[90m                                                                              [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate validates unique email on change[39m[90m                                                                     [39m [90m0.87s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can view user details[39m[90m                                                                                 [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mimport skips duplicate users[39m[90m                                                                                [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munauthenticated user cannot list users[39m[90m                                                                      [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore validates mobile format[39m[90m                                                                               [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can bulk suspend users[39m[90m                                                                                [39m [90m0.90s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mimport validates email format[39m[90m                                                                               [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can import users from csv[39m[90m                                                                             [39m [90m0.84s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore validates unique mobile[39m[90m                                                                               [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore validates unique email[39m[90m                                                                                [39m [90m0.85s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can list users[39m[90m                                                                                        [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can update user profile fields[39m[90m                                                                        [39m [90m0.84s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore validates unique username[39m[90m                                                                             [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can create user[39m[90m                                                                                       [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate validates status enum[39m[90m                                                                                [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdebit fails for insufficient balance[39m[90m                                                                        [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mimport validates csv headers[39m[90m                                                                                [39m [90m0.84s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mimport validates mobile format[39m[90m                                                                              [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbulk bonus validates amount[39m[90m                                                                                 [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mblock logs activity with reason[39m[90m                                                                             [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mshow returns controlled response[39m[90m                                                                            [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can credit user wallet[39m[90m                                                                                [39m [90m0.88s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can suspend user with reason[39m[90m                                                                          [39m [90m0.88s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can search users by username[39m[90m                                                                          [39m [90m0.84s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\BlockedUserInvestmentTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90munblocked user can receive allocation again[39m[90m                                                                 [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mno partial allocation on blocked user[39m[90m                                                                       [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can view blocked users list[39m[90m                                                                           [39m [90m0.32s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mblocked user cannot receive share allocation[39m[90m                                                                [39m [90m0.28s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mblocked user allocation does not mutate inventory[39m[90m                                                           [39m [90m0.25s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mguard detects recently blocked user[39m[90m                                                                         [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mblocked user cannot receive legacy allocation[39m[90m                                                               [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mnon blocked user can receive allocation[39m[90m                                                                     [39m [90m0.36s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\AuthTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mlogout revokes token[39m[90m                                                                                        [39m [90m0.86s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregister creates user with hashed password[39m[90m                                                                  [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregister validates referral code if provided[39m[90m                                                                [39m [90m0.98s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregister creates wallet for new user[39m[90m                                                                        [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregister generates unique referral code[39m[90m                                                                     [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregister creates profile for new user[39m[90m                                                                       [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlogin rejects suspended account[39m[90m                                                                             [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlogin updates last login timestamp[39m[90m                                                                          [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mregister sends otp email and sms[39m[90m                                                                            [39m [90m0.74s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlogin generates jwt token[39m[90m                                                                                   [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlogin validates credentials[39m[90m                                                                                 [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mregister rejects invalid referral code[39m[90m                                                                      [39m [90m0.78s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlogin rejects blocked account[39m[90m                                                                               [39m [90m0.81s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ProcessCelebrationBonusesTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90midentifies birthdays today and awards bonus[39m[90m                                                                 [39m [90m0.93s[39m  
  [32;1mâœ“[39;22m[90m [39m[90midentifies subscription anniversaries[39m[90m                                                                       [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mawards anniversary bonus[39m[90m                                                                                    [39m [90m1.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mawards birthday bonus[39m[90m                                                                                       [39m [90m0.84s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\ExampleTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mthe application returns a successful response[39m[90m                                                               [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\AdminDashboardEndpointsTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mdashboard requires admin auth[39m[90m                                                                               [39m [90m0.21s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdashboard responds under500ms[39m[90m                                                                               [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mget dashboard stats returns correct metrics[39m[90m                                                                 [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdashboard shows pending withdrawals[39m[90m                                                                         [39m [90m0.17s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdashboard shows total users[39m[90m                                                                                 [39m [90m0.20s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdashboard shows pending kycs[39m[90m                                                                                [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdashboard handles concurrent access[39m[90m                                                                         [39m [90m0.14s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdashboard charts load correctly[39m[90m                                                                             [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdashboard shows recent activity[39m[90m                                                                             [39m [90m0.15s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdashboard shows total revenue[39m[90m                                                                               [39m [90m0.16s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\RegisterRequestTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mvalidates mobile 10 digits[39m[90m                                                                                  [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates password complexity[39m[90m                                                                               [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mvalidates email format[39m[90m                                                                                      [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates referral code if provided[39m[90m                                                                         [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidates username format[39m[90m                                                                                   [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\ServiceIntegrationTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mfile upload service validates file types[39m[90m                                                                    [39m [90m0.86s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msettings service invalidates cache on update[39m[90m                                                                [39m [90m0.87s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mfile upload service encrypts sensitive files[39m[90m                                                                [39m [90m0.88s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mfile upload service scans for viruses[39m[90m                                                                       [39m [90m0.88s[39m  
  [32;1mâœ“[39;22m[90m [39m[90memail service queues for async delivery[39m[90m                                                                     [39m [90m0.85s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment webhook service triggers bonus and allocation[39m[90m                                                       [39m [90m0.89s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription service calculates upgrade differential[39m[90m                                                        [39m [90m0.80s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\ChargebackInvariantsTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mconcurrent chargeback processing is safe[39m[90m                                                                    [39m [90m0.36s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback confirmed event not dispatched for orphan payment[39m[90m                                                [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser risk score updates on chargeback confirmation[39m[90m                                                          [39m [90m0.36s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mno negative wallet balance after chargeback[39m[90m                                                                 [39m [90m0.35s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback confirmed event is dispatched on confirmation[39m[90m                                                    [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback confirmation is terminal state[39m[90m                                                                   [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchargeback creates balanced ledger entries[39m[90m                                                                  [39m [90m0.42s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mduplicate chargeback confirmation is idempotent[39m[90m                                                             [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser auto blocked when score exceeds threshold[39m[90m                                                              [39m [90m0.37s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\SubscriptionLifecycleTest[39m
  [32;1mâœ“[39;22m[90m [39m[90muser can upgrade plan[39m[90m                                                                                       [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can cancel subscription[39m[90m                                                                                [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can pause subscription[39m[90m                                                                                 [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can subscribe successfully[39m[90m                                                                             [39m [90m0.79s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ReferralCampaignControllerTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mupdate validates date consistency[39m[90m                                                                           [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mstore enforces maximum multiplier cap[39m[90m                                                                       [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcampaign multiplier precision is respected[39m[90m                                                                  [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can update referral campaign[39m[90m                                                                          [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore allows multiplier at maximum cap[39m[90m                                                                      [39m [90m0.76s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can list referral campaigns[39m[90m                                                                           [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdelete returns 404 for nonexistent campaign[39m[90m                                                                 [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can delete referral campaign[39m[90m                                                                          [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate allows partial updates[39m[90m                                                                               [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can create referral campaign[39m[90m                                                                          [39m [90m0.76s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mstore allows bonus at maximum cap[39m[90m                                                                           [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90madmin can toggle campaign active status[39m[90m                                                                     [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregular user cannot list campaigns[39m[90m                                                                          [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mstore validates minimum multiplier[39m[90m                                                                          [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcannot create campaign with unreasonable multiplier[39m[90m                                                         [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mstore validates end date after start date[39m[90m                                                                   [39m [90m0.74s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate enforces multiplier cap[39m[90m                                                                              [39m [90m0.81s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate enforces bonus cap[39m[90m                                                                                   [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mstore validates required fields[39m[90m                                                                             [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcampaigns are returned in latest order[39m[90m                                                                      [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mstore enforces maximum bonus amount cap[39m[90m                                                                     [39m [90m0.77s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mstore validates non negative bonus[39m[90m                                                                          [39m [90m0.86s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mregular user cannot delete campaign[39m[90m                                                                         [39m [90m0.80s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\GenerateSitemapTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mincludes all public pages[39m[90m                                                                                   [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mgenerates sitemap xml[39m[90m                                                                                       [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mincludes dynamic routes[39m[90m                                                                                     [39m [90m0.35s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\UserProfileEndpointsTest[39m
  [32;1mâœ“[39;22m[90m [39m[90muser cannot access another users profile data[39m[90m                                                               [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupload avatar succeeds[39m[90m                                                                                      [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mupdate bank details validates ifsc format[39m[90m                                                                   [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupdate profile with valid data[39m[90m                                                                              [39m [90m0.78s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munauthorized access to profile fails[39m[90m                                                                        [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mget bank details returns user data[39m[90m                                                                          [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser cannot edit another users profile[39m[90m                                                                      [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget profile returns user data[39m[90m                                                                               [39m [90m0.76s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchange password with valid data[39m[90m                                                                             [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mchange password requires old password[39m[90m                                                                       [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mprofile includes kyc status[39m[90m                                                                                 [39m [90m0.76s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mprofile update validation[39m[90m                                                                                   [39m [90m0.91s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mupdate bank details with valid data[39m[90m                                                                         [39m [90m0.85s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mupdate bank details validates account number length[39m[90m                                                         [39m [90m0.78s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\Models\CompanyDisclosureTierImmutabilityTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minitial tier assignment on creation is allowed[39m[90m                                                              [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfill and save modification is blocked[39m[90m                                                                       [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdirect save modification is blocked[39m[90m                                                                         [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mother fields can be modified[39m[90m                                                                                [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mset attribute modification is blocked[39m[90m                                                                       [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mupdate modification is blocked[39m[90m                                                                              [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdisclosure tier not in fillable[39m[90m                                                                             [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmodification blocked in larger update[39m[90m                                                                       [39m [90m0.07s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mexception contains correct context[39m[90m                                                                          [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\Models\DisclosureTierVisibilityScopeTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mproduct by company disclosure tier scope[39m[90m                                                                    [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany pending review scope[39m[90m                                                                                [39m [90m0.06s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany is publicly visible by tier helper[39m[90m                                                                  [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany at or above tier scope[39m[90m                                                                              [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcompany investable scope[39m[90m                                                                                    [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mproduct is publicly visible by company tier helper[39m[90m                                                          [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany get disclosure tier info helper[39m[90m                                                                     [39m [90m0.07s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90minvariant no public visibility below tier 2[39m[90m                                                                 [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mproduct get visibility status helper[39m[90m                                                                        [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mproduct from companies at or above tier scope[39m[90m                                                               [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany specific tier scopes[39m[90m                                                                                [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mproduct publicly visible scope[39m[90m                                                                              [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany by disclosure tier scope[39m[90m                                                                            [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany publicly visible scope[39m[90m                                                                              [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90minvariant product visibility matches company visibility[39m[90m                                                     [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\KycTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can reject kyc with reason[39m[90m                                                                            [39m [90m0.35s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can approve kyc[39m[90m                                                                                       [39m [90m0.34s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser can upload kyc documents[39m[90m                                                                               [39m [90m0.29s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\Services\CompanyDisclosureTierServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mpromote to next tier convenience method[39m[90m                                                                     [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpromote tier 0 to tier 1 succeeds[39m[90m                                                                           [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mvalidation requirements for tier 2[39m[90m                                                                          [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mclosure direct mutation throws[39m[90m                                                                              [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mis publicly visible returns correct values[39m[90m                                                                  [39m [90m0.18s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpromotion to same tier is rejected[39m[90m                                                                          [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mclosure promotion succeeds through service[39m[90m                                                                  [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtier skip is rejected[39m[90m                                                                                       [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mclosure public queries exclude non public tiers[39m[90m                                                             [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpromote tier 2 to tier 3 succeeds[39m[90m                                                                           [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mget current tier returns correct enum[39m[90m                                                                       [39m [90m0.07s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdowngrade is rejected[39m[90m                                                                                       [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpromote to next tier fails at maximum[39m[90m                                                                       [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpromote tier 1 to tier 2 succeeds[39m[90m                                                                           [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\PaymentWebhookServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mhandle payment captured triggers allocation[39m[90m                                                                 [39m [90m0.44s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription charged accepts matching amount[39m[90m                                                                [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription charged rejects mismatched amount[39m[90m                                                              [39m [90m0.25s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook handles duplicate events[39m[90m                                                                            [39m [90m0.39s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mhandle payment captured updates payment status[39m[90m                                                              [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook rejects invalid signature[39m[90m                                                                           [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription charged accepts amount with decimal precision[39m[90m                                                  [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mhandle refund processed updates records[39m[90m                                                                     [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription charged mismatch logs critical[39m[90m                                                                 [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook logs all events[39m[90m                                                                                     [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription charged mismatch does not create payment[39m[90m                                                       [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpending subscription activates on first payment success[39m[90m                                                     [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription charged mismatch does not mutate subscription[39m[90m                                                  [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment amount mismatch exception contains correct data[39m[90m                                                     [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mhandle payment failed updates status[39m[90m                                                                        [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mhandle payment failed sends notification[39m[90m                                                                    [39m [90m0.30s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Feature\ThemeSeoControllerTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muploading new logo deletes old one[39m[90m                                                                          [39m [90m0.86s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mseo validates meta title suffix max length[39m[90m                                                                  [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtheme rejects invalid hex format[39m[90m                                                                            [39m [90m0.85s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mseo update clears settings cache[39m[90m                                                                            [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mseo validates google analytics id format[39m[90m                                                                    [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtheme accepts valid hex colors[39m[90m                                                                              [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlogo validates file type[39m[90m                                                                                    [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can set google analytics ua id[39m[90m                                                                        [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mregular user cannot update theme[39m[90m                                                                            [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can update meta title suffix[39m[90m                                                                          [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mseo accepts valid google analytics ids[39m[90m                                                                      [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can update secondary color[39m[90m                                                                            [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfavicon validates max file size[39m[90m                                                                             [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can update font family[39m[90m                                                                                [39m [90m0.93s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtheme validates hex color format[39m[90m                                                                            [39m [90m0.85s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfavicon validates file type[39m[90m                                                                                 [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mseo validates robots txt max length[39m[90m                                                                         [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90munauthenticated user cannot update theme[39m[90m                                                                    [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlogo accepts valid image types[39m[90m                                                                              [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can upload favicon[39m[90m                                                                                    [39m [90m0.77s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlogo validates max file size[39m[90m                                                                                [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can set google analytics ga4 id[39m[90m                                                                       [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtheme update clears settings cache[39m[90m                                                                          [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can update robots txt[39m[90m                                                                                 [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can update multiple theme settings[39m[90m                                                                    [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can upload logo[39m[90m                                                                                       [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtheme validates font family max length[39m[90m                                                                      [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mregular user cannot update seo[39m[90m                                                                              [39m [90m0.87s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90madmin can update primary color[39m[90m                                                                              [39m [90m0.82s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Feature\SubscriptionTest[39m
  [32;1mâœ“[39;22m[90m [39m[90muser can pause subscription[39m[90m                                                                                 [39m [90m0.87s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can upgrade plan[39m[90m                                                                                       [39m [90m0.80s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can create subscription[39m[90m                                                                                [39m [90m0.76s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can cancel subscription[39m[90m                                                                                [39m [90m0.76s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\ReferralTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mreferral scope active filters correctly[39m[90m                                                                     [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral belongs to referred user[39m[90m                                                                           [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral status enum validates[39m[90m                                                                              [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral calculates bonus eligible[39m[90m                                                                          [39m [90m0.14s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral validates unique referral[39m[90m                                                                          [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral tracks activation date[39m[90m                                                                             [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral belongs to referrer[39m[90m                                                                                [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral validates referrer not self[39m[90m                                                                        [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\AutoDebitServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90minitiate payment creates pending payment[39m[90m                                                                    [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90midentify due payments filters correctly[39m[90m                                                                     [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msuspend subscription after max failures[39m[90m                                                                     [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mretry failed payment respects max attempts[39m[90m                                                                  [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend reminder notification triggers at correct time[39m[90m                                                         [39m [90m0.25s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\DisputeStatsCacheTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mget chargeback stats returns expected structure[39m[90m                                                             [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget risk distribution returns expected structure[39m[90m                                                            [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mget overview counts disputes correctly[39m[90m                                                                      [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget overview returns expected structure[39m[90m                                                                     [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget overview caches results[39m[90m                                                                                 [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwarm cache populates all caches[39m[90m                                                                             [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget risk distribution categorizes users correctly[39m[90m                                                           [39m [90m0.31s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mclear cache removes all stats[39m[90m                                                                               [39m [90m0.44s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget all stats returns complete data[39m[90m                                                                         [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mget overview force refresh bypasses cache[39m[90m                                                                   [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget chargeback stats counts correctly[39m[90m                                                                       [39m [90m0.34s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\SmsServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend sms respects user preferences[39m[90m                                                                          [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msend sms handles msg91 failure[39m[90m                                                                              [39m [90m0.30s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msend sms logs delivery[39m[90m                                                                                      [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msend sms uses correct template id[39m[90m                                                                           [39m [90m0.28s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msend sms limits to 160 chars[39m[90m                                                                                [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend sms replaces variables[39m[90m                                                                                 [39m [90m0.29s[39m  

  [30;43;1m DEPR [39;49;22m[39m Tests\Unit\UserDataSecurityTest[39m
  [33;1m![39;22m[90m [39m[90munauthorized access to other user data fails[39m[90m [39m[33mâ†’ Creation of dynamic property Tests\Unit\UserDataSecurityTest[39m[90mâ€¦[39m [90m0.17s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\RateLimitingTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mrate limiting prevents abuse[39m

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\DealTierGateTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal update to featured blocked for tier 2[39m[90m                                                                  [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mnon featured deal at tier 2 can be saved[39m[90m                                                                    [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdraft deal at tier 1 can be saved[39m[90m                                                                           [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeal activation blocked for tier 0 pending[39m[90m                                                                  [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtier gate exception has context[39m[90m                                                                             [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeal featuring blocked for tier 1 upcoming[39m[90m                                                                  [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal creation allowed for tier 3 featured[39m[90m                                                                   [39m [90m0.14s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal creation allowed for tier 2 live[39m[90m                                                                       [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal activation allowed for tier 2 live[39m[90m                                                                     [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal featuring allowed for tier 3 featured[39m[90m                                                                  [39m [90m0.13s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal status update to active blocked for tier 1[39m[90m                                                             [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal activation blocked for tier 1 upcoming[39m[90m                                                                 [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mactivation exception shows correct operation[39m[90m                                                                [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeal featuring blocked for tier 2 live[39m[90m                                                                      [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeal creation blocked for tier 0 pending[39m[90m                                                                    [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfeaturing exception shows correct operation[39m[90m                                                                 [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal activation allowed for tier 3 featured[39m[90m                                                                 [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeal creation allowed for tier 1 upcoming[39m[90m                                                                   [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\TransactionTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mtransaction tracks before balance[39m[90m                                                                           [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction status enum validates[39m[90m                                                                           [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction scope pending filters correctly[39m[90m                                                                 [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction has unique transaction id[39m[90m                                                                       [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction tracks after balance[39m[90m                                                                            [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction scope completed filters correctly[39m[90m                                                               [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction belongs to wallet[39m[90m                                                                               [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mtransaction type enum validates[39m[90m                                                                             [39m [90m0.32s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\LuckyDrawServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend winner notifications[39m[90m                                                                                   [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mallocate bonus entries for streaks[39m[90m                                                                          [39m [90m0.79s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcreate monthly draw sets correct date[39m[90m                                                                       [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdistribute prizes to wallets[39m[90m                                                                                [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mallocate entries based on plan[39m[90m                                                                              [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mselect winners uses weighted random[39m[90m                                                                         [39m [90m0.88s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\EmailServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email uses correct template[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email replaces variables[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email queues for async delivery[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mbatch email sends in chunks[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email logs delivery[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email validates recipient[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email respects user preferences[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msend email handles sendgrid failure[39m

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\WithdrawalServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mapprove withdrawal initiates bank transfer event[39m[90m                                                            [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrequest withdrawal validates kyc approved[39m[90m                                                                   [39m [90m0.35s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mrequest withdrawal validates minimum amount[39m[90m                                                                 [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcomplete withdrawal updates wallet balance[39m[90m                                                                  [39m [90m0.27s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\PlanConfigTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mconfig belongs to plan[39m[90m                                                                                      [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mconfig value is json cast[39m[90m                                                                                   [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mconfig key is unique per plan[39m[90m                                                                               [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mconfig can be updated[39m[90m                                                                                       [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mconsistency config structure validates[39m[90m                                                                      [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral config structure validates[39m[90m                                                                         [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmilestone config structure validates[39m[90m                                                                        [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mprogressive config structure validates[39m[90m                                                                      [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\SqlInjectionTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90msql injection prevention works[39m[90m                                                                              [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\UserProfitShareTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser share validates amount positive[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser share tracks credited to wallet[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser share belongs to profit share[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser share belongs to user[39m

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\SubscriptionTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msubscription belongs to user[39m[90m                                                                                [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription calculates total paid[39m[90m                                                                          [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription status enum validates[39m[90m                                                                          [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription calculates months completed[39m[90m                                                                    [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription has payments relationship[39m[90m                                                                      [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription validates pause limit[39m[90m                                                                          [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription can be resumed[39m[90m                                                                                 [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription calculates next payment date[39m[90m                                                                   [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription tracks consecutive payments[39m[90m                                                                    [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription belongs to plan[39m[90m                                                                                [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription can be cancelled[39m[90m                                                                               [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msubscription can be paused[39m[90m                                                                                  [39m [90m0.20s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\LuckyDrawTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mlucky draw calculates total entries[39m[90m                                                                         [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlucky draw cannot be executed twice[39m[90m                                                                         [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlucky draw can be executed[39m[90m                                                                                  [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlucky draw tracks execution date[39m[90m                                                                            [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlucky draw status enum validates[39m[90m                                                                            [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlucky draw has entries relationship[39m[90m                                                                         [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlucky draw soft deletes correctly[39m[90m                                                                           [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlucky draw validates prize pool positive[39m[90m                                                                    [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\ReportServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser retention report calculates churn[39m[90m                                                                      [39m [90m0.39s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfinancial summary calculates profit[39m[90m                                                                         [39m [90m0.38s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mkyc completion report calculates percentage[39m[90m                                                                 [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtds exemption for amounts below 10k[39m[90m                                                                         [39m [90m0.32s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser growth report calculates correctly[39m[90m                                                                     [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtds calculation applies 10 percent[39m[90m                                                                          [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90maml report flags suspicious transactions[39m[90m                                                                    [39m [90m0.37s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\Enums\DisclosureTierTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mminimum public tier is tier 2 live[39m[90m                                                                          [39m [90m0.01s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcan promote to allows only one tier advancement[39m
  [32;1mâœ“[39;22m[90m [39m[90mpublic visibility invariant[39m
  [32;1mâœ“[39;22m[90m [39m[90minvestability matches visibility[39m
  [32;1mâœ“[39;22m[90m [39m[90moptions returns structured array for forms[39m
  [32;1mâœ“[39;22m[90m [39m[90mvalues returns all tier strings[39m
  [32;1mâœ“[39;22m[90m [39m[90mpublicly visible tiers returns correct tiers[39m
  [32;1mâœ“[39;22m[90m [39m[90mmaximum tier cannot be promoted[39m
  [32;1mâœ“[39;22m[90m [39m[90mnext tier progression[39m
  [32;1mâœ“[39;22m[90m [39m[90mtier values are correct strings[39m
  [32;1mâœ“[39;22m[90m [39m[90mtier ranking is monotonic[39m
  [32;1mâœ“[39;22m[90m [39m[90mtier labels are human readable[39m

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\SupportMessageTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mmessage belongs to ticket[39m[90m                                                                                   [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmessage belongs to sender[39m[90m                                                                                   [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmessage tracks is admin reply[39m[90m                                                                               [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\BonusCalculatorConsistencyTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus not awarded for late payment[39m[90m                                                              [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus streak resets on late payment[39m[90m                                                             [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus amount varies by plan[39m[90m                                                                     [39m [90m0.78s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus respects global toggle[39m[90m                                                                    [39m [90m0.78s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus multiplies for streak[39m[90m                                                                     [39m [90m0.79s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus awarded for on time payment[39m[90m                                                               [39m [90m0.83s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus respects grace period[39m[90m                                                                     [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconsistency bonus uses configured amounts[39m[90m                                                                   [39m [90m0.76s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\PaymentTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mpayment method enum validates[39m[90m                                                                               [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment scope paid returns correct records[39m[90m                                                                  [39m [90m0.19s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment tracks razorpay order id[39m[90m                                                                            [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment belongs to subscription[39m[90m                                                                             [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment belongs to user[39m[90m                                                                                     [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpayment status enum validates[39m[90m                                                                               [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment scope failed returns correct records[39m[90m                                                                [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment calculates due date[39m[90m                                                                                 [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment tracks razorpay payment id[39m[90m                                                                          [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment marks as on time correctly[39m[90m                                                                          [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment scope pending returns correct records[39m[90m                                                               [39m [90m0.18s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpayment tracks signature[39m[90m                                                                                    [39m [90m0.10s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\WithdrawalTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal calculates net amount[39m[90m                                                                            [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdrawal status enum validates[39m[90m                                                                            [39m [90m0.15s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal validates amount positive[39m[90m                                                                        [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdrawal belongs to user[39m[90m                                                                                  [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal calculates fee[39m[90m                                                                                   [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdrawal belongs to wallet[39m[90m                                                                                [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdrawal tracks processed by admin[39m[90m                                                                        [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdrawal validates sufficient balance[39m[90m                                                                     [39m [90m0.11s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\FeatureFlagTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mfeature flag validates identifier unique[39m[90m                                                                    [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfeature flag checks if enabled[39m[90m                                                                              [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpercentage flag is off for guests[39m[90m                                                                           [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mpercentage flag is off if globally disabled[39m[90m                                                                 [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mfeature flag tracks enabled for percentage[39m[90m                                                                  [39m [90m0.11s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\PlanTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mplan slug is unique[39m[90m                                                                                         [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan calculates total investment[39m[90m                                                                            [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan validates monthly amount positive[39m[90m                                                                      [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan has features relationship[39m[90m                                                                              [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan soft deletes correctly[39m[90m                                                                                 [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan has subscriptions relationship[39m[90m                                                                         [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan gets config value by key[39m[90m                                                                               [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan validates duration positive[39m[90m                                                                            [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mplan scope active returns only active[39m[90m                                                                       [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan has configs relationship[39m[90m                                                                               [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan returns default if config missing[39m[90m                                                                      [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mplan can be archived[39m[90m                                                                                        [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\ActivityLogTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mlog belongs to user[39m[90m                                                                                         [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlog tracks ip address[39m[90m                                                                                       [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlog tracks user agent[39m[90m                                                                                       [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlog filters by date range[39m[90m                                                                                   [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlog tracks action type[39m[90m                                                                                      [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mlog stores old and new values[39m[90m                                                                               [39m [90m0.10s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\ProfitShareServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mdistribute to wallets credits correctly[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mcalculate distribution applies plan percentage[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mcalculate profit uses correct formula[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mreversal debits wallets correctly[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mcalculate distribution checks eligibility[39m

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\UserKycTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90maadhaar number format validates[39m[90m                                                                             [39m [90m0.06s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc has documents relationship[39m[90m                                                                              [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpan number format validates[39m[90m                                                                                 [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mverification status enum validates[39m[90m                                                                          [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc belongs to user[39m[90m                                                                                         [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc can be approved[39m[90m                                                                                         [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc can be rejected with reason[39m[90m                                                                             [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc marks as complete when all docs present[39m[90m                                                                 [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc calculates completion percentage[39m[90m                                                                        [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mkyc checks all documents uploaded[39m[90m                                                                           [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\VerificationServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify pan handles api failure[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify pan calls income tax api[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverification logs all attempts[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify pan caches successful result[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify aadhaar handles api failure[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify pan validates dob match[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify pan validates name match[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify aadhaar validates name match[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify bank account validates ifsc code[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mverify aadhaar calls digilocker api[39m

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\SettingHelperTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mhelper caches frequently accessed settings[39m[90m                                                                  [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting type enum validates[39m[90m                                                                                 [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting key is unique[39m[90m                                                                                       [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting value casts by type[39m[90m                                                                                 [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting retrieves by key[39m[90m                                                                                    [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting returns default if not found[39m[90m                                                                        [39m [90m0.34s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mhelper invalidates cache on update[39m[90m                                                                          [39m [90m0.30s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msetting tracks updated by admin[39m[90m                                                                             [39m [90m0.31s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\RiskScoringServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mshould block returns true above threshold[39m[90m                                                                   [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score includes open disputes[39m[90m                                                                      [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score applies repeat weight for multiple chargebacks[39m[90m                                              [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score is deterministic[39m[90m                                                                            [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score excludes new account factor for established users[39m[90m                                           [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score returns zero for clean user[39m[90m                                                                 [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score weights critical disputes higher[39m[90m                                                            [39m [90m0.36s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score includes new account factor[39m[90m                                                                 [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mshould block returns false below threshold[39m[90m                                                                  [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score caps at 100[39m[90m                                                                                 [39m [90m0.39s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget risk summary returns complete data[39m[90m                                                                      [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget risk category returns correct category[39m[90m                                                                  [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mis high risk returns correct values[39m[90m                                                                         [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget chargeback history returns only confirmed chargebacks[39m[90m                                                   [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcalculate score includes chargeback base weight[39m[90m                                                             [39m [90m0.31s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\ReferralCampaignTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mcampaign validates bonus amount positive[39m[90m                                                                    [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcampaign validates date range[39m[90m                                                                               [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcampaign checks if active[39m[90m                                                                                   [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcampaign tracks total referrals[39m[90m                                                                             [39m [90m0.13s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\InventoryServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mcheck available inventory calculates correctly[39m[90m                                                              [39m [90m0.14s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreorder suggestion based on allocation rate[39m[90m                                                                 [39m [90m0.32s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlow stock alert triggers at 10 percent[39m[90m                                                                      [39m [90m0.12s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\BonusCalculatorMilestoneTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus only awarded once per milestone[39m[90m                                                             [39m [90m0.89s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus respects global toggle[39m[90m                                                                      [39m [90m0.91s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus awarded at month 24[39m[90m                                                                         [39m [90m0.94s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus amount varies by plan[39m[90m                                                                       [39m [90m0.91s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus not awarded if non consecutive[39m[90m                                                              [39m [90m0.93s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus supports custom milestones[39m[90m                                                                  [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus awarded at month 36[39m[90m                                                                         [39m [90m1.03s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus applies referral multiplier[39m[90m                                                                 [39m [90m0.84s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus uses configured amounts[39m[90m                                                                     [39m [90m0.93s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmilestone bonus awarded at month 12[39m[90m                                                                         [39m [90m0.92s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\SettingTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msetting key is unique[39m[90m                                                                                       [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting retrieves by key[39m[90m                                                                                    [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msetting tracks updated by admin[39m[90m                                                                             [39m [90m0.36s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting returns default if not found[39m[90m                                                                        [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting value casts by type[39m[90m                                                                                 [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting json type decodes correctly[39m[90m                                                                         [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting type enum validates[39m[90m                                                                                 [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msetting boolean type converts correctly[39m[90m                                                                     [39m [90m0.29s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\BonusCalculatorProgressiveTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus formula evaluation works[39m[90m                                                                  [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus respects configured rate[39m[90m                                                                  [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus increases linearly each month[39m[90m                                                             [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus respects global toggle[39m[90m                                                                    [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus calculates correctly at month 4[39m[90m                                                           [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus uses month override if configured[39m[90m                                                         [39m [90m0.81s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus applies referral multiplier[39m[90m                                                               [39m [90m0.80s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus caps at maximum percentage[39m[90m                                                                [39m [90m1.45s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus uses payment amount as base[39m[90m                                                               [39m [90m0.84s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprogressive bonus not awarded before start month[39m[90m                                                            [39m [90m0.80s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\RazorpayServiceTest[39m
  [33;1m![39;22m[90m [39m[90mfetch payment details calls api[39m[90m [39m[33mâ†’ This test did not perform any assertions[39m[90m                                  [39m [90m0.07s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcreate order sets correct amount[39m[90m                                                                            [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcreate order calls razorpay api[39m[90m                                                                             [39m [90m0.07s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcapture payment validates amount[39m[90m                                                                            [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwebhook signature validates correctly[39m[90m                                                                       [39m [90m0.11s[39m  
  [33;1m![39;22m[90m [39m[90mcapture payment calls razorpay api[39m[90m [39m[33mâ†’ This test did not perform any assertions[39m[90m                               [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mverify signature validates correct signature[39m[90m                                                                [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcreate order sets currency inr[39m[90m                                                                              [39m [90m0.09s[39m  
  [33;1m![39;22m[90m [39m[90mrefund payment handles partial refund[39m[90m [39m[33mâ†’ This test did not perform any assertions[39m[90m                            [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mservice uses correct environment keys[39m[90m                                                                       [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcreate order handles api failure[39m[90m                                                                            [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mservice logs all api calls[39m[90m                                                                                  [39m [90m0.06s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcreate order includes receipt[39m[90m                                                                               [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mverify signature rejects invalid signature[39m[90m                                                                  [39m [90m0.11s[39m  
  [33;1m![39;22m[90m [39m[90mrefund payment calls razorpay api[39m[90m [39m[33mâ†’ This test did not perform any assertions[39m[90m                                [39m [90m0.08s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\ProductTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mproduct has investments relationship[39m[90m                                                                        [39m [90m0.18s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct calculates total allocated[39m[90m                                                                          [39m [90m0.24s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct has bulk purchases relationship[39m[90m                                                                     [39m [90m0.14s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct soft deletes correctly[39m[90m                                                                              [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct slug is unique[39m[90m                                                                                      [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct has price history relationship[39m[90m                                                                      [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct validates face value positive[39m[90m                                                                       [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mproduct status enum validates[39m[90m                                                                               [39m [90m0.09s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\PerformanceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mconcurrent payment processing[39m[90m                                                                               [39m [90m0.01s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\UserTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90muser has profile relationship[39m[90m                                                                               [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser referral code is unique[39m[90m                                                                                [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser has subscriptions relationship[39m[90m                                                                         [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser has referrals relationship[39m[90m                                                                             [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser soft deletes correctly[39m[90m                                                                                 [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser password is hashed on creation[39m[90m                                                                         [39m [90m0.27s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser has wallet relationship[39m[90m                                                                                [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser mobile must be unique[39m[90m                                                                                  [39m [90m0.25s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90muser has kyc relationship[39m[90m                                                                                   [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser email must be unique[39m[90m                                                                                   [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser can be created with valid data[39m[90m                                                                         [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90muser referral code is generated automatically[39m[90m                                                               [39m [90m0.24s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\WalletTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mwallet calculates available balance[39m[90m                                                                         [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet tracks total deposited[39m[90m                                                                               [39m [90m0.17s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet withdraw decreases balance[39m[90m                                                                           [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet deposit increases balance[39m[90m                                                                            [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet balance paise stores integer[39m[90m                                                                         [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet balance paise never negative[39m[90m                                                                         [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet tracks total withdrawn[39m[90m                                                                               [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet belongs to user[39m[90m                                                                                      [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet withdraw validates sufficient balance[39m[90m                                                                [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwallet has transactions relationship[39m[90m                                                                        [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\BonusCalculatorCelebrationTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mfestival bonus awarded for configured events[39m[90m                                                                [39m [90m0.94s[39m  
  [32;1mâœ“[39;22m[90m [39m[90manniversary bonus amount varies by year[39m[90m                                                                     [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbirthday bonus amount varies by plan[39m[90m                                                                        [39m [90m0.84s[39m  
  [32;1mâœ“[39;22m[90m [39m[90manniversary bonus awarded on subscription anniversary[39m[90m                                                       [39m [90m0.82s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbirthday bonus awarded on user birthday[39m[90m                                                                     [39m [90m0.82s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcelebration bonus respects global toggle[39m[90m                                                                    [39m [90m0.74s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\PasswordResetTokenTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mpassword reset token expiry[39m[90m                                                                                 [39m [90m0.10s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\RiskGuardServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mrisk blocked exception provides user friendly message[39m[90m                                                       [39m [90m0.28s[39m  
  [32;1mâœ“[39;22m[90m [39m[90massert user can invest passes for non blocked user[39m[90m                                                          [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90massert user can invest includes operation context in exception[39m[90m                                              [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mrisk blocked exception report context includes required fields[39m[90m                                              [39m [90m0.30s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget blocking details returns null for non blocked user[39m[90m                                                      [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mis user blocked returns true for blocked user[39m[90m                                                               [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mget blocking details returns complete info for blocked user[39m[90m                                                 [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90massert user can invest refreshes user state[39m[90m                                                                 [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mis user blocked returns false for non blocked user[39m[90m                                                          [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mrisk blocked exception has correct http code[39m[90m                                                                [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90massert user can invest throws for blocked user[39m[90m                                                              [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcan user invest returns inverse of blocked status[39m[90m                                                           [39m [90m0.27s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\UserInvestmentTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment belongs to user[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment tracks units allocated[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment belongs to bulk purchase[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment belongs to product[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment calculates profit loss[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment calculates current value[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment tracks allocation type[39m
  [31;1mâ¨¯[39;22m[90m [39m[90minvestment calculates roi percentage[39m

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\KycDocumentTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mdocument belongs to kyc[39m[90m                                                                                     [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument status enum validates[39m[90m                                                                              [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument can be rejected[39m[90m                                                                                    [39m [90m0.16s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument can be approved[39m[90m                                                                                    [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument stores file path[39m[90m                                                                                   [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument has verification notes[39m[90m                                                                             [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument type enum validates[39m[90m                                                                                [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdocument tracks verified by admin[39m[90m                                                                           [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\ProductPriceHistoryTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mprice history belongs to product[39m[90m                                                                            [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mprice history orders by date descending[39m[90m                                                                     [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mprice history validates price positive[39m[90m                                                                      [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mprice history tracks price changes[39m[90m                                                                          [39m [90m0.14s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\XssPreventionTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mxss prevention in inputs[39m[90m                                                                                    [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\OtpServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mgenerate otp sets 10 minute expiry[39m[90m                                                                          [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mverify otp increments attempt count[39m[90m                                                                         [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90motp cleanup deletes expired entries[39m[90m                                                                         [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mverify otp rejects incorrect code[39m[90m                                                                           [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mverify otp validates correct code[39m[90m                                                                           [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mgenerate otp creates 6 digit code[39m[90m                                                                           [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mgenerate otp stores in database[39m[90m                                                                             [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mverify otp rejects expired code[39m[90m                                                                             [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mresend otp respects cooldown period[39m[90m                                                                         [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mverify otp blocks after 3 attempts[39m[90m                                                                          [39m [90m0.10s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\LuckyDrawEntryTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mentry belongs to lucky draw[39m[90m                                                                                 [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mentry tracks bonus entries[39m[90m                                                                                  [39m [90m0.14s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mentry belongs to user[39m[90m                                                                                       [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mentry tracks entries count[39m[90m                                                                                  [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mentry validates entries positive[39m[90m                                                                            [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mentry calculates total entries[39m[90m                                                                              [39m [90m0.09s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\ReferralServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mreferral multiplier 3x for 20 plus referrals[39m[90m                                                                [39m [90m0.47s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreferral multiplier uses configured tiers[39m[90m                                                                   [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral multiplier 1x for 0 to 2 referrals[39m[90m                                                                 [39m [90m0.32s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral multiplier 2 5x for 10 to 19 referrals[39m[90m                                                             [39m [90m0.39s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral multiplier 2x for 5 to 9 referrals[39m[90m                                                                 [39m [90m0.32s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mreferral multiplier varies by plan[39m[90m                                                                          [39m [90m0.38s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral multiplier updates on referral count change[39m[90m                                                        [39m [90m0.34s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mreferral multiplier 1 5x for 3 to 4 referrals[39m[90m                                                               [39m [90m0.43s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\SupportServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mclose ticket after resolution[39m[90m                                                                               [39m [90m0.83s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mescalate ticket after sla breach[39m[90m                                                                            [39m [90m0.78s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mauto assign ticket to available agent[39m[90m                                                                       [39m [90m0.84s[39m  
[0;38;5;208m"[1;38;5;113mpreipo_test[0;38;5;208m"[m [90m// [39m[90mtests\Unit\ExampleTest.php:20[39m

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\ExampleTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mdatabase name[39m[90m                                                                                               [39m [90m0.08s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\NotificationServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msend notification tracks delivery status[39m[90m                                                                    [39m [90m0.29s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90msend notification respects user preferences[39m[90m                                                                 [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend notification chooses correct channel[39m[90m                                                                   [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend notification retries on failure[39m[90m                                                                        [39m [90m0.26s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend notification batches bulk sends[39m[90m                                                                        [39m [90m0.36s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend notification logs all attempts[39m[90m                                                                         [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90msend notification respects priority[39m[90m                                                                         [39m [90m0.30s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\BonusTransactionTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mbonus belongs to user[39m[90m                                                                                       [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus calculates effective amount[39m[90m                                                                           [39m [90m0.16s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus tracks multiplier applied[39m[90m                                                                             [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus belongs to payment[39m[90m                                                                                    [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus can be reversed[39m[90m                                                                                       [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus type enum validates[39m[90m                                                                                   [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus belongs to subscription[39m[90m                                                                               [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbonus tracks base amount[39m[90m                                                                                    [39m [90m0.10s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\LoggingSecurityTest[39m
  [32;1mâœ“[39;22m[90m [39m[90msensitive data not in logs[39m[90m                                                                                  [39m [90m0.08s[39m  

  [30;43;1m DEPR [39;49;22m[39m Tests\Unit\CsrfProtectionTest[39m
  [33;1m![39;22m[90m [39m[90mcsrf protection enabled[39m[90m [39m[33mâ†’ Creation of dynamic property Tests\Unit\CsrfProtectionTest::$user is deprecated[39m[90m // C:\PreIPO\backend\vendor\nunomaduro\collision\src\Adapters\Phpunit\Printers\DefaultPrinter.php:278[39m

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\WalletServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdraw decreases wallet balance[39m[90m                                                                           [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmultiple operations maintain correct running balance[39m[90m                                                        [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mtransaction records are immutable[39m[90m                                                                           [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90munlock funds throws exception for insufficient locked balance[39m[90m                                               [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeposit throws exception for negative amount[39m[90m                                                                [39m [90m0.07s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mhandles exact balance withdrawal[39m[90m                                                                            [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeposit stores reference when provided[39m[90m                                                                      [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdraw creates transaction with paise[39m[90m                                                                     [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeposit throws exception for zero amount[39m[90m                                                                    [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeposit creates transaction record[39m[90m                                                                          [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90munlock funds throws exception for zero amount[39m[90m                                                               [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeposit increases wallet balance[39m[90m                                                                            [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdraw throws exception for insufficient funds[39m[90m                                                            [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdraw with lock moves funds to locked balance[39m[90m                                                            [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mwithdraw without lock immediately debits[39m[90m                                                                    [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mwithdraw throws exception for zero amount[39m[90m                                                                   [39m [90m0.07s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdeposit is atomic[39m[90m                                                                                           [39m [90m0.11s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90munlock funds decreases locked balance[39m[90m                                                                       [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconcurrent withdrawals respect balance limits[39m[90m                                                               [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mconcurrent deposits are handled safely[39m[90m                                                                      [39m [90m0.15s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mhandles decimal amounts correctly[39m[90m                                                                           [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mdeposit records balance before and after[39m[90m                                                                    [39m [90m0.16s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mlock funds increases locked balance[39m[90m                                                                         [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mhandles large amounts[39m[90m                                                                                       [39m [90m0.10s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\BulkPurchaseTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase calculates extra allocation percentage[39m[90m                                                        [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase calculates discount percentage[39m[90m                                                                [39m [90m0.12s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mprovenance exception has context[39m[90m                                                                            [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase calculates gross margin[39m[90m                                                                       [39m [90m0.10s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase belongs to product[39m[90m                                                                            [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmanual entry requires documentation[39m[90m                                                                         [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbulk purchase validates face value positive[39m[90m                                                                 [39m [90m0.08s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase tracks allocated amount[39m[90m                                                                       [39m [90m0.13s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase calculates gross margin percentage[39m[90m                                                            [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbulk purchase requires source type[39m[90m                                                                          [39m [90m0.15s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase calculates available amount[39m[90m                                                                   [39m [90m0.12s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mcompany listing with valid listing id succeeds[39m[90m                                                              [39m [90m0.11s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mbulk purchase validates cost positive[39m[90m                                                                       [39m [90m0.09s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mmanual entry requires reason[39m[90m                                                                                [39m [90m0.13s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mbulk purchase calculates total value received[39m[90m                                                               [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcompany listing source requires listing id[39m[90m                                                                  [39m [90m0.09s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mmanual entry with valid provenance succeeds[39m[90m                                                                 [39m [90m0.14s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\SupportTicketTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mticket priority enum validates[39m[90m                                                                              [39m [90m0.13s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mticket tracks resolved by admin[39m[90m                                                                             [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mticket auto closes after inactivity[39m[90m                                                                         [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mticket belongs to user[39m[90m                                                                                      [39m [90m0.10s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mticket status enum validates[39m[90m                                                                                [39m [90m0.08s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mticket has messages relationship[39m[90m                                                                            [39m [90m0.14s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\BonusCalculatorTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mit multiplies bonuses based on referral tier[39m[90m                                                                [39m [90m0.34s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit does not award progressive bonus before start month[39m[90m                                                      [39m [90m0.36s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit awards milestone bonus only on exact month[39m[90m                                                               [39m [90m0.35s[39m  
  [31;1mâ¨¯[39;22m[90m [39m[90mit awards correct progressive bonus on month 4[39m[90m                                                              [39m [90m0.31s[39m  

  [30;42;1m PASS [39;49;22m[39m Tests\Unit\SubscriptionServiceTest[39m
  [32;1mâœ“[39;22m[90m [39m[90mpause subscription validates limit[39m[90m                                                                          [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mpause subscription updates status[39m[90m                                                                           [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcreate subscription validates kyc required[39m[90m                                                                  [39m [90m0.29s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mupgrade plan calculates differential charge[39m[90m                                                                 [39m [90m0.37s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcreate subscription sets next payment date[39m[90m                                                                  [39m [90m0.31s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mcancel subscription processes refund[39m[90m                                                                        [39m [90m0.33s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mresume subscription recalculates dates[39m[90m                                                                      [39m [90m0.27s[39m  
  [32;1mâœ“[39;22m[90m [39m[90mdowngrade plan calculates refund[39m[90m                                                                            [39m [90m0.28s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\AdminRoutesSecurityTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90munauthorized access to admin routes fails[39m[90m                                                                   [39m [90m0.01s[39m  

  [39;41;1m FAIL [39;49;22m[39m Tests\Unit\AllocationServiceTest[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocate bonus and investment deducts from same pool[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocation distribution respects limits[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocation logs audit trail on failure[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocate to user deducts from bulk purchase[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocate to user creates investment record[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocation logs audit trail on success[39m
  [31;1mâ¨¯[39;22m[90m [39m[90mallocate to user handles insufficient inventory[39m
  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullPaymentLifecycleActivationTest[22m [90m>[39m duplicate webhook does not double crâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6953 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullPaymentLifecycleActivationTest[22m [90m>[39m full payment lifecycle froâ€¦ [41;1m ContractIntegrityException [49;22m  
[39;1m  [CONTRACT INTEGRITY FAILURE] Subscription #6954 snapshot verification failed. Expected hash: 5421e06f52a1aec560e7575f07e365d2, Actual hash: 1d27b4d1a951852342eae844c9889556. Bonus calculation HALTED. Investigate for potential tampering.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m270[39m
    266â–•                 'alert_level' => 'CRITICAL',
    267â–•                 'action' => 'CALCULATION_HALTED',
    268â–•             ]);
    269â–• 
  âžœ 270â–•             throw new ContractIntegrityException(
    271â–•                 $subscription->id,
    272â–•                 $storedHash,
    273â–•                 $computedHash
    274â–•             );

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m270[39;22m
  [33m2   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m123[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullPaymentLifecycleActivationTest[22m [90m>[39m lifecycle triggers progressive bonusâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6955 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullPaymentLifecycleActivationTest[22m [90m>[39m failed payment does not activate subscription    [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\PaymentWebhookService::handlePaymentFailed()[39;22m

  at [32mtests\Feature\FullPaymentLifecycleActivationTest.php[39m:[32m338[39m
    334â–•         ]);
    335â–• 
    336â–•         // Process failed webhook
    337â–•         $webhookService = app(PaymentWebhookService::class);
  âžœ 338â–•         $webhookService->handlePaymentFailed([
    339â–•             'order_id' => 'order_fail_test',
    340â–•             'reason' => 'Insufficient funds',
    341â–•         ]);
    342â–•

  [33m1   [39m[39;1mtests\Feature\FullPaymentLifecycleActivationTest.php[39;22m:[39;1m338[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m withdrawal request to completion flow                                
[39;1m  Failed asserting that 5000 matches expected 3000.[39;22m

  at [32mtests\Feature\CompleteUserJourneyTest.php[39m:[32m193[39m
    189â–•         $this->actingAs($this->user)->postJson('/api/v1/user/wallet/withdraw', [
    190â–•             'amount' => 2000,
    191â–•             'bank_details' => ['account' => '123', 'ifsc' => 'ABC']
    192â–•         ]);
  âžœ 193â–•         $this->assertEquals(3000, $this->user->wallet->fresh()->balance);
    194â–•         $this->assertEquals(2000, $this->user->wallet->fresh()->locked_balance);
    195â–•         
    196â–•         // 2. Admin approves
    197â–•         $withdrawal = Withdrawal::first();

  [33m1   [39m[39;1mtests\Feature\CompleteUserJourneyTest.php[39;22m:[39;1m193[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m auto debit failure and retry flow                  [41;1m ErrorException [49;22m  
[39;1m  Undefined property: Tests\Feature\CompleteUserJourneyTest::$subscription[39;22m

  at [32mtests\Feature\CompleteUserJourneyTest.php[39m:[32m307[39m
    303â–•     {
    304â–•         Queue::fake();
    305â–•         // 1. Create a payment that is pending and has failed twice
    306â–•         $payment = Payment::factory()->create([
  âžœ 307â–•             'subscription_id' => $this->subscription->id,
    308â–•             'status' => 'pending',
    309â–•             'retry_count' => 2
    310â–•         ]);
    311â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m milestone bonus complete flow                      [41;1m ErrorException [49;22m  
[39;1m  Undefined property: Tests\Feature\CompleteUserJourneyTest::$subscription[39;22m

  at [32mtests\Feature\CompleteUserJourneyTest.php[39m:[32m236[39m
    232â–•     public function testMilestoneBonusCompleteFlow()
    233â–•     {
    234â–•         // 1. Create 11 past paid payments
    235â–•         Payment::factory()->count(11)->create([
  âžœ 236â–•             'subscription_id' => $this->subscription->id,
    237â–•             'status' => 'paid'
    238â–•         ]);
    239â–•         // 2. Set streak to 11
    240â–•         $this->subscription->update(['consecutive_payments_count' => 11]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m kyc submission to approval flow                             [41;1m Error [49;22m  
[39;1m  Call to undefined method Illuminate\Http\Testing\FileFactory::pdf()[39;22m

  at [32mtests\Feature\CompleteUserJourneyTest.php[39m:[32m140[39m
    136â–•             'bank_ifsc' => 'HDFC0001234',
    137â–•             'pan' => UploadedFile::fake()->image('pan.jpg'),
    138â–•             'aadhaar_front' => UploadedFile::fake()->image('front.jpg'),
    139â–•             'aadhaar_back' => UploadedFile::fake()->image('back.jpg'),
  âžœ 140â–•             'bank_proof' => UploadedFile::fake()->pdf('bank.pdf'),
    141â–•             'demat_proof' => UploadedFile::fake()->pdf('demat.pdf'),
    142â–•         ]);
    143â–•         $response->assertStatus(201);
    144â–•         $this->assertEquals('processing', $this->user->kyc->fresh()->status);

  [33m1   [39m[39;1mtests\Feature\CompleteUserJourneyTest.php[39;22m:[39;1m140[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m registration to first payment flow                      [41;1m TypeError [49;22m  
[39;1m  App\Jobs\ProcessSuccessfulPaymentJob::handle(): Argument #1 ($idempotency) must be of type App\Services\IdempotencyService, App\Services\BonusCalculatorService given, called in C:\PreIPO\backend\tests\Feature\CompleteUserJourneyTest.php on line 87[39;22m

  at [32mapp\Jobs\ProcessSuccessfulPaymentJob.php[39m:[32m60[39m
     56â–•      * - Wallet credit already done atomically in PaymentWebhookService
     57â–•      * - This job handles only non-critical post-payment operations
     58â–•      * - Uses idempotency to prevent duplicate bonus/referral processing
     59â–•      */
  âžœ  60â–•     public function handle(\App\Services\IdempotencyService $idempotency): void
     61â–•     {
     62â–•         $idempotencyKey = "payment_post_processing:{$this->payment->id}";
     63â–• 
     64â–•         // Check if already processed

  [33m1   [39m[39;1mapp\Jobs\ProcessSuccessfulPaymentJob.php[39;22m:[39;1m60[39;22m
  [33m2   [39m[39;1mtests\Feature\CompleteUserJourneyTest.php[39;22m:[39;1m87[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m referral bonus complete flow                   [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Jobs\ProcessReferralJob::handle(), 2 passed in C:\PreIPO\backend\tests\Feature\CompleteUserJourneyTest.php on line 222 and exactly 5 expected[39;22m

  at [32mapp\Jobs\ProcessReferralJob.php[39m:[32m42[39m
     38â–•      * Uses two-step flow for proper bonus accounting:
     39â–•      *   Step 1: recordBonusWithTds() - DEBIT MARKETING_EXPENSE, CREDIT BONUS_LIABILITY, CREDIT TDS_PAYABLE
     40â–•      *   Step 2: deposit('bonus_credit') - DEBIT BONUS_LIABILITY, CREDIT USER_WALLET_LIABILITY
     41â–•      */
  âžœ  42â–•     public function handle(
     43â–•         ReferralService $referralService,
     44â–•         WalletService $walletService,
     45â–•         TdsCalculationService $tdsService,
     46â–•         DoubleEntryLedgerService $ledgerService,

  [33m1   [39m[39;1mapp\Jobs\ProcessReferralJob.php[39;22m:[39;1m42[39;22m
  [33m2   [39m[39;1mtests\Feature\CompleteUserJourneyTest.php[39;22m:[39;1m222[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m kyc rejection and resubmission flow                                  
[39;1m  Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'rejected'
+'submitted'[39;22m

  at [32mtests\Feature\CompleteUserJourneyTest.php[39m:[32m338[39m
    334â–•         $kyc->update(['status' => 'submitted']); // Simulate job moved to manual
    335â–• 
    336â–•         // 2. Reject
    337â–•         $this->actingAs($this->admin)->postJson("/api/v1/admin/kyc-queue/{$kyc->id}/reject", ['reason' => 'Blurry photo']);
  âžœ 338â–•         $this->assertEquals('rejected', $kyc->fresh()->status);
    339â–•         
    340â–•         // 3. Resubmit
    341â–•         $this->actingAs($this->user)->postJson('/api/v1/user/kyc', [
    342â–•             'pan_number' => 'ABCDE1234F', /* ... */

  [33m1   [39m[39;1mtests\Feature\CompleteUserJourneyTest.php[39;22m:[39;1m338[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m lucky draw entry to winner flow                    [41;1m ErrorException [49;22m  
[39;1m  Undefined property: Tests\Feature\CompleteUserJourneyTest::$subscription[39;22m

  at [32mtests\Feature\CompleteUserJourneyTest.php[39m:[32m284[39m
    280â–•         $draw = LuckyDraw::factory()->create(['status' => 'open', 'prize_structure' => [
    281â–•             ['rank' => 1, 'count' => 1, 'amount' => 1000]
    282â–•         ]]);
    283â–•         $payment = Payment::factory()->create([
  âžœ 284â–•             'subscription_id' => $this->subscription->id,
    285â–•             'is_on_time' => true,
    286â–•         ]);
    287â–•         
    288â–•         // 1. Generate Entry

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\CompleteUserJourneyTest[22m [90m>[39m profit share distribution flow                              [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\ProfitShareFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m snapshot enforces unique date plan constraint                       
[39;1m  Failed asserting that exception of type "Illuminate\Database\QueryException" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m snapshot records correct severity counts          [41;1m ErrorException [49;22m  
[39;1m  Attempt to read property "low_severity_count" on null[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m198[39m
    194â–•         $snapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
    195â–•             ->whereNull('plan_id')
    196â–•             ->first();
    197â–• 
  âžœ 198â–•         $this->assertEquals(2, $snapshot->low_severity_count);
    199â–•         $this->assertEquals(1, $snapshot->medium_severity_count);
    200â–•         $this->assertEquals(1, $snapshot->high_severity_count);
    201â–•         $this->assertEquals(2, $snapshot->critical_severity_count);
    202â–•     }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m aggregate command creates per plan snapshots                        
[39;1m  Failed asserting that null is not null.[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m118[39m
    114â–•         $planSnapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
    115â–•             ->where('plan_id', $plan->id)
    116â–•             ->first();
    117â–• 
  âžœ 118â–•         $this->assertNotNull($planSnapshot);
    119â–•     }
    120â–• 
    121â–•     #[\PHPUnit\Framework\Attributes\Test]
    122â–•     public function aggregate_command_skips_existing_without_force()

  [33m1   [39m[39;1mtests\Feature\DailyDisputeSnapshotTest.php[39;22m:[39;1m118[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m aggregate command overwrites with force                             
[39;1m  Failed asserting that 999 matches expected 1.[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m172[39m
    168â–•         $snapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
    169â–•             ->whereNull('plan_id')
    170â–•             ->first();
    171â–• 
  âžœ 172â–•         $this->assertEquals(1, $snapshot->total_disputes);
    173â–•     }
    174â–• 
    175â–•     // ==================== SNAPSHOT DATA ACCURACY TESTS ====================
    176â–•

  [33m1   [39m[39;1mtests\Feature\DailyDisputeSnapshotTest.php[39;22m:[39;1m172[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m snapshot records chargeback metrics               [41;1m ErrorException [49;22m  
[39;1m  Attempt to read property "confirmed_chargeback_count" on null[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m260[39m
    256â–•         $snapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
    257â–•             ->whereNull('plan_id')
    258â–•             ->first();
    259â–• 
  âžœ 260â–•         $this->assertEquals(2, $snapshot->confirmed_chargeback_count);
    261â–•         $this->assertEquals(150000, $snapshot->confirmed_chargeback_amount_paise);
    262â–•     }
    263â–• 
    264â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m snapshot records blocked user count               [41;1m ErrorException [49;22m  
[39;1m  Attempt to read property "blocked_users_count" on null[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m281[39m
    277â–•         $snapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
    278â–•             ->whereNull('plan_id')
    279â–•             ->first();
    280â–• 
  âžœ 281â–•         $this->assertEquals(2, $snapshot->blocked_users_count);
    282â–•     }
    283â–• 
    284â–•     // ==================== MODEL ACCESSOR TESTS ====================
    285â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m snapshot records correct status counts            [41;1m ErrorException [49;22m  
[39;1m  Attempt to read property "open_disputes" on null[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m223[39m
    219â–•         $snapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
    220â–•             ->whereNull('plan_id')
    221â–•             ->first();
    222â–• 
  âžœ 223â–•         $this->assertEquals(2, $snapshot->open_disputes);
    224â–•         $this->assertEquals(1, $snapshot->under_investigation_disputes);
    225â–•         $this->assertEquals(1, $snapshot->resolved_disputes);
    226â–•         $this->assertEquals(1, $snapshot->escalated_disputes);
    227â–•     }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\DailyDisputeSnapshotTest[22m [90m>[39m aggregate command creates platform snapshot                         
[39;1m  Failed asserting that null is not null.[39;22m

  at [32mtests\Feature\DailyDisputeSnapshotTest.php[39m:[32m98[39m
     94â–•         $snapshot = DailyDisputeSnapshot::where('snapshot_date', $snapshotDate)
     95â–•             ->whereNull('plan_id')
     96â–•             ->first();
     97â–• 
  âžœ  98â–•         $this->assertNotNull($snapshot);
     99â–•         $this->assertEquals(2, $snapshot->total_disputes);
    100â–•     }
    101â–• 
    102â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Feature\DailyDisputeSnapshotTest.php[39;22m:[39;1m98[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m concurrent wallet operations maintainâ€¦  [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\WalletService::__construct(), 0 passed in C:\PreIPO\backend\tests\Feature\FullUserJourneyIntegrationTest.php on line 405 and exactly 1 expected[39;22m

  at [32mapp\Services\WalletService.php[39m:[32m47[39m
     43â–• 
     44â–•     /**
     45â–•      * Constructor with double-entry ledger injection.
     46â–•      */
  âžœ  47â–•     public function __construct(DoubleEntryLedgerService $ledgerService)
     48â–•     {
     49â–•         $this->ledgerService = $ledgerService;
     50â–•     }
     51â–•

  [33m1   [39m[39;1mapp\Services\WalletService.php[39;22m:[39;1m47[39;22m
  [33m2   [39m[39;1mtests\Feature\FullUserJourneyIntegrationTest.php[39;22m:[39;1m405[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m referral multiplier affects bonus calculatâ€¦ [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'amount' doesn't have a default value (Connection: mysql, SQL: insert into `subscriptions` (`user_id`, `plan_id`, `status`, `consecutive_payments_count`, `bonus_multiplier`, `updated_at`, `created_at`) values (33777, 9881, active, 4, 2, 2026-02-22 17:41:31, 2026-02-22 17:41:31))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'amount' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m withdrawal flow with locked balance     [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\WalletService::__construct(), 0 passed in C:\PreIPO\backend\tests\Feature\FullUserJourneyIntegrationTest.php on line 312 and exactly 1 expected[39;22m

  at [32mapp\Services\WalletService.php[39m:[32m47[39m
     43â–• 
     44â–•     /**
     45â–•      * Constructor with double-entry ledger injection.
     46â–•      */
  âžœ  47â–•     public function __construct(DoubleEntryLedgerService $ledgerService)
     48â–•     {
     49â–•         $this->ledgerService = $ledgerService;
     50â–•     }
     51â–•

  [33m1   [39m[39;1mapp\Services\WalletService.php[39;22m:[39;1m47[39;22m
  [33m2   [39m[39;1mtests\Feature\FullUserJourneyIntegrationTest.php[39;22m:[39;1m312[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m milestone bonus awarded at correct month    [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'amount' doesn't have a default value (Connection: mysql, SQL: insert into `subscriptions` (`user_id`, `plan_id`, `status`, `consecutive_payments_count`, `bonus_multiplier`, `updated_at`, `created_at`) values (33781, 9883, active, 5, 1, 2026-02-22 17:41:32, 2026-02-22 17:41:32))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'amount' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m bulk bonus award to multiple users                            
[39;1m  Failed asserting that 250 matches expected 350.[39;22m

  at [32mtests\Feature\FullUserJourneyIntegrationTest.php[39m:[32m370[39m
    366â–•         $this->assertStringContainsString('5 users', $response->json('message'));
    367â–• 
    368â–•         // Verify all users received the bonus
    369â–•         foreach ($users as $user) {
  âžœ 370â–•             $this->assertEquals(350, $user->wallet->fresh()->balance); // 100 + 250
    371â–•         }
    372â–•     }
    373â–• 
    374â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Feature\FullUserJourneyIntegrationTest.php[39;22m:[39;1m370[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m settings update clears cache correctly                        
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\FullUserJourneyIntegrationTest.php[39m:[32m386[39m
    382â–•             ->postJson('/api/v1/admin/settings/theme', [
    383â–•                 'primary_color' => '#FF0000'
    384â–•             ]);
    385â–• 
  âžœ 386â–•         $response->assertStatus(200);
    387â–• 
    388â–•         // Cache should be cleared
    389â–•         $this->assertNull(cache()->get('settings'));
    390â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m admin wallet adjustment flow                                  
[39;1m  Failed asserting that 500 matches expected 1500.[39;22m

  at [32mtests\Feature\FullUserJourneyIntegrationTest.php[39m:[32m156[39m
    152â–•                 'description' => 'Promotional credit'
    153â–•             ]);
    154â–• 
    155â–•         $response->assertStatus(200);
  âžœ 156â–•         $this->assertEquals(1500, $response->json('new_balance'));
    157â–• 
    158â–•         // Verify transaction recorded
    159â–•         $this->assertDatabaseHas('transactions', [
    160â–•             'user_id' => $user->id,

  [33m1   [39m[39;1mtests\Feature\FullUserJourneyIntegrationTest.php[39;22m:[39;1m156[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FullUserJourneyIntegrationTest[22m [90m>[39m complete user registration to first bonus journey             
[39;1m  Expected response status code [201] but received 404.
Failed asserting that 404 is identical to 201.[39;22m

  at [32mtests\Feature\FullUserJourneyIntegrationTest.php[39m:[32m64[39m
     60â–•             'password' => 'SecurePass123!',
     61â–•             'password_confirmation' => 'SecurePass123!'
     62â–•         ]);
     63â–• 
  âžœ  64â–•         $response->assertStatus(201);
     65â–•         $userId = $response->json('user.id');
     66â–•         $this->assertNotNull($userId);
     67â–• 
     68â–•         $user = User::find($userId);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m user can cancel pending withdrawal                                
[39;1m  Failed asserting that 10000 matches expected 8000.[39;22m

  at [32mtests\Feature\UserWithdrawalEndpointTest.php[39m:[32m76[39m
     72â–•     public function testUserCanCancelPendingWithdrawal()
     73â–•     {
     74â–•         // 1. Create the withdrawal
     75â–•         $this->actingAs($this->user)->postJson('/api/v1/user/wallet/withdraw', $this->getValidData(['amount' => 2000]));
  âžœ  76â–•         $this->assertEquals(8000, $this->wallet->fresh()->balance);
     77â–•         $this->assertEquals(2000, $this->wallet->fresh()->locked_balance);
     78â–•         $withdrawal = Withdrawal::first();
     79â–• 
     80â–•         // 2. Cancel it

  [33m1   [39m[39;1mtests\Feature\UserWithdrawalEndpointTest.php[39;22m:[39;1m76[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m withdrawal notification sent                                      
[39;1m  The expected [App\Notifications\WithdrawalRequested] notification was not sent.
Failed asserting that false is true.[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Support\Testing\Fakes\NotificationFake.php[39m:[32m89[39m
     85â–•         if (is_numeric($callback)) {
     86â–•             return $this->assertSentToTimes($notifiable, $notification, $callback);
     87â–•         }
     88â–• 
  âžœ  89â–•         PHPUnit::assertTrue(
     90â–•             $this->sent($notifiable, $notification, $callback)->count() > 0,
     91â–•             "The expected [{$notification}] notification was not sent."
     92â–•         );
     93â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Testing\Fakes\NotificationFake.php[39;22m:[39;1m89[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php[39;22m:[39;1m361[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m user cannot withdraw more than balance                            
[39;1m  Failed to find a validation error in the response for key: 'amount'

Response does not have JSON validation errors.
Failed asserting that an array has the key 'amount'.

The following errors occurred during the last request:

{
    "message": "Insufficient wallet balance.",
    "errors": {
        "amount": [
            "Insufficient wallet balance."
        ]
    }
}[39;22m

  at [32mtests\Feature\UserWithdrawalEndpointTest.php[39m:[32m59[39m
     55â–•         $response = $this->actingAs($this->user)->postJson('/api/v1/user/wallet/withdraw',
     56â–•             $this->getValidData(['amount' => 11000]) // Balance is 10k
     57â–•         );
     58â–•         $response->assertStatus(422); // Validation error
  âžœ  59â–•         $response->assertJsonValidationErrors('amount', 'Insufficient funds');
     60â–•     }
     61â–• 
     62â–•     public function testWithdrawalLocksBalance()
     63â–•     {

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m user can view withdrawal history                                  
[39;1m  Failed to assert that the response count matched the expected 1
Failed asserting that actual size 0 matches expected size 1.[39;22m

  at [32mtests\Feature\UserWithdrawalEndpointTest.php[39m:[32m97[39m
     93â–•         
     94â–•         $response = $this->actingAs($this->user)->getJson('/api/v1/user/withdrawals');
     95â–•         
     96â–•         $response->assertStatus(200);
  âžœ  97â–•         $response->assertJsonCount(1, 'data');
     98â–•         $response->assertJsonPath('data.0.amount', '5000.00');
     99â–•     }
    100â–• 
    101â–•     public function testWithdrawalRequiresBankDetails()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m withdrawal respects rate limiting                                 
[39;1m  Expected response status code [429] but received 422.
Failed asserting that 422 is identical to 429.

The following errors occurred during the last request:

{
    "message": "Insufficient wallet balance.",
    "errors": {
        "amount": [
            "Insufficient wallet balance."
        ]
    }
}[39;22m

  at [32mtests\Feature\UserWithdrawalEndpointTest.php[39m:[32m128[39m
    124â–•         }
    125â–•         
    126â–•         // 6th request should be blocked
    127â–•         $response = $this->actingAs($this->user)->postJson('/api/v1/user/wallet/withdraw', $this->getValidData());
  âžœ 128â–•         $response->assertStatus(429); // Too Many Requests
    129â–•     }
    130â–• 
    131â–•     public function testWithdrawalNotificationSent()
    132â–•     {

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m user can request withdrawal                                       
[39;1m  Expected response status code [200] but received 422.
Failed asserting that 422 is identical to 200.

The following errors occurred during the last request:

{
    "message": "Insufficient wallet balance.",
    "errors": {
        "amount": [
            "Insufficient wallet balance."
        ]
    }
}[39;22m

  at [32mtests\Feature\UserWithdrawalEndpointTest.php[39m:[32m49[39m
     45â–•     {
     46â–•         $response = $this->actingAs($this->user)->postJson('/api/v1/user/wallet/withdraw',
     47â–•             $this->getValidData()
     48â–•         );
  âžœ  49â–•         $response->assertStatus(200);
     50â–•         $response->assertJson(['message' => 'Withdrawal request submitted for approval.']);
     51â–•     }
     52â–• 
     53â–•     public function testUserCannotWithdrawMoreThanBalance()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserWithdrawalEndpointTest[22m [90m>[39m withdrawal locks balance                                          
[39;1m  Failed asserting that 10000 matches expected 7000.[39;22m

  at [32mtests\Feature\UserWithdrawalEndpointTest.php[39m:[32m68[39m
     64â–•         $this->actingAs($this->user)->postJson('/api/v1/user/wallet/withdraw',
     65â–•             $this->getValidData(['amount' => 3000])
     66â–•         );
     67â–•         
  âžœ  68â–•         $this->assertEquals(7000, $this->wallet->fresh()->balance);
     69â–•         $this->assertEquals(3000, $this->wallet->fresh()->locked_balance);
     70â–•     }
     71â–• 
     72â–•     public function testUserCanCancelPendingWithdrawal()

  [33m1   [39m[39;1mtests\Feature\UserWithdrawalEndpointTest.php[39;22m:[39;1m68[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m ledger debits equal credits                      [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6964 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m no negative wallet balances exist                [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6965 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m subscription revenue matches paid payments       [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6966 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m full financial reconciliation passes             [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6967 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m receivables match outstanding chargebacks        [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6968 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m no orphaned wallet transactions exist            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6969 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m bonus payouts reconcile with wallet credits      [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6970 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m wallet balances reconcile with transaction histâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6971 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\FinancialGuaranteesTest[22m [90m>[39m wallet balances mirror liability ledger          [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6972 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\LuckyDrawTest[22m [90m>[39m admin can execute draw                                       [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`lucky_draw_entries`, CONSTRAINT `lucky_draw_entries_payment_id_foreign` FOREIGN KEY (`payment_id`) REFERENCES `payments` (`id`) ON DELETE CASCADE) (Connection: mysql, SQL: insert into `lucky_draw_entries` (`user_id`, `lucky_draw_id`, `payment_id`, `updated_at`, `created_at`) values (33838, 425, 1, 2026-02-22 17:41:47, 2026-02-22 17:41:47))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`lucky_draw_entries`, CONSTRAINT `lucky_draw_entries_payment_id_foreign` FOREIGN KEY (`payment_id`) REFERENCES `payments` (`id`) ON DELETE CASCADE)")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BonusTdsIntegrationTest[22m [90m>[39m wallet credits net amount after tds              [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6979 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BonusTdsIntegrationTest[22m [90m>[39m ledger contains gross and tds entries            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6980 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BonusTdsIntegrationTest[22m [90m>[39m bonus calculations have no rounding drift        [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6981 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BonusTdsIntegrationTest[22m [90m>[39m tds not deducted for bonus below threshold       [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6982 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BonusTdsIntegrationTest[22m [90m>[39m bonus transaction creates balanced ledger entriâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #6983 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BonusTdsIntegrationTest[22m [90m>[39m tds correctly deducted for bonus above threshold   [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'consistency_bonus' in 'field list' (Connection: mysql, SQL: insert into `plans` (`name`, `slug`, `razorpay_plan_id`, `monthly_amount`, `duration_months`, `description`, `is_active`, `is_featured`, `display_order`, `available_from`, `available_until`, `max_subscriptions_per_user`, `allow_pause`, `max_pause_count`, `max_pause_duration_months`, `consistency_bonus`, `updated_at`, `created_at`) values (Bronze SIP 6013c2a5, bronze-sip-6013c2a5, plan_jnrpkmyahz, 100000, 36, Suscipit aut similique et totam. Minima iure aperiam possimus doloribus. Voluptatem vitae doloribus possimus laudantium repellat aliquid. Ut distinctio accusamus molestiae nobis laudantium vitae hic dolores., 1, 0, 10, 2025-08-22 17:41:57, ?, 5, 1, 2, 3, 15000, 2026-02-22 17:41:57, 2026-02-22 17:41:57))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m47[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[42S22]: Column not found: 1054 Unknown column 'consistency_bonus' in 'field list'")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AutoDebitMultiCycleTest[22m [90m>[39m full failure to suspension flow                                      
[39;1m  Still active after 2nd failure
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'active'
+'payment_failed'[39;22m

  at [32mtests\Feature\AutoDebitMultiCycleTest.php[39m:[32m254[39m
    250â–•         ]);
    251â–• 
    252â–•         $this->service->processRetry($payment2);
    253â–•         $this->subscription->refresh();
  âžœ 254â–•         $this->assertEquals('active', $this->subscription->status, 'Still active after 2nd failure');
    255â–• 
    256â–•         // Attempt 3: Third failure â†’ Suspension
    257â–•         $payment3 = Payment::factory()->create([
    258â–•             'subscription_id' => $this->subscription->id,

  [33m1   [39m[39;1mtests\Feature\AutoDebitMultiCycleTest.php[39;22m:[39;1m254[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SocialLoginReferralTest[22m [90m>[39m google redirect includes referral code in state                      
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\SocialLoginReferralTest.php[39m:[32m132[39m
    128â–•     public function google_redirect_includes_referral_code_in_state()
    129â–•     {
    130â–•         $response = $this->get('/api/v1/auth/google?referral_code=TEST123');
    131â–• 
  âžœ 132â–•         $response->assertStatus(200);
    133â–•         $response->assertJsonStructure(['redirect_url']);
    134â–• 
    135â–•         $data = $response->json();
    136â–•         $this->assertStringContainsString('google.com', $data['redirect_url']);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SocialLoginReferralTest[22m [90m>[39m it prevents self referral                                            
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\SocialLoginReferralTest.php[39m:[32m119[39m
    115â–• 
    116â–•         $response = $this->get('/api/v1/auth/google/callback?state=' . $state);
    117â–• 
    118â–•         // Should succeed but not create self-referral
  âžœ 119â–•         $this->assertTrue($response->isRedirection());
    120â–• 
    121â–•         // No referral should be created
    122â–•         $this->assertEquals(0, Referral::where('referrer_id', $user->id)
    123â–•             ->where('referred_id', $user->id)

  [33m1   [39m[39;1mtests\Feature\SocialLoginReferralTest.php[39;22m:[39;1m119[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SocialLoginReferralTest[22m [90m>[39m it handles invalid referral code gracefully                          
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\SocialLoginReferralTest.php[39m:[32m82[39m
     78â–• 
     79â–•         $response = $this->get('/api/v1/auth/google/callback?state=' . $state);
     80â–• 
     81â–•         // Should still succeed
  âžœ  82â–•         $this->assertTrue($response->isRedirection());
     83â–• 
     84â–•         // User should be created without referral
     85â–•         $newUser = User::where('email', 'user2@example.com')->first();
     86â–•         $this->assertNotNull($newUser);

  [33m1   [39m[39;1mtests\Feature\SocialLoginReferralTest.php[39;22m:[39;1m82[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SocialLoginReferralTest[22m [90m>[39m it can process referral code during google login                     
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\SocialLoginReferralTest.php[39m:[32m45[39m
     41â–• 
     42â–•         $response = $this->get('/api/v1/auth/google/callback?state=' . $state);
     43â–• 
     44â–•         // Should redirect to frontend with token
  âžœ  45â–•         $this->assertTrue($response->isRedirection());
     46â–• 
     47â–•         // Check that user was created
     48â–•         $newUser = User::where('email', 'newuser@example.com')->first();
     49â–•         $this->assertNotNull($newUser);

  [33m1   [39m[39;1mtests\Feature\SocialLoginReferralTest.php[39;22m:[39;1m45[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserLuckyDrawEndpointsTest[22m [90m>[39m user can view own entries                                [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m refund after bonus claws back correctly           [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7002 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m concurrent payment and cancel resolves safely     [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7003 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m payment during pause handled correctly            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7004 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m refund larger than payment rejected                          [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\PaymentWebhookService::handleRefund()[39;22m

  at [32mtests\Feature\EdgeCaseResilienceTest.php[39m:[32m520[39m
    516â–•         $initialBalance = $this->user->wallet->balance_paise;
    517â–• 
    518â–•         // Try to refund more than payment amount
    519â–•         try {
  âžœ 520â–•             $this->webhookService->handleRefund([
    521â–•                 'payment_id' => 'pay_partial_refund',
    522â–•                 'refund_id' => 'rfnd_oversized',
    523â–•                 'amount' => 200000, // Double the payment
    524â–•             ]);

  [33m1   [39m[39;1mtests\Feature\EdgeCaseResilienceTest.php[39;22m:[39;1m520[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m investment exceeding inventory handled gracefullâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7006 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m double webhook delivery is idempotent             [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7007 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m rapid fire webhooks processed safely              [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7008 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\EdgeCaseResilienceTest[22m [90m>[39m chargeback during plan upgrade maintains integrity  [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'type' in 'where clause' (Connection: mysql, SQL: select sum(`amount_paise`) as aggregate from `ledger_lines` where `type` = debit)[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m407[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[42S22]: Column not found: 1054 Unknown column 'type' in 'where clause'")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralSystemTest[22m [90m>[39m referrer gets bonus and tier upgrade on referee paymenâ€¦ [41;1m ErrorException [49;22m  
[39;1m  Undefined variable $tdsService[39;22m

  at [32mapp\Jobs\ProcessReferralJob.php[39m:[32m131[39m
    127â–•                 $grossBonus = $bonusData['amount'];
    128â–•                 $description = $bonusData['description'];
    129â–• 
    130â–•                 // 3. Calculate TDS on referral bonus
  âžœ 131â–•                 $tdsResult = $tdsService->calculate($grossBonus, 'referral');
    132â–• 
    133â–•                 // 4. Create Bonus Transaction (with TDS tracking)
    134â–•                 $bonus = BonusTransaction::create([
    135â–•                     'user_id' => $referrer->id,

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php[39;22m:[39;1m32[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php[39;22m:[39;1m495[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m bonus contract snapshot preserved through payments   [41;1m QueryException [49;22m  
[39;1m  Array to string conversion (Connection: mysql, SQL: insert into `subscriptions` (`user_id`, `plan_id`, `amount_paise`, `amount`, `subscription_code`, `status`, `start_date`, `end_date`, `next_payment_date`, `bonus_multiplier`, `consecutive_payments_count`, `pause_count`, `is_auto_debit`, `bonus_contract_snapshot`, `updated_at`, `created_at`) values (33947, 1764, 250000, 2500.00, SUB-8JLZCMEHNL, active, 2025-01-12 22:43:57, 2027-01-12 22:43:57, 2026-02-27 17:42:26, 1, 0, 0, 0, ?, 2026-02-22 17:42:26, 2026-02-22 17:42:26))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m719[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m reporting queries are consistent                   [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7012 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m no negative liabilities in ledger                  [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7013 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m wallet balances match transaction sums             [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7014 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m payment sum matches revenue ledger                 [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7015 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m aggregates match raw ledger sums                   [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7016 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\SnapshotIntegrityTest[22m [90m>[39m investment snapshots are immutable                   [41;1m QueryException [49;22m  
[39;1m  Array to string conversion (Connection: mysql, SQL: insert into `subscriptions` (`user_id`, `plan_id`, `amount_paise`, `amount`, `subscription_code`, `status`, `start_date`, `end_date`, `next_payment_date`, `bonus_multiplier`, `consecutive_payments_count`, `pause_count`, `is_auto_debit`, `bonus_contract_snapshot`, `updated_at`, `created_at`) values (33972, 1764, 250000, 2500.00, SUB-D1X4MYWDEH, active, 2024-06-30 08:49:50, 2026-06-30 08:49:50, 2026-02-27 17:42:34, 1, 0, 0, 0, ?, 2026-02-22 17:42:34, 2026-02-22 17:42:34))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m719[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralTest[22m [90m>[39m multiplier increases to tier 2 at 5 referrals                 [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`subscriptions`, CONSTRAINT `subscriptions_plan_id_foreign` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`)) (Connection: mysql, SQL: insert into `subscriptions` (`user_id`, `plan_id`, `amount_paise`, `amount`, `subscription_code`, `status`, `start_date`, `end_date`, `next_payment_date`, `bonus_multiplier`, `consecutive_payments_count`, `pause_count`, `is_auto_debit`, `bonus_contract_snapshot`, `updated_at`, `created_at`) values (34016, 1, 250000, 2500.00, SUB-UWZIUW2ANQ, active, 2024-07-15 17:13:16, 2026-07-15 17:13:16, 2026-02-27 17:42:41, 1, 0, 0, 0, ?, 2026-02-22 17:42:41, 2026-02-22 17:42:41))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`subscriptions`, CONSTRAINT `subscriptions_plan_id_foreign` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`))")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralTest[22m [90m>[39m multiplier increases when referrals complete                  [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`subscriptions`, CONSTRAINT `subscriptions_plan_id_foreign` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`)) (Connection: mysql, SQL: insert into `subscriptions` (`user_id`, `plan_id`, `amount_paise`, `amount`, `subscription_code`, `status`, `start_date`, `end_date`, `next_payment_date`, `bonus_multiplier`, `consecutive_payments_count`, `pause_count`, `is_auto_debit`, `bonus_contract_snapshot`, `updated_at`, `created_at`) values (34017, 1, 250000, 2500.00, SUB-YJIGNBKHQH, active, 2024-12-17 11:35:59, 2026-12-17 11:35:59, 2026-02-27 17:42:41, 1, 0, 0, 0, ?, 2026-02-22 17:42:41, 2026-02-22 17:42:41))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`subscriptions`, CONSTRAINT `subscriptions_plan_id_foreign` FOREIGN KEY (`plan_id`) REFERENCES `plans` (`id`))")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserNotificationEndpointsTest[22m [90m>[39m get notifications returns user notifications                   
[39;1m  Failed to assert that the response count matched the expected 2
Failed asserting that actual size 13 matches expected size 2.[39;22m

  at [32mtests\Feature\UserNotificationEndpointsTest.php[39m:[32m47[39m
     43â–• 
     44â–•         $response = $this->actingAs($this->user)->getJson('/api/v1/user/notifications');
     45â–•         
     46â–•         $response->assertStatus(200);
  âžœ  47â–•         $response->assertJsonCount(2, 'data');
     48â–•     }
     49â–• 
     50â–•     #[\PHPUnit\Framework\Attributes\Test]
     51â–•     public function testMarkNotificationAsRead()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserNotificationEndpointsTest[22m [90m>[39m delete notification                                            
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\UserNotificationEndpointsTest.php[39m:[32m84[39m
     80â–•         $this->assertDatabaseHas('notifications', ['id' => $notification->id]);
     81â–•         
     82â–•         $response = $this->actingAs($this->user)->deleteJson("/api/v1/user/notifications/{$notification->id}");
     83â–•         
  âžœ  84â–•         $response->assertStatus(200);
     85â–•         $this->assertDatabaseMissing('notifications', ['id' => $notification->id]);
     86â–•     }
     87â–• 
     88â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserNotificationEndpointsTest[22m [90m>[39m mark notification as read                                      
[39;1m  Expected response status code [200] but received 405.
Failed asserting that 405 is identical to 200.[39;22m

  at [32mtests\Feature\UserNotificationEndpointsTest.php[39m:[32m58[39m
     54â–•         $this->assertNull($notification->read_at);
     55â–• 
     56â–•         $response = $this->actingAs($this->user)->postJson("/api/v1/user/notifications/{$notification->id}/read");
     57â–•         
  âžœ  58â–•         $response->assertStatus(200);
     59â–•         $this->assertNotNull($notification->fresh()->read_at);
     60â–•     }
     61â–• 
     62â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserNotificationEndpointsTest[22m [90m>[39m notifications paginated                                        
[39;1m  Failed to assert that the response count matched the expected 20
Failed asserting that actual size 13 matches expected size 20.[39;22m

  at [32mtests\Feature\UserNotificationEndpointsTest.php[39m:[32m99[39m
     95â–• 
     96â–•         $response = $this->actingAs($this->user)->getJson('/api/v1/user/notifications');
     97â–•         
     98â–•         $response->assertStatus(200);
  âžœ  99â–•         $response->assertJsonCount(20, 'data'); // Default page size is 20
    100â–•         $response->assertJsonPath('meta.total', 25);
    101â–•         $response->assertJsonPath('meta.per_page', 20);
    102â–•     }
    103â–• }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminWorkflowTest[22m [90m>[39m admin can approve kyc                                                      
[39;1m  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

ErrorException: Attempt to read property "value" on string in C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php:98
Stack trace:
#0 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Bootstrap\HandleExceptions.php(258): Illuminate\Foundation\Bootstrap\HandleExceptions->handleError(2, 'Attempt to read...', 'C:\\PreIPO\\backe...', 98)
#1 C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php(98): Illuminate\Foundation\Bootstrap\HandleExceptions->Illuminate\Foundation\Bootstrap\{closure}(2, 'Attempt to read...', 'C:\\PreIPO\\backe...', 98)
#2 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php(32): App\Services\Kyc\KycStatusService->App\Services\Kyc\{closure}(Object(Illuminate\Database\MySqlConnection))
#3 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php(495): Illuminate\Database\Connection->transaction(Object(Closure))
#4 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php(361): Illuminate\Database\DatabaseManager->__call('transaction', Array)
#5 C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php(60): Illuminate\Support\Facades\Facade::__callStatic('transaction', Array)
#6 C:\PreIPO\backend\app\Http\Controllers\Api\Admin\KycQueueController.php(119): App\Services\Kyc\KycStatusService->transitionTo(Object(App\Models\UserKyc), Object(App\Enums\KycStatus), Array)
#7 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php(32): App\Http\Controllers\Api\Admin\KycQueueController->App\Http\Controllers\Api\Admin\{closure}(Object(Illuminate\Database\MySqlConnection))
#8 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php(495): Illuminate\Database\Connection->transaction(Object(Closure))
#9 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php(361): Illuminate\Database\DatabaseManager->__call('transaction', Array)
#10 C:\PreIPO\backend\app\Http\Controllers\Api\Admin\KycQueueController.php(115): Illuminate\Support\Facades\Facade::__callStatic('transaction', Array)
#11 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(47): App\Http\Controllers\Api\Admin\KycQueueController->approve(Object(Illuminate\Http\Request), '33853')
#12 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(266): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\Api\Admin\KycQueueController), 'approve')
#13 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(212): Illuminate\Routing\Route->runController()
#14 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(808): Illuminate\Routing\Route->run()
#15 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#16 C:\PreIPO\backend\app\Http\Middleware\CheckPermission.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckPermission->handle(Object(Illuminate\Http\Request), Object(Closure), 'kyc.approve')
#18 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Middleware\RoleMiddleware.php(37): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#19 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Spatie\Permission\Middleware\RoleMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin|super-adm...')
#20 C:\PreIPO\backend\app\Http\Middleware\AdminIpRestriction.php(43): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#21 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\AdminIpRestriction->handle(Object(Illuminate\Http\Request), Object(Closure))
#22 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(51): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#23 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#24 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(161): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#25 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(127): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#26 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(89): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'admin-actions', Object(Closure))
#27 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin-actions')
#28 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(64): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#29 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#30 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#31 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(807): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#32 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(786): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#33 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(750): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#34 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(739): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#35 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(201): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#36 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#37 C:\PreIPO\backend\app\Http\Middleware\RedirectMiddleware.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\RedirectMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 C:\PreIPO\backend\app\Http\Middleware\CheckMaintenanceMode.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckMaintenanceMode->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 C:\PreIPO\backend\app\Http\Middleware\SanitizeInput.php(33): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\SanitizeInput->handle(Object(Illuminate\Http\Request), Object(Closure))
#43 C:\PreIPO\backend\app\Http\Middleware\ForceHttps.php(23): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#44 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\ForceHttps->handle(Object(Illuminate\Http\Request), Object(Closure))
#45 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#46 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#47 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#48 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#49 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#50 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#51 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#52 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#53 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#54 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#55 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(110): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#56 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#57 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(62): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#58 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#59 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#60 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#61 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#62 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#63 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#64 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(176): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#65 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(145): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#66 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#67 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/v1/admin/k...', Array, Array, Array, Array, '[]')
#68 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/v1/admin/k...', Array, Array, 0)
#69 C:\PreIPO\backend\tests\Feature\AdminWorkflowTest.php(41): Illuminate\Foundation\Testing\TestCase->postJson('/api/v1/admin/k...')
#70 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(1667): Tests\Feature\AdminWorkflowTest->admin_can_approve_kyc()
#71 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#72 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#73 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(365): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\AdminWorkflowTest))
#74 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#75 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#76 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#77 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#78 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#79 C:\PreIPO\backend\vendor\phpunit\phpunit\phpunit(104): PHPUnit\TextUI\Application->run(Array)
#80 {main}

----------------------------------------------------------------------------------

Attempt to read property "value" on string[39;22m

  at [32mtests\Feature\AdminWorkflowTest.php[39m:[32m43[39m
     39â–• 
     40â–•         $response = $this->actingAs($this->admin)
     41â–•                          ->postJson("/api/v1/admin/kyc-queue/{$kyc->id}/approve");
     42â–• 
  âžœ  43â–•         $response->assertStatus(200);
     44â–•         $this->assertDatabaseHas('user_kyc', [
     45â–•             'id' => $kyc->id,
     46â–•             'status' => 'verified'
     47â–•         ]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminWorkflowTest[22m [90m>[39m admin can approve and complete withdrawal      [41;1m InvalidArgumentException [49;22m  
[39;1m  Withdrawal amount must be positive.[39;22m

  at [32mapp\Models\Withdrawal.php[39m:[32m70[39m
     66â–•     protected static function booted()
     67â–•     {
     68â–•         static::saving(function ($withdrawal) {
     69â–•             if (($withdrawal->amount_paise ?? 0) <= 0) {
  âžœ  70â–•                 throw new \InvalidArgumentException("Withdrawal amount must be positive.");
     71â–•             }
     72â–•             if (empty($withdrawal->tds_deducted_paise)) {
     73â–•                 $withdrawal->tds_deducted_paise = 0;
     74â–•             }

  [33m1   [39m[39;1mapp\Models\Withdrawal.php[39;22m:[39;1m70[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\WebhookRetrySystemTest[22m [90m>[39m webhook can be marked as failed and scheduled for retry               
[39;1m  Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'pending'
+'max_retries_reached'[39;22m

  at [32mtests\Feature\WebhookRetrySystemTest.php[39m:[32m34[39m
     30â–•         ]);
     31â–• 
     32â–•         $webhookLog->markAsFailed('Test error', 500);
     33â–• 
  âžœ  34â–•         $this->assertEquals('pending', $webhookLog->fresh()->status);
     35â–•         $this->assertEquals(1, $webhookLog->fresh()->retry_count);
     36â–•         $this->assertNotNull($webhookLog->fresh()->next_retry_at);
     37â–•     }
     38â–•

  [33m1   [39m[39;1mtests\Feature\WebhookRetrySystemTest.php[39;22m:[39;1m34[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\RateLimitingTest[22m [90m>[39m rate limit blocks after max attempts                                        
[39;1m  Expected response status code [422] but received 429.
Failed asserting that 429 is identical to 422.[39;22m

  at [32mtests\Feature\RateLimitingTest.php[39m:[32m43[39m
     39â–•         for ($i = 0; $i < 5; $i++) {
     40â–•             $this->postJson('/api/v1/login', [
     41â–•                 'login' => 'attacker@example.com',
     42â–•                 'password' => 'wrong'
  âžœ  43â–•             ])->assertStatus(422);
     44â–•         }
     45â–• 
     46â–•         // 6th attempt should be blocked
     47â–•         $response = $this->postJson('/api/v1/login', [

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\RateLimitingTest[22m [90m>[39m rate limit allows within limit                                              
[39;1m  Expected response status code [422] but received 429.
Failed asserting that 429 is identical to 422.[39;22m

  at [32mtests\Feature\RateLimitingTest.php[39m:[32m31[39m
     27â–•                 'login' => 'attacker@example.com',
     28â–•                 'password' => 'wrong'
     29â–•             ]);
     30â–• 
  âžœ  31â–•             $response->assertStatus(422); // Validation Failed
     32â–•         }
     33â–•     }
     34â–• 
     35â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\RateLimitingTest[22m [90m>[39m rate limit resets after time window                                         
[39;1m  Expected response status code [422] but received 429.
Failed asserting that 429 is identical to 422.[39;22m

  at [32mtests\Feature\RateLimitingTest.php[39m:[32m85[39m
     81â–• 
     82â–•         // 7th attempt should now be allowed (and fail with 422, not 429)
     83â–•         $response = $this->postJson('/api/v1/login', ['login' => 'a']);
     84â–•         
  âžœ  85â–•         $response->assertStatus(422);
     86â–•         $response->assertHeader('X-RateLimit-Remaining', 4);
     87â–•     }
     88â–• }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserSupportEndpointsTest[22m [90m>[39m user can attach files to ticket                                     
[39;1m  Failed asserting that a row in the table [support_messages] matches the attributes {
    "attachments": "[\"support\\\/364\\\/proof.pdf\"]"
}.

Found: [
    {
        "attachments": "[\"support\\\/364\\\/d1e762d1-c0f1-4c9e-b665-5d8a64a37e6d.pdf\"]"
    }
].[39;22m

  at [32mtests\Feature\UserSupportEndpointsTest.php[39m:[32m129[39m
    125â–• 
    126â–•         $response = $this->actingAs($this->user)->postJson('/api/v1/user/support-tickets', $payload);
    127â–• 
    128â–•         $response->assertStatus(201);
  âžœ 129â–•         $this->assertDatabaseHas('support_messages', [
    130â–•             'attachments' => '["support\/' . $response->json('id') . '\/proof.pdf"]'
    131â–•         ]);
    132â–•     }
    133â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserSupportEndpointsTest[22m [90m>[39m user receives notification on reply                                 
[39;1m  Expected response status code [201] but received 500.
Failed asserting that 500 is identical to 201.

The following exception occurred during the last request:

Error: Call to undefined method App\Http\Controllers\Api\Admin\SupportTicketController::reply() in C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php:47
Stack trace:
#0 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(266): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\Api\Admin\SupportTicketController), 'reply')
#1 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(212): Illuminate\Routing\Route->runController()
#2 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(808): Illuminate\Routing\Route->run()
#3 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#4 C:\PreIPO\backend\app\Http\Middleware\CheckPermission.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#5 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckPermission->handle(Object(Illuminate\Http\Request), Object(Closure), 'users.edit')
#6 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Middleware\RoleMiddleware.php(37): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#7 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Spatie\Permission\Middleware\RoleMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin|super-adm...')
#8 C:\PreIPO\backend\app\Http\Middleware\AdminIpRestriction.php(43): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#9 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\AdminIpRestriction->handle(Object(Illuminate\Http\Request), Object(Closure))
#10 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(51): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#11 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#12 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(64): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#13 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#14 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#15 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(807): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#16 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(786): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#17 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(750): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#18 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(739): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#19 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(201): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#20 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#21 C:\PreIPO\backend\app\Http\Middleware\RedirectMiddleware.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#22 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\RedirectMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure))
#23 C:\PreIPO\backend\app\Http\Middleware\CheckMaintenanceMode.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#24 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckMaintenanceMode->handle(Object(Illuminate\Http\Request), Object(Closure))
#25 C:\PreIPO\backend\app\Http\Middleware\SanitizeInput.php(33): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#26 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\SanitizeInput->handle(Object(Illuminate\Http\Request), Object(Closure))
#27 C:\PreIPO\backend\app\Http\Middleware\ForceHttps.php(23): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#28 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\ForceHttps->handle(Object(Illuminate\Http\Request), Object(Closure))
#29 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#30 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#31 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#32 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#34 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#35 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#36 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#37 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(110): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(62): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#43 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#44 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#45 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#46 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#47 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#48 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(176): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#49 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(145): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#50 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#51 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/v1/admin/s...', Array, Array, Array, Array, '{"message":"Thi...')
#52 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/v1/admin/s...', Array, Array, 0)
#53 C:\PreIPO\backend\tests\Feature\UserSupportEndpointsTest.php(140): Illuminate\Foundation\Testing\TestCase->postJson('/api/v1/admin/s...', Array)
#54 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(1667): Tests\Feature\UserSupportEndpointsTest->testUserReceivesNotificationOnReply()
#55 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#56 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#57 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(365): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\UserSupportEndpointsTest))
#58 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#59 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#60 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#61 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#62 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#63 C:\PreIPO\backend\vendor\phpunit\phpunit\phpunit(104): PHPUnit\TextUI\Application->run(Array)
#64 {main}

----------------------------------------------------------------------------------

Call to undefined method App\Http\Controllers\Api\Admin\SupportTicketController::reply()[39;22m

  at [32mtests\Feature\UserSupportEndpointsTest.php[39m:[32m144[39m
    140â–•         $response = $this->actingAs($this->admin)->postJson("/api/v1/admin/support-tickets/{$ticket->id}/reply", [
    141â–•             'message' => 'This is an admin reply.'
    142â–•         ]);
    143â–• 
  âžœ 144â–•         $response->assertStatus(201);
    145â–•         Notification::assertSentTo($this->user, SupportReplyNotification::class);
    146â–•     }
    147â–• 
    148â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserSupportEndpointsTest[22m [90m>[39m user can rate ticket resolution                                     
[39;1m  Failed asserting that a row in the table [support_tickets] matches the attributes {
    "id": 368,
    "rating": 5,
    "rating_feedback": "Great service!"
}.

Found similar results: [
    {
        "id": 368,
        "rating": null,
        "rating_feedback": null
    }
].[39;22m

  at [32mtests\Feature\UserSupportEndpointsTest.php[39m:[32m159[39m
    155â–•             'rating_feedback' => 'Great service!'
    156â–•         ]);
    157â–• 
    158â–•         $response->assertStatus(200);
  âžœ 159â–•         $this->assertDatabaseHas('support_tickets', [
    160â–•             'id' => $ticket->id,
    161â–•             'rating' => 5,
    162â–•             'rating_feedback' => 'Great service!'
    163â–•         ]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m bonus records created with correct metadaâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7053 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m referral multiplier applied to all bonuseâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7054 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m payment success triggers all bonus calculâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7055 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m bonus notifications generated              [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7056 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m payment refund reverses bonuses            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7057 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m late payment skips consistency bonus       [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7058 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m bonuses correctly credited to wallet       [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7059 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mapp\Jobs\ProcessPaymentBonusJob.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PaymentToBonusIntegrationTest[22m [90m>[39m bonus calculation handles edge cases       [41;1m RuntimeException [49;22m  
[39;1m  Invalid payment state transition: 'pending' â†’ 'refunded'. Valid transitions from 'pending': [processing, paid, failed, cancelled][39;22m

  at [32mapp\Models\Payment.php[39m:[32m215[39m
    211â–•                         'new_status' => $newStatus,
    212â–•                         'valid_transitions' => self::VALID_TRANSITIONS[$oldStatus] ?? [],
    213â–•                     ]);
    214â–• 
  âžœ 215â–•                     throw new \RuntimeException(
    216â–•                         "Invalid payment state transition: '{$oldStatus}' â†’ '{$newStatus}'. " .
    217â–•                         "Valid transitions from '{$oldStatus}': [" .
    218â–•                         implode(', ', self::VALID_TRANSITIONS[$oldStatus] ?? []) . "]"
    219â–•                     );

  [33m1   [39m[39;1mapp\Models\Payment.php[39;22m:[39;1m215[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\WithdrawalRequestTest[22m [90m>[39m validates sufficient balance                                           
[39;1m  Failed to find a validation error in the response for key: 'amount'

Response does not have JSON validation errors.
Failed asserting that an array has the key 'amount'.

The following errors occurred during the last request:

{
    "message": "Insufficient wallet balance. (and 1 more error)",
    "errors": {
        "amount": [
            "Insufficient wallet balance.",
            "This withdrawal exceeds your daily limit of â‚¹50000."
        ]
    }
}[39;22m

  at [32mtests\Feature\WithdrawalRequestTest.php[39m:[32m71[39m
     67â–•             $this->getValidData(['amount' => 200000]) // Balance is 100,000
     68â–•         );
     69â–•         
     70â–•         $response->assertStatus(422)
  âžœ  71â–•                  ->assertJsonValidationErrors('amount', 'Insufficient wallet balance.');
     72â–•     }
     73â–• 
     74â–•     #[\PHPUnit\Framework\Attributes\Test]
     75â–•     public function test_validates_kyc_approved()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\WithdrawalRequestTest[22m [90m>[39m validates withdrawal limit per day               [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\WithdrawalService::__construct(), 0 passed in C:\PreIPO\backend\tests\Feature\WithdrawalRequestTest.php on line 102 and exactly 1 expected[39;22m

  at [32mapp\Services\WithdrawalService.php[39m:[32m81[39m
     77â–•  */
     78â–• class WithdrawalService
     79â–• {
     80â–•     protected $walletService;
  âžœ  81â–•     public function __construct(WalletService $walletService)
     82â–•     {
     83â–•         $this->walletService = $walletService;
     84â–•     }
     85â–•

  [33m1   [39m[39;1mapp\Services\WithdrawalService.php[39;22m:[39;1m81[39;22m
  [33m2   [39m[39;1mtests\Feature\WithdrawalRequestTest.php[39;22m:[39;1m102[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\OtpTest[22m [90m>[39m it rejects expired otp                                                               
[39;1m  Expected response status code [400] but received 200.
Failed asserting that 200 is identical to 400.[39;22m

  at [32mtests\Feature\OtpTest.php[39m:[32m85[39m
     81â–•             'type' => 'email',
     82â–•             'otp' => '123456'
     83â–•         ]);
     84â–• 
  âžœ  85â–•         $response->assertStatus(400)
     86â–•                  ->assertJson(['message' => 'Invalid or expired OTP.']);
     87â–•     }
     88â–• }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\OtpTest[22m [90m>[39m it verifies correct otp successfully                                                 
[39;1m  Unable to find JSON: 

[{
    "message": "Email verified successfully."
}]

within response JSON:

[{
    "message": "OTP Verified successfully."
}].


Failed asserting that an array has the subset Array &0 [
    'message' => 'Email verified successfully.',
].
--- Expected
+++ Actual
@@ @@
 array (
-  'message' => 'Email verified successfully.',
+  'message' => 'OTP Verified successfully.',
 )[39;22m

  at [32mtests\Feature\OtpTest.php[39m:[32m40[39m
     36â–•             'otp' => '123456'
     37â–•         ]);
     38â–• 
     39â–•         $response->assertStatus(200)
  âžœ  40â–•                  ->assertJson(['message' => 'Email verified successfully.']);
     41â–• 
     42â–•         $this->assertNotNull($user->fresh()->email_verified_at);
     43â–•     }
     44â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\OtpTest[22m [90m>[39m it rejects incorrect otp                                                             
[39;1m  Expected response status code [400] but received 200.
Failed asserting that 200 is identical to 400.[39;22m

  at [32mtests\Feature\OtpTest.php[39m:[32m63[39m
     59â–•             'type' => 'mobile',
     60â–•             'otp' => '999999' // Wrong code
     61â–•         ]);
     62â–• 
  âžœ  63â–•         $response->assertStatus(400)
     64â–•                  ->assertJson(['message' => 'Invalid or expired OTP.']);
     65â–•     }
     66â–• 
     67â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PermissionMiddlewareTest[22m [90m>[39m permission checks granular permissions    [41;1m BadMethodCallException [49;22m  
[39;1m  Call to undefined method App\Models\User::removePermissionTo()[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Support\Traits\ForwardsCalls.php[39m:[32m67[39m
     63â–•      * @throws \BadMethodCallException
     64â–•      */
     65â–•     protected static function throwBadMethodCallException($method)
     66â–•     {
  âžœ  67â–•         throw new BadMethodCallException(sprintf(
     68â–•             'Call to undefined method %s::%s()', static::class, $method
     69â–•         ));
     70â–•     }
     71â–• }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Traits\ForwardsCalls.php[39;22m:[39;1m67[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Traits\ForwardsCalls.php[39;22m:[39;1m36[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\PermissionMiddlewareTest[22m [90m>[39m permission logs unauthorized attempts     [41;1m BadMethodCallException [49;22m  
[39;1m  Received Mockery_7_Illuminate_Log_LogManager::error(), but no expectations were specified[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Foundation\Exceptions\Handler.php[39m:[32m380[39m
    376â–• 
    377â–•         $context = $this->buildExceptionContext($e);
    378â–• 
    379â–•         method_exists($logger, $level)
  âžœ 380â–•             ? $logger->{$level}($e->getMessage(), $context)
    381â–•             : $logger->log($level, $e->getMessage(), $context);
    382â–•     }
    383â–• 
    384â–•     /**

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Foundation\Exceptions\Handler.php[39;22m:[39;1m380[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Foundation\Exceptions\Handler.php[39;22m:[39;1m343[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProfitShareTest[22m [90m>[39m admin can calculate profit share                                             
[39;1m  Expected response status code [200] but received 403.
Failed asserting that 403 is identical to 200.[39;22m

  at [32mtests\Feature\ProfitShareTest.php[39m:[32m57[39m
     53â–•     {
     54â–•         $response = $this->actingAs($this->admin)
     55â–•                          ->postJson("/api/v1/admin/profit-sharing/{$this->period->id}/calculate");
     56â–• 
  âžœ  57â–•         $response->assertStatus(200);
     58â–•         
     59â–•         // Check distribution created
     60â–•         $this->assertDatabaseCount('user_profit_shares', 2);
     61â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProfitShareTest[22m [90m>[39m admin can distribute profit share                                            
[39;1m  Expected response status code [200] but received 403.
Failed asserting that 403 is identical to 200.[39;22m

  at [32mtests\Feature\ProfitShareTest.php[39m:[32m77[39m
     73â–•         // Distribute
     74â–•         $response = $this->actingAs($this->admin)
     75â–•                          ->postJson("/api/v1/admin/profit-sharing/{$this->period->id}/distribute");
     76â–• 
  âžœ  77â–•         $response->assertStatus(200);
     78â–•         
     79â–•         // Check wallets credited (â‚¹5000 = 500000 paise)
     80â–•         $this->assertDatabaseHas('wallets', ['balance_paise' => 500000]); // Approx split
     81â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycSubmitRequestTest[22m [90m>[39m validates document uploads                                     [41;1m Error [49;22m  
[39;1m  Call to undefined method Illuminate\Http\Testing\FileFactory::pdf()[39;22m

  at [32mtests\Feature\KycSubmitRequestTest.php[39m:[32m93[39m
     89â–•         $payload = $this->getValidData() + [
     90â–•             'aadhaar_front' => UploadedFile::fake()->image('front.jpg'),
     91â–•             'aadhaar_back' => UploadedFile::fake()->image('back.jpg'),
     92â–•             // 'pan' => UploadedFile::fake()->image('pan.jpg'), // Missing
  âžœ  93â–•             'bank_proof' => UploadedFile::fake()->pdf('bank.pdf'),
     94â–•             'demat_proof' => UploadedFile::fake()->pdf('demat.pdf'),
     95â–•         ];
     96â–•         $this->assertFalse(Validator::make($payload, $rules)->passes());
     97â–•

  [33m1   [39m[39;1mtests\Feature\KycSubmitRequestTest.php[39;22m:[39;1m93[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycSubmitRequestTest[22m [90m>[39m validates aadhaar format                                                
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\KycSubmitRequestTest.php[39m:[32m58[39m
     54â–•         // Fails: Letters
     55â–•         $this->assertFalse($this->validate($this->getValidData(['aadhaar_number' => '12345678901A']))->passes());
     56â–•         
     57â–•         // Passes: 12 digits no space
  âžœ  58â–•         $this->assertTrue($this->validate($this->getValidData(['aadhaar_number' => '123456789012']))->passes());
     59â–•         // Passes: 12 digits with spaces
     60â–•         $this->assertTrue($this->validate($this->getValidData(['aadhaar_number' => '1234 5678 9012']))->passes());
     61â–•     }
     62â–•

  [33m1   [39m[39;1mtests\Feature\KycSubmitRequestTest.php[39;22m:[39;1m58[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycSubmitRequestTest[22m [90m>[39m validates ifsc code format                                              
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\KycSubmitRequestTest.php[39m:[32m79[39m
     75â–•         // Fails: Lowercase
     76â–•         $this->assertFalse($this->validate($this->getValidData(['bank_ifsc' => 'hdfc0001234']))->passes());
     77â–•         
     78â–•         // Passes
  âžœ  79â–•         $this->assertTrue($this->validate($this->getValidData(['bank_ifsc' => 'SBIN0000123']))->passes());
     80â–•         $this->assertTrue($this->validate($this->getValidData(['bank_ifsc' => 'ICIC000ABCD']))->passes());
     81â–•     }
     82â–• 
     83â–•     public function test_validates_document_uploads()

  [33m1   [39m[39;1mtests\Feature\KycSubmitRequestTest.php[39;22m:[39;1m79[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycSubmitRequestTest[22m [90m>[39m validates pan format                                                    
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\KycSubmitRequestTest.php[39m:[32m47[39m
     43â–•         $this->assertFalse($this->validate($this->getValidData(['pan_number' => 'ABCDEO234F']))->passes());
     44â–•         // Fails: Lowercase
     45â–•         $this->assertFalse($this->validate($this->getValidData(['pan_number' => 'abcde1234f']))->passes());
     46â–•         // Passes
  âžœ  47â–•         $this->assertTrue($this->validate($this->getValidData(['pan_number' => 'GHIJK5678L']))->passes());
     48â–•     }
     49â–• 
     50â–•     public function test_validates_aadhaar_format()
     51â–•     {

  [33m1   [39m[39;1mtests\Feature\KycSubmitRequestTest.php[39;22m:[39;1m47[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProcessMonthlyLuckyDrawTest[22m [90m>[39m executes draw and selects winners                       [41;1m Error [49;22m  
[39;1m  Class "Tests\Feature\Mockery" not found[39;22m

  at [32mtests\Feature\ProcessMonthlyLuckyDrawTest.php[39m:[32m78[39m
     74â–•         $this->serviceMock->shouldReceive('createMonthlyDraw')->never(); // Shouldn't create
     75â–•         
     76â–•         $this->serviceMock->shouldReceive('selectWinners')
     77â–•             ->once()
  âžœ  78â–•             ->withArgs([Mockery::on(fn($d) => $d->id === $draw->id)])
     79â–•             ->andReturn($winnerList);
     80â–•             
     81â–•         $this->serviceMock->shouldReceive('distributePrizes')
     82â–•             ->once()

  [33m1   [39m[39;1mtests\Feature\ProcessMonthlyLuckyDrawTest.php[39;22m:[39;1m78[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProcessMonthlyLuckyDrawTest[22m [90m>[39m creates draw for current month                          [41;1m Error [49;22m  
[39;1m  Class "Tests\Feature\Mockery" not found[39;22m

  at [32mtests\Feature\ProcessMonthlyLuckyDrawTest.php[39m:[32m40[39m
     36â–•         $this->serviceMock->shouldReceive('createMonthlyDraw')
     37â–•             ->once()
     38â–•             ->with(
     39â–•                 'January 2025 Lucky Draw', // Name
  âžœ  40â–•                 Mockery::any(), // Date
     41â–•                 Mockery::type('array') // Prize Structure
     42â–•             );
     43â–•         
     44â–•         // 3. Act: Run the command

  [33m1   [39m[39;1mtests\Feature\ProcessMonthlyLuckyDrawTest.php[39;22m:[39;1m40[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProcessAutoDebitsTest[22m [90m>[39m retries failed payments                       [41;1m InvalidCountException [49;22m  
[39;1m  Method attemptAutoDebit(object(App\Models\Subscription)) from Mockery_9_App_Services_AutoDebitService should be called
 exactly 1 times but called 0 times.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProcessAutoDebitsTest[22m [90m>[39m sends reminder before due date                 [41;1m AssertionFailedError [49;22m  
[39;1m  Output "Found 0 subscriptions due." was not printed.[39;22m

  at [32mtests\Feature\ProcessAutoDebitsTest.php[39m:[32m116[39m
    112â–•         $this->artisan('app:process-auto-debits')
    113â–•              ->expectsOutput('Starting auto-debit process...')
    114â–•              ->expectsOutput('Found 0 subscriptions due.')
    115â–•              ->expectsOutput('Sent 3 payment reminders.')
  âžœ 116â–•              ->assertExitCode(0);
    117â–•     }
    118â–• 
    119â–•     public function test_suspends_subscription_after_max_failures()
    120â–•     {

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m admin can export users to csv                                        
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m745[39m
    741â–•     {
    742â–•         $response = $this->actingAs($this->admin)
    743â–•             ->get('/api/v1/admin/users/export');
    744â–• 
  âžœ 745â–•         $response->assertStatus(200)
    746â–•             ->assertHeader('Content-Type', 'text/csv; charset=UTF-8')
    747â–•             ->assertHeader('Content-Disposition', 'attachment; filename="users_export.csv"');
    748â–•     }
    749â–• }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m store creates associated records                                     
[39;1m  Expected response status code [201] but received 403.
Failed asserting that 403 is identical to 201.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m300[39m
    296â–• 
    297â–•         $response = $this->actingAs($this->admin)
    298â–•             ->postJson('/api/v1/admin/users', $userData);
    299â–• 
  âžœ 300â–•         $response->assertStatus(201);
    301â–•         $userId = $response->json('id');
    302â–• 
    303â–•         // Verify related records created
    304â–•         $this->assertDatabaseHas('user_profiles', ['user_id' => $userId]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m show returns stats summary                         [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`bonus_transactions`, CONSTRAINT `bonus_transactions_subscription_id_foreign` FOREIGN KEY (`subscription_id`) REFERENCES `subscriptions` (`id`) ON DELETE CASCADE) (Connection: mysql, SQL: insert into `bonus_transactions` (`user_id`, `subscription_id`, `payment_id`, `type`, `amount`, `multiplier_applied`, `tds_deducted`, `updated_at`, `created_at`) values (34144, 1, 1, consistency, 100, 1, 0, 2026-02-22 17:43:25, 2026-02-22 17:43:25))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`bonus_transactions`, CONSTRAINT `bonus_transactions_subscription_id_foreign` FOREIGN KEY (`subscription_id`) REFERENCES `subscriptions` (`id`) ON DELETE CASCADE)")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m admin can debit user wallet                                          
[39;1m  Expected response status code [200] but received 400.
Failed asserting that 400 is identical to 200.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m547[39m
    543â–•                 'amount' => 500,
    544â–•                 'description' => 'Fee adjustment'
    545â–•             ]);
    546â–• 
  âžœ 547â–•         $response->assertStatus(200);
    548â–•         $this->assertEquals(4500, $response->json('new_balance')); // 5000 - 500
    549â–•     }
    550â–• 
    551â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m show masks sensitive data                                            
[39;1m  Failed asserting that null matches expected '****234F'.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m134[39m
    130â–•         $response->assertStatus(200);
    131â–• 
    132â–•         // PAN should be masked (last 4 chars only)
    133â–•         $kyc = $response->json('kyc');
  âžœ 134â–•         $this->assertEquals('****234F', $kyc['pan_number']);
    135â–•     }
    136â–• 
    137â–•     #[\PHPUnit\Framework\Attributes\Test]
    138â–•     public function show_returns_controlled_response()

  [33m1   [39m[39;1mtests\Feature\AdminUserControllerTest.php[39;22m:[39;1m134[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m import skips duplicate users                                         
[39;1m  Expected response status code [200] but received 403.
Failed asserting that 403 is identical to 200.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m697[39m
    693â–•             ->postJson('/api/v1/admin/users/import', [
    694â–•                 'file' => $file
    695â–•             ]);
    696â–• 
  âžœ 697â–•         $response->assertStatus(200);
    698â–•         $this->assertEquals(0, $response->json('imported'));
    699â–•         $this->assertEquals(1, $response->json('skipped'));
    700â–•     }
    701â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m store validates mobile format                                        
[39;1m  Expected response status code [422] but received 403.
Failed asserting that 403 is identical to 422.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m282[39m
    278â–• 
    279â–•         $response = $this->actingAs($this->admin)
    280â–•             ->postJson('/api/v1/admin/users', $userData);
    281â–• 
  âžœ 282â–•         $response->assertStatus(422)
    283â–•             ->assertJsonValidationErrors(['mobile']);
    284â–•     }
    285â–• 
    286â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m import validates email format                                        
[39;1m  Expected response status code [200] but received 403.
Failed asserting that 403 is identical to 200.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m715[39m
    711â–•             ->postJson('/api/v1/admin/users/import', [
    712â–•                 'file' => $file
    713â–•             ]);
    714â–• 
  âžœ 715â–•         $response->assertStatus(200);
    716â–•         $this->assertEquals(0, $response->json('imported'));
    717â–•         $this->assertStringContainsString('Invalid email format', $response->json('errors')[0]);
    718â–•     }
    719â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m admin can import users from csv                                      
[39;1m  Expected response status code [200] but received 403.
Failed asserting that 403 is identical to 200.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m662[39m
    658â–•             ->postJson('/api/v1/admin/users/import', [
    659â–•                 'file' => $file
    660â–•             ]);
    661â–• 
  âžœ 662â–•         $response->assertStatus(200);
    663â–•         $this->assertDatabaseHas('users', ['username' => 'importuser1']);
    664â–•         $this->assertDatabaseHas('users', ['username' => 'importuser2']);
    665â–•     }
    666â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m store validates unique mobile                                        
[39;1m  Expected response status code [422] but received 403.
Failed asserting that 403 is identical to 422.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m264[39m
    260â–• 
    261â–•         $response = $this->actingAs($this->admin)
    262â–•             ->postJson('/api/v1/admin/users', $userData);
    263â–• 
  âžœ 264â–•         $response->assertStatus(422)
    265â–•             ->assertJsonValidationErrors(['mobile']);
    266â–•     }
    267â–• 
    268â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m store validates unique email                                         
[39;1m  Expected response status code [422] but received 403.
Failed asserting that 403 is identical to 422.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m239[39m
    235â–• 
    236â–•         $response = $this->actingAs($this->admin)
    237â–•             ->postJson('/api/v1/admin/users', $userData);
    238â–• 
  âžœ 239â–•         $response->assertStatus(422)
    240â–•             ->assertJsonValidationErrors(['email']);
    241â–• 
    242â–•         // Verify no duplicate user was created
    243â–•         $this->assertDatabaseMissing('users', [

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m store validates unique username                                      
[39;1m  Expected response status code [422] but received 403.
Failed asserting that 403 is identical to 422.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m220[39m
    216â–• 
    217â–•         $response = $this->actingAs($this->admin)
    218â–•             ->postJson('/api/v1/admin/users', $userData);
    219â–• 
  âžœ 220â–•         $response->assertStatus(422)
    221â–•             ->assertJsonValidationErrors(['username']);
    222â–•     }
    223â–• 
    224â–•     // [AUDIT FIX] Critical: Test creating user with existing email

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m admin can create user                                                
[39;1m  Expected response status code [201] but received 403.
Failed asserting that 403 is identical to 201.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m199[39m
    195â–• 
    196â–•         $response = $this->actingAs($this->admin)
    197â–•             ->postJson('/api/v1/admin/users', $userData);
    198â–• 
  âžœ 199â–•         $response->assertStatus(201);
    200â–•         $this->assertDatabaseHas('users', [
    201â–•             'username' => 'newuser123',
    202â–•             'email' => 'newuser@test.com'
    203â–•         ]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m debit fails for insufficient balance                                 
[39;1m  Unable to find JSON: 

[{
    "message": "Insufficient funds. Available: â‚¹5000"
}]

within response JSON:

[{
    "message": "SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `balance_paise_must_be_positive` failed for `preipo_test`.`wallets` (Connection: mysql, SQL: update `wallets` set `balance_paise` = `balance_paise` - 1000000, `wallets`.`updated_at` = 2026-02-22 17:43:44 where `id` = 36502)"
}].


Failed asserting that an array has the subset Array &0 [
    'message' => 'Insufficient funds. Available: â‚¹5000',
].
--- Expected
+++ Actual
@@ @@
 array (
-  'message' => 'Insufficient funds. Available: â‚¹5000',
+  'message' => 'SQLSTATE[23000]: Integrity constraint violation: 4025 CONSTRAINT `balance_paise_must_be_positive` failed for `preipo_test`.`wallets` (Connection: mysql, SQL: update `wallets` set `balance_paise` = `balance_paise` - 1000000, `wallets`.`updated_at` = 2026-02-22 17:43:44 where `id` = 36502)',
 )[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m562[39m
    558â–•                 'description' => 'Large debit'
    559â–•             ]);
    560â–• 
    561â–•         $response->assertStatus(400)
  âžœ 562â–•             ->assertJson(['message' => 'Insufficient funds. Available: â‚¹5000']);
    563â–•     }
    564â–• 
    565â–•     // ==================== BULK ACTION TESTS ====================
    566â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m import validates csv headers                                         
[39;1m  Expected response status code [422] but received 403.
Failed asserting that 403 is identical to 422.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m680[39m
    676â–•             ->postJson('/api/v1/admin/users/import', [
    677â–•                 'file' => $file
    678â–•             ]);
    679â–• 
  âžœ 680â–•         $response->assertStatus(422)
    681â–•             ->assertJsonFragment(['message' => "Missing required column: 'username'. Expected headers: username, email, mobile"]);
    682â–•     }
    683â–• 
    684â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m import validates mobile format                                       
[39;1m  Expected response status code [200] but received 403.
Failed asserting that 403 is identical to 200.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m733[39m
    729â–•             ->postJson('/api/v1/admin/users/import', [
    730â–•                 'file' => $file
    731â–•             ]);
    732â–• 
  âžœ 733â–•         $response->assertStatus(200);
    734â–•         $this->assertEquals(0, $response->json('imported'));
    735â–•         $this->assertStringContainsString('Invalid mobile format', $response->json('errors')[0]);
    736â–•     }
    737â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m show returns controlled response                                     
[39;1m  Failed asserting that an array does not have the key 'transactions'.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m156[39m
    152â–•         // Verify wallet shows only balance, not full transaction history
    153â–•         $wallet = $response->json('wallet');
    154â–•         $this->assertArrayHasKey('balance', $wallet);
    155â–•         $this->assertArrayHasKey('locked_balance', $wallet);
  âžœ 156â–•         $this->assertArrayNotHasKey('transactions', $wallet);
    157â–•     }
    158â–• 
    159â–•     #[\PHPUnit\Framework\Attributes\Test]
    160â–•     public function show_returns_stats_summary()

  [33m1   [39m[39;1mtests\Feature\AdminUserControllerTest.php[39;22m:[39;1m156[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminUserControllerTest[22m [90m>[39m admin can credit user wallet                                         
[39;1m  Failed asserting that 1000 matches expected 6000.[39;22m

  at [32mtests\Feature\AdminUserControllerTest.php[39m:[32m534[39m
    530â–•                 'description' => 'Promotional credit'
    531â–•             ]);
    532â–• 
    533â–•         $response->assertStatus(200);
  âžœ 534â–•         $this->assertEquals(6000, $response->json('new_balance')); // 5000 + 1000
    535â–•     }
    536â–• 
    537â–•     #[\PHPUnit\Framework\Attributes\Test]
    538â–•     public function admin_can_debit_user_wallet()

  [33m1   [39m[39;1mtests\Feature\AdminUserControllerTest.php[39;22m:[39;1m534[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m unblocked user can receive allocation again    [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'DataPro officia': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m no partial allocation on blocked user          [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'SmartSolutions autem': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m admin can view blocked users list                                  
[39;1m  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

Spatie\Permission\Exceptions\PermissionDoesNotExist: There is no permission named `compliance.view_legal` for guard `web`. in C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Exceptions\PermissionDoesNotExist.php:11
Stack trace:
#0 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Models\Permission.php(96): Spatie\Permission\Exceptions\PermissionDoesNotExist::create('compliance.view...', 'web')
#1 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Traits\HasPermissions.php(188): Spatie\Permission\Models\Permission::findByName('compliance.view...', 'web')
#2 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Traits\HasPermissions.php(215): App\Models\User->filterPermission('compliance.view...', NULL)
#3 C:\PreIPO\backend\app\Http\Middleware\CheckPermission.php(21): App\Models\User->hasPermissionTo('compliance.view...')
#4 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckPermission->handle(Object(Illuminate\Http\Request), Object(Closure), 'compliance.view...')
#5 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Middleware\RoleMiddleware.php(37): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#6 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Spatie\Permission\Middleware\RoleMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin|super-adm...')
#7 C:\PreIPO\backend\app\Http\Middleware\AdminIpRestriction.php(43): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#8 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\AdminIpRestriction->handle(Object(Illuminate\Http\Request), Object(Closure))
#9 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(51): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#10 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#11 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(64): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#12 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#13 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#14 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(807): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#15 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(786): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#16 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(750): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#17 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(739): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#18 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(201): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#19 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#20 C:\PreIPO\backend\app\Http\Middleware\RedirectMiddleware.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#21 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\RedirectMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure))
#22 C:\PreIPO\backend\app\Http\Middleware\CheckMaintenanceMode.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#23 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckMaintenanceMode->handle(Object(Illuminate\Http\Request), Object(Closure))
#24 C:\PreIPO\backend\app\Http\Middleware\SanitizeInput.php(33): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#25 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\SanitizeInput->handle(Object(Illuminate\Http\Request), Object(Closure))
#26 C:\PreIPO\backend\app\Http\Middleware\ForceHttps.php(23): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#27 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\ForceHttps->handle(Object(Illuminate\Http\Request), Object(Closure))
#28 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#29 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#30 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#31 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#32 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#33 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#34 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#35 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#36 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#37 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#38 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(110): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#39 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#40 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(62): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#41 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#42 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#43 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#44 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#45 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#46 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#47 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(176): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#48 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(145): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#49 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#50 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('GET', '/api/v1/admin/d...', Array, Array, Array, Array, '[]')
#51 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(381): Illuminate\Foundation\Testing\TestCase->json('GET', '/api/v1/admin/d...', Array, Array, 0)
#52 C:\PreIPO\backend\tests\Feature\BlockedUserInvestmentTest.php(190): Illuminate\Foundation\Testing\TestCase->getJson('/api/v1/admin/d...')
#53 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(1667): Tests\Feature\BlockedUserInvestmentTest->admin_can_view_blocked_users_list()
#54 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#55 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#56 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(365): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\BlockedUserInvestmentTest))
#57 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#58 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#59 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#60 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#61 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#62 C:\PreIPO\backend\vendor\phpunit\phpunit\phpunit(104): PHPUnit\TextUI\Application->run(Array)
#63 {main}

----------------------------------------------------------------------------------

There is no permission named `compliance.view_legal` for guard `web`.[39;22m

  at [32mtests\Feature\BlockedUserInvestmentTest.php[39m:[32m192[39m
    188â–• 
    189â–•         $response = $this->actingAs($adminUser, 'sanctum')
    190â–•             ->getJson('/api/v1/admin/disputes/blocked-users');
    191â–• 
  âžœ 192â–•         $response->assertStatus(200);
    193â–•         $response->assertJsonStructure([
    194â–•             'data' => [
    195â–•                 '*' => ['id', 'username', 'email', 'risk_score', 'is_blocked', 'blocked_reason']
    196â–•             ]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m blocked user cannot receive share allocation   [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'GreenEnergy porro': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m blocked user allocation does not mutate invenâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'HealthFirst maiores': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m guard detects recently blocked user            [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'DataPro architecto': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m blocked user cannot receive legacy allocation  [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'CloudNine adipisci': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\BlockedUserInvestmentTest[22m [90m>[39m non blocked user can receive allocation        [41;1m RuntimeException [49;22m  
[39;1m  Cannot activate product 'SmartSolutions aut': No available inventory. Please add bulk purchase inventory before activating this product.[39;22m

  at [32mapp\Models\Product.php[39m:[32m203[39m
    199â–•                     ->where('value_remaining', '>', 0)
    200â–•                     ->exists();
    201â–• 
    202â–•                 if (!$hasInventory) {
  âžœ 203â–•                     throw new \RuntimeException(
    204â–•                         "Cannot activate product '{$product->name}': No available inventory. " .
    205â–•                         "Please add bulk purchase inventory before activating this product."
    206â–•                     );
    207â–•                 }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m203[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AuthTest[22m [90m>[39m register sends otp email and sms                                                    
[39;1m  The expected [App\Jobs\SendOtpJob] job was pushed 0 times instead of 2 times.
Failed asserting that 0 is identical to 2.[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Support\Testing\Fakes\QueueFake.php[39m:[32m127[39m
    123â–•     protected function assertPushedTimes($job, $times = 1)
    124â–•     {
    125â–•         $count = $this->pushed($job)->count();
    126â–• 
  âžœ 127â–•         PHPUnit::assertSame(
    128â–•             $times, $count,
    129â–•             "The expected [{$job}] job was pushed {$count} times instead of {$times} times."
    130â–•         );
    131â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Testing\Fakes\QueueFake.php[39;22m:[39;1m127[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Testing\Fakes\QueueFake.php[39;22m:[39;1m107[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AuthTest[22m [90m>[39m register rejects invalid referral code                                              
[39;1m  Expected response status code [422] but received 429.
Failed asserting that 429 is identical to 422.[39;22m

  at [32mtests\Feature\AuthTest.php[39m:[32m191[39m
    187â–•             'accept_risk_disclosure' => true,
    188â–•             'accept_aml_kyc' => true,
    189â–•         ]);
    190â–• 
  âžœ 191â–•         $response->assertStatus(422)
    192â–•                  ->assertJsonValidationErrors(['referral_code']);
    193â–•     }
    194â–• 
    195â–•     // --- LOGIN TESTS ---

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AuthTest[22m [90m>[39m login rejects blocked account                                                       
[39;1m  Expected response status code [403] but received 429.
Failed asserting that 429 is identical to 403.[39;22m

  at [32mtests\Feature\AuthTest.php[39m:[32m280[39m
    276â–•             'login' => $user->email,
    277â–•             'password' => 'password'
    278â–•         ]);
    279â–• 
  âžœ 280â–•         $response->assertStatus(403)
    281â–•                  ->assertJsonFragment(['message' => 'Your account is not active. Please verify or contact support.']);
    282â–•     }
    283â–•     
    284â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProcessCelebrationBonusesTest[22m [90m>[39m identifies birthdays today and awards bonus                    
[39;1m  Failed asserting that a row in the table [bonus_transactions] matches the attributes {
    "user_id": 34235,
    "type": "celebration",
    "description": "Happy Birthday! Here is your bonus.",
    "amount": 50
}.

Found similar results: [
    {
        "user_id": 34235,
        "type": "celebration",
        "description": "Happy Birthday!",
        "amount": "50.00"
    },
    {
        "user_id": 34235,
        "type": "celebration",
        "description": "Happy 2 Year Anniversary!",
        "amount": "200.00"
    }
].[39;22m

  at [32mtests\Feature\ProcessCelebrationBonusesTest.php[39m:[32m83[39m
     79â–•         // Run the command
     80â–•         $this->artisan('app:process-celebration-bonuses');
     81â–• 
     82â–•         // Check User A (Birthday Today)
  âžœ  83â–•         $this->assertDatabaseHas('bonus_transactions', [
     84â–•             'user_id' => $this->userA->id,
     85â–•             'type' => 'celebration',
     86â–•             'description' => 'Happy Birthday! Here is your bonus.',
     87â–•             'amount' => 50 // From Plan A config

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ProcessCelebrationBonusesTest[22m [90m>[39m awards birthday bonus                                          
[39;1m  Failed asserting that 225 matches expected 250.[39;22m

  at [32mtests\Feature\ProcessCelebrationBonusesTest.php[39m:[32m106[39m
    102â–•         
    103â–•         $this->artisan('app:process-celebration-bonuses');
    104â–•         
    105â–•         // User A's wallet should have 50 (birthday) + 200 (anniversary) = 250
  âžœ 106â–•         $this->assertEquals(250, $this->userA->wallet->fresh()->balance);
    107â–•     }
    108â–• 
    109â–•     #[\PHPUnit\Framework\Attributes\Test]
    110â–•     public function test_identifies_subscription_anniversaries()

  [33m1   [39m[39;1mtests\Feature\ProcessCelebrationBonusesTest.php[39;22m:[39;1m106[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m get dashboard stats returns correct metrics                      
[39;1m  Unable to find JSON: 

[{
    "kpis": {
        "total_revenue": 1000,
        "total_users": 1,
        "pending_kyc": 1,
        "pending_withdrawals": 0
    }
}]

within response JSON:

[{
    "kpis": {
        "total_revenue": 0,
        "total_users": 1,
        "pending_kyc": 0,
        "pending_withdrawals": 0,
        "active_subscriptions": 0,
        "monthly_revenue": 0,
        "new_users_30d": 1,
        "pending_payments": 0,
        "payment_success_rate": 0,
        "arpu": 0,
        "churn_rate": 0,
        "total_aum": 0,
        "avg_investment": 0,
        "total_pending_approvals": 0
    },
    "charts": {
        "revenue_over_time": [],
        "user_growth": [
            {
                "date": "2026-02-22",
                "count": 1
            }
        ]
    },
    "recent_activity": [
        {
            "id": 34096,
            "type": "kyc",
            "user": {
                "id": 34243,
                "username": "salma92",
                "email": "zstroman@example.org",
                "role": "user",
                "is_admin": false,
                "roles": []
            },
            "description": "salma92 KYC verified",
            "amount": null,
            "created_at": "2026-02-22T17:44:08.000000Z"
        },
        {
            "id": 34097,
            "type": "kyc",
            "user": {
                "id": 34244,
                "username": "clemens20",
                "email": "dewayne.mitchell@example.com",
                "role": "user",
                "is_admin": false,
                "roles": []
            },
            "description": "clemens20 KYC verified",
            "amount": null,
            "created_at": "2026-02-22T17:44:08.000000Z"
        },
        {
            "id": 33932,
            "type": "kyc",
            "user": {
                "id": 34113,
                "username": "rowan.wolff",
                "email": "ronny83@example.org",
                "role": "admin",
                "is_admin": true,
                "roles": [
                    {
                        "id": 2,
                        "name": "admin",
                        "guard_name": "web",
                        "created_at": "2026-02-22T17:43:10.000000Z",
                        "updated_at": "2026-02-22T17:43:10.000000Z",
                        "pivot": {
                            "model_type": "App\\Models\\User",
                            "model_id": 34113,
                            "role_id": 2
                        }
                    }
                ]
            },
            "description": "rowan.wolff KYC verified",
            "amount": null,
            "created_at": "2026-02-22T17:43:10.000000Z"
        },
        {
            "id": 33931,
            "type": "kyc",
            "user": {
                "id": 34112,
                "username": "chauncey95",
                "email": "savannah64@example.com",
                "role": "user",
                "is_admin": false,
                "roles": []
            },
            "description": "chauncey95 KYC verified",
            "amount": null,
            "created_at": "2026-02-22T17:43:09.000000Z"
        },
        {
            "id": 33930,
            "type": "kyc",
            "user": {
                "id": 34111,
                "username": "jacobson.felipa",
                "email": "casper55@example.org",
                "role": "user",
                "is_admin": false,
                "roles": []
            },
            "description": "jacobson.felipa KYC verified",
            "amount": null,
            "created_at": "2026-02-22T17:43:07.000000Z"
        }
    ]
}].


Failed asserting that an array has the subset Array &0 [
    'kpis' => Array &1 [
        'total_revenue' => 1000,
        'total_users' => 1,
        'pending_kyc' => 1,
        'pending_withdrawals' => 0,
    ],
].
--- Expected
+++ Actual
@@ @@
 array (
   'kpis' => 
   array (
-    'total_revenue' => 1000,
+    'total_revenue' => 0,
     'total_users' => 1,
-    'pending_kyc' => 1,
+    'pending_kyc' => 0,
     'pending_withdrawals' => 0,
     'active_subscriptions' => 0,
     'monthly_revenue' => 0,[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m103[39m
     99â–•         
    100â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
    101â–•         
    102â–•         $response->assertStatus(200);
  âžœ 103â–•         $response->assertJson([
    104â–•             'kpis' => [
    105â–•                 'total_revenue' => 1000,
    106â–•                 'total_users' => 1, // $this->user
    107â–•                 'pending_kyc' => 1,

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m dashboard shows pending withdrawals                              
[39;1m  Failed asserting that 0 is identical to 1.[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m90[39m
     86â–•         Withdrawal::factory()->create(['status' => 'completed']);
     87â–•         
     88â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
     89â–•         
  âžœ  90â–•         $response->assertJsonPath('kpis.pending_withdrawals', 1);
     91â–•     }
     92â–• 
     93â–•     #[\PHPUnit\Framework\Attributes\Test]
     94â–•     public function testGetDashboardStatsReturnsCorrectMetrics()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m dashboard shows total users                                      
[39;1m  Failed asserting that 1 is identical to 11.[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m55[39m
     51â–•         
     52â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
     53â–•         
     54â–•         // 1 admin + 1 user + 10 users = 12 total users, 11 'user' role
  âžœ  55â–•         $response->assertJsonPath('kpis.total_users', 11);
     56â–•     }
     57â–• 
     58â–•     #[\PHPUnit\Framework\Attributes\Test]
     59â–•     public function testDashboardShowsTotalRevenue()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m dashboard shows pending kycs                                     
[39;1m  Failed asserting that 0 is identical to 2.[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m79[39m
     75â–•         UserKyc::factory()->create(['status' => 'verified']);
     76â–•         
     77â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
     78â–•         
  âžœ  79â–•         $response->assertJsonPath('kpis.pending_kyc', 2);
     80â–•     }
     81â–• 
     82â–•     #[\PHPUnit\Framework\Attributes\Test]
     83â–•     public function testDashboardShowsPendingWithdrawals()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m dashboard charts load correctly                                  
[39;1m  Failed to assert that the response count matched the expected 1
Failed asserting that actual size 0 matches expected size 1.[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m135[39m
    131â–• 
    132â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
    133â–•         
    134â–•         $response->assertStatus(200);
  âžœ 135â–•         $response->assertJsonCount(1, 'charts.revenue_over_time');
    136â–•         $response->assertJsonCount(1, 'charts.user_growth');
    137â–•         $response->assertJsonPath('charts.revenue_over_time.0.total', 1234);
    138â–•     }
    139â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m dashboard shows recent activity                                  
[39;1m  Failed to assert that the response count matched the expected 2
Failed asserting that actual size 5 matches expected size 2.[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m122[39m
    118â–• 
    119â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
    120â–• 
    121â–•         $response->assertStatus(200);
  âžœ 122â–•         $response->assertJsonCount(2, 'recent_activity');
    123â–•         $response->assertJsonPath('recent_activity.0.description', 'Payment failed'); // Latest first
    124â–•     }
    125â–• 
    126â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\AdminDashboardEndpointsTest[22m [90m>[39m dashboard shows total revenue                                    
[39;1m  Failed asserting that 0 is identical to 8000.[39;22m

  at [32mtests\Feature\AdminDashboardEndpointsTest.php[39m:[32m67[39m
     63â–•         Payment::factory()->create(['status' => 'pending', 'amount' => 1000]); // Should not be counted
     64â–•         
     65â–•         $response = $this->actingAs($this->admin)->getJson('/api/v1/admin/dashboard');
     66â–•         
  âžœ  67â–•         $response->assertJsonPath('kpis.total_revenue', 8000);
     68â–•     }
     69â–• 
     70â–•     #[\PHPUnit\Framework\Attributes\Test]
     71â–•     public function testDashboardShowsPendingKycs()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\RegisterRequestTest[22m [90m>[39m validates password complexity                                            
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\RegisterRequestTest.php[39m:[32m118[39m
    114â–•         // Fails: symbols
    115â–•         $this->assertFalse($this->validate($this->getValidData(['password' => 'Password123', 'password_confirmation' => 'Password123']))->passes());
    116â–• 
    117â–•         // Passes
  âžœ 118â–•         $this->assertTrue($this->validate($this->getValidData(['password' => 'Password123!', 'password_confirmation' => 'Password123!']))->passes());
    119â–•     }
    120â–• 
    121â–•     #[\PHPUnit\Framework\Attributes\Test]
    122â–•     public function test_validates_referral_code_if_provided()

  [33m1   [39m[39;1mtests\Feature\RegisterRequestTest.php[39;22m:[39;1m118[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\RegisterRequestTest[22m [90m>[39m validates referral code if provided                                      
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\RegisterRequestTest.php[39m:[32m125[39m
    121â–•     #[\PHPUnit\Framework\Attributes\Test]
    122â–•     public function test_validates_referral_code_if_provided()
    123â–•     {
    124â–•         // 1. Passes if null (it's nullable)
  âžœ 125â–•         $this->assertTrue($this->validate($this->getValidData(['referral_code' => null]))->passes());
    126â–• 
    127â–•         // 2. Fails if invalid
    128â–•         $this->assertFalse($this->validate($this->getValidData(['referral_code' => 'INVALIDCODE']))->passes());
    129â–•

  [33m1   [39m[39;1mtests\Feature\RegisterRequestTest.php[39;22m:[39;1m125[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\RegisterRequestTest[22m [90m>[39m validates username format                                                
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\RegisterRequestTest.php[39m:[32m62[39m
     58â–•         User::factory()->create(['username' => 'existing']);
     59â–•         $this->assertFalse($this->validate($this->getValidData(['username' => 'existing']))->passes());
     60â–• 
     61â–•         // Passes
  âžœ  62â–•         $this->assertTrue($this->validate($this->getValidData(['username' => 'valid_user-123']))->passes());
     63â–•     }
     64â–• 
     65â–•     #[\PHPUnit\Framework\Attributes\Test]
     66â–•     public function test_validates_email_format()

  [33m1   [39m[39;1mtests\Feature\RegisterRequestTest.php[39;22m:[39;1m62[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralCampaignControllerTest[22m [90m>[39m campaign multiplier precision is respected                    
[39;1m  Expected response status code [201] but received 200.
Failed asserting that 200 is identical to 201.[39;22m

  at [32mtests\Feature\ReferralCampaignControllerTest.php[39m:[32m410[39m
    406â–• 
    407â–•         $response = $this->actingAs($this->admin)
    408â–•             ->postJson('/api/v1/admin/referral-campaigns', $campaignData);
    409â–• 
  âžœ 410â–•         $response->assertStatus(201);
    411â–•         $this->assertDatabaseHas('referral_campaigns', [
    412â–•             'multiplier' => 1.25
    413â–•         ]);
    414â–•     }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralCampaignControllerTest[22m [90m>[39m store allows multiplier at maximum cap                        
[39;1m  Expected response status code [201] but received 200.
Failed asserting that 200 is identical to 201.[39;22m

  at [32mtests\Feature\ReferralCampaignControllerTest.php[39m:[32m165[39m
    161â–• 
    162â–•         $response = $this->actingAs($this->admin)
    163â–•             ->postJson('/api/v1/admin/referral-campaigns', $campaignData);
    164â–• 
  âžœ 165â–•         $response->assertStatus(201);
    166â–•     }
    167â–• 
    168â–•     #[\PHPUnit\Framework\Attributes\Test]
    169â–•     public function store_allows_bonus_at_maximum_cap()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralCampaignControllerTest[22m [90m>[39m admin can create referral campaign                            
[39;1m  Expected response status code [201] but received 200.
Failed asserting that 200 is identical to 201.[39;22m

  at [32mtests\Feature\ReferralCampaignControllerTest.php[39m:[32m78[39m
     74â–• 
     75â–•         $response = $this->actingAs($this->admin)
     76â–•             ->postJson('/api/v1/admin/referral-campaigns', $campaignData);
     77â–• 
  âžœ  78â–•         $response->assertStatus(201)
     79â–•             ->assertJsonFragment(['name' => 'Diwali Bonus Campaign']);
     80â–• 
     81â–•         $this->assertDatabaseHas('referral_campaigns', [
     82â–•             'name' => 'Diwali Bonus Campaign',

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralCampaignControllerTest[22m [90m>[39m store allows bonus at maximum cap                             
[39;1m  Expected response status code [201] but received 200.
Failed asserting that 200 is identical to 201.[39;22m

  at [32mtests\Feature\ReferralCampaignControllerTest.php[39m:[32m182[39m
    178â–• 
    179â–•         $response = $this->actingAs($this->admin)
    180â–•             ->postJson('/api/v1/admin/referral-campaigns', $campaignData);
    181â–• 
  âžœ 182â–•         $response->assertStatus(201);
    183â–•     }
    184â–• 
    185â–•     #[\PHPUnit\Framework\Attributes\Test]
    186â–•     public function store_validates_minimum_multiplier()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ReferralCampaignControllerTest[22m [90m>[39m cannot create campaign with unreasonable multiplier           
[39;1m  Expected response status code [201] but received 200.
Failed asserting that 200 is identical to 201.[39;22m

  at [32mtests\Feature\ReferralCampaignControllerTest.php[39m:[32m386[39m
    382â–•         $response = $this->actingAs($this->admin)
    383â–•             ->postJson('/api/v1/admin/referral-campaigns', $campaignData);
    384â–• 
    385â–•         // Should succeed at max values
  âžœ 386â–•         $response->assertStatus(201);
    387â–• 
    388â–•         // But one more should fail
    389â–•         $campaignData['multiplier'] = 5.01;
    390â–•         $response = $this->actingAs($this->admin)

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\GenerateSitemapTest[22m [90m>[39m generates sitemap xml                            [41;1m AssertionFailedError [49;22m  
[39;1m  Output "Generating sitemap..." was not printed.[39;22m

  at [32mtests\Feature\GenerateSitemapTest.php[39m:[32m47[39m
     43â–•         // Run the Artisan command
     44â–•         $this->artisan('sitemap:generate')
     45â–•              ->expectsOutput('Generating sitemap...')
     46â–•              ->expectsOutputToContain('sitemap.xml generated successfully')
  âžœ  47â–•              ->assertExitCode(0);
     48â–• 
     49â–•         // Check that the file was created
     50â–•         $this->assertFileExists($this->sitemapPath);
     51â–•     }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserProfileEndpointsTest[22m [90m>[39m update bank details validates ifsc format                           
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\UserProfileEndpointsTest.php[39m:[32m235[39m
    231â–•             'bank_account' => '1234567890123',
    232â–•             'bank_ifsc' => 'INVALIDIFSC', // Invalid IFSC format
    233â–•         ]);
    234â–• 
  âžœ 235â–•         $response->assertStatus(422);
    236â–•         $response->assertJsonValidationErrors('bank_ifsc');
    237â–•     }
    238â–• 
    239â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserProfileEndpointsTest[22m [90m>[39m get bank details returns user data                                  
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\UserProfileEndpointsTest.php[39m:[32m262[39m
    258â–•         ]);
    259â–• 
    260â–•         $response = $this->actingAs($this->user)->getJson('/api/v1/user/profile/bank-details');
    261â–• 
  âžœ 262â–•         $response->assertStatus(200);
    263â–•         $response->assertJson([
    264â–•             'bank_account' => '9876543210987',
    265â–•             'bank_ifsc' => 'ICIC0004567',
    266â–•         ]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserProfileEndpointsTest[22m [90m>[39m update bank details with valid data                                 
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\UserProfileEndpointsTest.php[39m:[32m217[39m
    213â–•             'bank_account' => '1234567890123',
    214â–•             'bank_ifsc' => 'HDFC0001234',
    215â–•         ]);
    216â–• 
  âžœ 217â–•         $response->assertStatus(200);
    218â–•         $response->assertJson(['message' => 'Bank details updated successfully']);
    219â–• 
    220â–•         $this->assertDatabaseHas('user_kyc', [
    221â–•             'user_id' => $this->user->id,

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\UserProfileEndpointsTest[22m [90m>[39m update bank details validates account number length                 
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\UserProfileEndpointsTest.php[39m:[32m247[39m
    243â–•             'bank_account' => '123', // Too short
    244â–•             'bank_ifsc' => 'HDFC0001234',
    245â–•         ]);
    246â–• 
  âžœ 247â–•         $response->assertStatus(422);
    248â–•         $response->assertJsonValidationErrors('bank_account');
    249â–•     }
    250â–• 
    251â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\CompanyDisclosureTierImmutabilityTest[22m [90m>[39m initial tier assignment on creation is allowâ€¦   
[39;1m  Failed asserting that null matches expected 'tier_1_upcoming'.[39;22m

  at [32mtests\Feature\Models\CompanyDisclosureTierImmutabilityTest.php[39m:[32m123[39m
    119â–•             'disclosure_tier' => DisclosureTier::TIER_1_UPCOMING->value,
    120â–•             'status' => 'active',
    121â–•         ]);
    122â–• 
  âžœ 123â–•         $this->assertEquals(DisclosureTier::TIER_1_UPCOMING->value, $company->disclosure_tier);
    124â–•     }
    125â–• 
    126â–•     /**
    127â–•      * Test modification is blocked even when disguised in larger update.

  [33m1   [39m[39;1mtests\Feature\Models\CompanyDisclosureTierImmutabilityTest.php[39;22m:[39;1m123[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\CompanyDisclosureTierImmutabilityTest[22m [90m>[39m fill and save modification is blocked           
[39;1m  Failed asserting that exception of type "App\Exceptions\DisclosureTierImmutabilityException" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\CompanyDisclosureTierImmutabilityTest[22m [90m>[39m update modification is blocked                  
[39;1m  Failed asserting that exception of type "App\Exceptions\DisclosureTierImmutabilityException" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\CompanyDisclosureTierImmutabilityTest[22m [90m>[39m modification blocked in larger update           
[39;1m  Failed asserting that exception of type "App\Exceptions\DisclosureTierImmutabilityException" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\CompanyDisclosureTierImmutabilityTest[22m [90m>[39m exception contains correct context              
[39;1m  Failed asserting that null matches expected 'tier_0_pending'.[39;22m

  at [32mtests\Feature\Models\CompanyDisclosureTierImmutabilityTest.php[39m:[32m152[39m
    148â–•             $this->company->save();
    149â–•             $this->fail('Expected DisclosureTierImmutabilityException was not thrown');
    150â–•         } catch (DisclosureTierImmutabilityException $e) {
    151â–•             $this->assertEquals((string) $this->company->id, $e->getCompanyId());
  âžœ 152â–•             $this->assertEquals(DisclosureTier::TIER_0_PENDING->value, $e->getCurrentTier());
    153â–•             $this->assertEquals(DisclosureTier::TIER_3_FEATURED->value, $e->getAttemptedTier());
    154â–•             $this->assertEquals(
    155â–•                 DisclosureTierImmutabilityException::VIOLATION_DIRECT_MODIFICATION,
    156â–•                 $e->getViolationType()

  [33m1   [39m[39;1mtests\Feature\Models\CompanyDisclosureTierImmutabilityTest.php[39;22m:[39;1m152[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m product by company disclosureâ€¦  [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company pending review scope                        
[39;1m  Failed asserting that actual size 4 matches expected size 2.[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m141[39m
    137â–•     public function test_company_pending_review_scope(): void
    138â–•     {
    139â–•         $pending = Company::withoutGlobalScope(PublicVisibilityScope::class)->pendingReview()->get();
    140â–• 
  âžœ 141â–•         $this->assertCount(2, $pending);
    142â–•         $this->assertTrue($pending->contains('id', $this->companyPending->id));
    143â–•         $this->assertTrue($pending->contains('id', $this->companyUpcoming->id));
    144â–•         $this->assertFalse($pending->contains('id', $this->companyLive->id));
    145â–•         $this->assertFalse($pending->contains('id', $this->companyFeatured->id));

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m141[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company is publicly visible by tier helper          
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m175[39m
    171â–•     public function test_company_is_publicly_visible_by_tier_helper(): void
    172â–•     {
    173â–•         $this->assertFalse($this->companyPending->isPubliclyVisibleByTier());
    174â–•         $this->assertFalse($this->companyUpcoming->isPubliclyVisibleByTier());
  âžœ 175â–•         $this->assertTrue($this->companyLive->isPubliclyVisibleByTier());
    176â–•         $this->assertTrue($this->companyFeatured->isPubliclyVisibleByTier());
    177â–•     }
    178â–• 
    179â–•     /**

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m175[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company at or above tier scope                      
[39;1m  Failed asserting that actual size 0 matches expected size 3.[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m102[39m
     98â–•     {
     99â–•         // At or above tier_1: should include tier_1, tier_2, tier_3
    100â–•         $aboveTier1 = Company::withoutGlobalScope(PublicVisibilityScope::class)
    101â–•             ->atOrAboveTier(DisclosureTier::TIER_1_UPCOMING)->get();
  âžœ 102â–•         $this->assertCount(3, $aboveTier1);
    103â–•         $this->assertFalse($aboveTier1->contains('id', $this->companyPending->id));
    104â–• 
    105â–•         // At or above tier_2: should include tier_2, tier_3
    106â–•         $aboveTier2 = Company::withoutGlobalScope(PublicVisibilityScope::class)

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m102[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m product is publicly visible byâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company get disclosure tier info helper             
[39;1m  Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'tier_2_live'
+'tier_0_pending'[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m186[39m
    182â–•     public function test_company_get_disclosure_tier_info_helper(): void
    183â–•     {
    184â–•         $info = $this->companyLive->getDisclosureTierInfo();
    185â–• 
  âžœ 186â–•         $this->assertEquals(DisclosureTier::TIER_2_LIVE->value, $info['current_tier']);
    187â–•         $this->assertEquals('Live', $info['current_tier_label']);
    188â–•         $this->assertEquals(2, $info['current_tier_rank']);
    189â–•         $this->assertTrue($info['is_publicly_visible']);
    190â–•         $this->assertTrue($info['is_investable']);

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m186[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m invariant no public visibilityâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m product get visibility statusâ€¦  [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m product from companies at or aâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company specific tier scopes                        
[39;1m  Failed asserting that actual size 0 matches expected size 1.[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m154[39m
    150â–•      */
    151â–•     public function test_company_specific_tier_scopes(): void
    152â–•     {
    153â–•         $upcoming = Company::withoutGlobalScope(PublicVisibilityScope::class)->upcoming()->get();
  âžœ 154â–•         $this->assertCount(1, $upcoming);
    155â–•         $this->assertEquals($this->companyUpcoming->id, $upcoming->first()->id);
    156â–• 
    157â–•         $live = Company::withoutGlobalScope(PublicVisibilityScope::class)->live()->get();
    158â–•         $this->assertCount(1, $live);

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m154[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m product publicly visible scope  [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company by disclosure tier scope                    
[39;1m  Failed asserting that actual size 4 matches expected size 1.[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m85[39m
     81â–•     public function test_company_by_disclosure_tier_scope(): void
     82â–•     {
     83â–•         $pending = Company::withoutGlobalScope(PublicVisibilityScope::class)
     84â–•             ->byDisclosureTier(DisclosureTier::TIER_0_PENDING)->get();
  âžœ  85â–•         $this->assertCount(1, $pending);
     86â–•         $this->assertEquals($this->companyPending->id, $pending->first()->id);
     87â–• 
     88â–•         $live = Company::withoutGlobalScope(PublicVisibilityScope::class)
     89â–•             ->byDisclosureTier(DisclosureTier::TIER_2_LIVE)->get();

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m85[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m company publicly visible scope                      
[39;1m  Failed asserting that actual size 0 matches expected size 2.[39;22m

  at [32mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39m:[32m71[39m
     67â–•         $visibleCompanies = Company::withoutGlobalScope(PublicVisibilityScope::class)
     68â–•             ->publiclyVisible()
     69â–•             ->get();
     70â–• 
  âžœ  71â–•         $this->assertCount(2, $visibleCompanies);
     72â–•         $this->assertTrue($visibleCompanies->contains('id', $this->companyLive->id));
     73â–•         $this->assertTrue($visibleCompanies->contains('id', $this->companyFeatured->id));
     74â–•         $this->assertFalse($visibleCompanies->contains('id', $this->companyPending->id));
     75â–•         $this->assertFalse($visibleCompanies->contains('id', $this->companyUpcoming->id));

  [33m1   [39m[39;1mtests\Feature\Models\DisclosureTierVisibilityScopeTest.php[39;22m:[39;1m71[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Models\DisclosureTierVisibilityScopeTest[22m [90m>[39m invariant product visibility mâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  LIFECYCLE VIOLATION: New products must start with 'draft' status. Attempted status: approved[39;22m

  at [32mapp\Models\Product.php[39m:[32m122[39m
    118â–•                     'attempted_status' => $product->status,
    119â–•                     'company_id' => $product->company_id,
    120â–•                 ]);
    121â–• 
  âžœ 122â–•                 throw new \RuntimeException(
    123â–•                     "LIFECYCLE VIOLATION: New products must start with 'draft' status. " .
    124â–•                     "Attempted status: {$product->status}"
    125â–•                 );
    126â–•             }

  [33m1   [39m[39;1mapp\Models\Product.php[39;22m:[39;1m122[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycTest[22m [90m>[39m admin can reject kyc with reason                                                     
[39;1m  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

ErrorException: Attempt to read property "value" on string in C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php:98
Stack trace:
#0 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Bootstrap\HandleExceptions.php(258): Illuminate\Foundation\Bootstrap\HandleExceptions->handleError(2, 'Attempt to read...', 'C:\\PreIPO\\backe...', 98)
#1 C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php(98): Illuminate\Foundation\Bootstrap\HandleExceptions->Illuminate\Foundation\Bootstrap\{closure}(2, 'Attempt to read...', 'C:\\PreIPO\\backe...', 98)
#2 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php(32): App\Services\Kyc\KycStatusService->App\Services\Kyc\{closure}(Object(Illuminate\Database\MySqlConnection))
#3 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php(495): Illuminate\Database\Connection->transaction(Object(Closure))
#4 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php(361): Illuminate\Database\DatabaseManager->__call('transaction', Array)
#5 C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php(60): Illuminate\Support\Facades\Facade::__callStatic('transaction', Array)
#6 C:\PreIPO\backend\app\Http\Controllers\Api\Admin\KycQueueController.php(171): App\Services\Kyc\KycStatusService->transitionTo(Object(App\Models\UserKyc), Object(App\Enums\KycStatus), Array)
#7 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php(32): App\Http\Controllers\Api\Admin\KycQueueController->App\Http\Controllers\Api\Admin\{closure}(Object(Illuminate\Database\MySqlConnection))
#8 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php(495): Illuminate\Database\Connection->transaction(Object(Closure))
#9 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php(361): Illuminate\Database\DatabaseManager->__call('transaction', Array)
#10 C:\PreIPO\backend\app\Http\Controllers\Api\Admin\KycQueueController.php(168): Illuminate\Support\Facades\Facade::__callStatic('transaction', Array)
#11 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(47): App\Http\Controllers\Api\Admin\KycQueueController->reject(Object(Illuminate\Http\Request), '34236')
#12 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(266): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\Api\Admin\KycQueueController), 'reject')
#13 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(212): Illuminate\Routing\Route->runController()
#14 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(808): Illuminate\Routing\Route->run()
#15 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#16 C:\PreIPO\backend\app\Http\Middleware\CheckPermission.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckPermission->handle(Object(Illuminate\Http\Request), Object(Closure), 'kyc.reject')
#18 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Middleware\RoleMiddleware.php(37): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#19 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Spatie\Permission\Middleware\RoleMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin|super-adm...')
#20 C:\PreIPO\backend\app\Http\Middleware\AdminIpRestriction.php(43): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#21 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\AdminIpRestriction->handle(Object(Illuminate\Http\Request), Object(Closure))
#22 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(51): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#23 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#24 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(161): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#25 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(127): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#26 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(89): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'admin-actions', Object(Closure))
#27 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin-actions')
#28 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(64): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#29 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#30 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#31 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(807): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#32 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(786): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#33 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(750): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#34 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(739): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#35 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(201): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#36 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#37 C:\PreIPO\backend\app\Http\Middleware\RedirectMiddleware.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\RedirectMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 C:\PreIPO\backend\app\Http\Middleware\CheckMaintenanceMode.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckMaintenanceMode->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 C:\PreIPO\backend\app\Http\Middleware\SanitizeInput.php(33): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\SanitizeInput->handle(Object(Illuminate\Http\Request), Object(Closure))
#43 C:\PreIPO\backend\app\Http\Middleware\ForceHttps.php(23): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#44 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\ForceHttps->handle(Object(Illuminate\Http\Request), Object(Closure))
#45 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#46 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#47 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#48 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#49 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#50 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#51 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#52 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#53 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#54 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#55 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(110): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#56 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#57 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(62): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#58 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#59 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#60 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#61 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#62 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#63 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#64 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(176): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#65 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(145): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#66 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#67 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/v1/admin/k...', Array, Array, Array, Array, '{"reason":"Blur...')
#68 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/v1/admin/k...', Array, Array, 0)
#69 C:\PreIPO\backend\tests\Feature\KycTest.php(86): Illuminate\Foundation\Testing\TestCase->postJson('/api/v1/admin/k...', Array)
#70 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(1667): Tests\Feature\KycTest->admin_can_reject_kyc_with_reason()
#71 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#72 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#73 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(365): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KycTest))
#74 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#75 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#76 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#77 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#78 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#79 C:\PreIPO\backend\vendor\phpunit\phpunit\phpunit(104): PHPUnit\TextUI\Application->run(Array)
#80 {main}

----------------------------------------------------------------------------------

Attempt to read property "value" on string[39;22m

  at [32mtests\Feature\KycTest.php[39m:[32m90[39m
     86â–•                          ->postJson("/api/v1/admin/kyc-queue/{$kyc->id}/reject", [
     87â–•                              'reason' => 'Blurry photos'
     88â–•                          ]);
     89â–• 
  âžœ  90â–•         $response->assertStatus(200);
     91â–•         $this->assertDatabaseHas('user_kyc', [
     92â–•             'id' => $kyc->id,
     93â–•             'status' => 'rejected',
     94â–•             'rejection_reason' => 'Blurry photos'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycTest[22m [90m>[39m admin can approve kyc                                                                
[39;1m  Expected response status code [200] but received 500.
Failed asserting that 500 is identical to 200.

The following exception occurred during the last request:

ErrorException: Attempt to read property "value" on string in C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php:98
Stack trace:
#0 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Bootstrap\HandleExceptions.php(258): Illuminate\Foundation\Bootstrap\HandleExceptions->handleError(2, 'Attempt to read...', 'C:\\PreIPO\\backe...', 98)
#1 C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php(98): Illuminate\Foundation\Bootstrap\HandleExceptions->Illuminate\Foundation\Bootstrap\{closure}(2, 'Attempt to read...', 'C:\\PreIPO\\backe...', 98)
#2 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php(32): App\Services\Kyc\KycStatusService->App\Services\Kyc\{closure}(Object(Illuminate\Database\MySqlConnection))
#3 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php(495): Illuminate\Database\Connection->transaction(Object(Closure))
#4 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php(361): Illuminate\Database\DatabaseManager->__call('transaction', Array)
#5 C:\PreIPO\backend\app\Services\Kyc\KycStatusService.php(60): Illuminate\Support\Facades\Facade::__callStatic('transaction', Array)
#6 C:\PreIPO\backend\app\Http\Controllers\Api\Admin\KycQueueController.php(119): App\Services\Kyc\KycStatusService->transitionTo(Object(App\Models\UserKyc), Object(App\Enums\KycStatus), Array)
#7 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Concerns\ManagesTransactions.php(32): App\Http\Controllers\Api\Admin\KycQueueController->App\Http\Controllers\Api\Admin\{closure}(Object(Illuminate\Database\MySqlConnection))
#8 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\DatabaseManager.php(495): Illuminate\Database\Connection->transaction(Object(Closure))
#9 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php(361): Illuminate\Database\DatabaseManager->__call('transaction', Array)
#10 C:\PreIPO\backend\app\Http\Controllers\Api\Admin\KycQueueController.php(115): Illuminate\Support\Facades\Facade::__callStatic('transaction', Array)
#11 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\ControllerDispatcher.php(47): App\Http\Controllers\Api\Admin\KycQueueController->approve(Object(Illuminate\Http\Request), '34239')
#12 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(266): Illuminate\Routing\ControllerDispatcher->dispatch(Object(Illuminate\Routing\Route), Object(App\Http\Controllers\Api\Admin\KycQueueController), 'approve')
#13 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Route.php(212): Illuminate\Routing\Route->runController()
#14 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(808): Illuminate\Routing\Route->run()
#15 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Routing\Router->Illuminate\Routing\{closure}(Object(Illuminate\Http\Request))
#16 C:\PreIPO\backend\app\Http\Middleware\CheckPermission.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#17 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckPermission->handle(Object(Illuminate\Http\Request), Object(Closure), 'kyc.approve')
#18 C:\PreIPO\backend\vendor\spatie\laravel-permission\src\Middleware\RoleMiddleware.php(37): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#19 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Spatie\Permission\Middleware\RoleMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin|super-adm...')
#20 C:\PreIPO\backend\app\Http\Middleware\AdminIpRestriction.php(43): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#21 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\AdminIpRestriction->handle(Object(Illuminate\Http\Request), Object(Closure))
#22 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\SubstituteBindings.php(51): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#23 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\SubstituteBindings->handle(Object(Illuminate\Http\Request), Object(Closure))
#24 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(161): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#25 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(127): Illuminate\Routing\Middleware\ThrottleRequests->handleRequest(Object(Illuminate\Http\Request), Object(Closure), Array)
#26 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Middleware\ThrottleRequests.php(89): Illuminate\Routing\Middleware\ThrottleRequests->handleRequestUsingNamedLimiter(Object(Illuminate\Http\Request), Object(Closure), 'admin-actions', Object(Closure))
#27 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Routing\Middleware\ThrottleRequests->handle(Object(Illuminate\Http\Request), Object(Closure), 'admin-actions')
#28 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Auth\Middleware\Authenticate.php(64): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#29 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Auth\Middleware\Authenticate->handle(Object(Illuminate\Http\Request), Object(Closure), 'sanctum')
#30 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#31 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(807): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#32 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(786): Illuminate\Routing\Router->runRouteWithinStack(Object(Illuminate\Routing\Route), Object(Illuminate\Http\Request))
#33 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(750): Illuminate\Routing\Router->runRoute(Object(Illuminate\Http\Request), Object(Illuminate\Routing\Route))
#34 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Routing\Router.php(739): Illuminate\Routing\Router->dispatchToRoute(Object(Illuminate\Http\Request))
#35 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(201): Illuminate\Routing\Router->dispatch(Object(Illuminate\Http\Request))
#36 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(170): Illuminate\Foundation\Http\Kernel->Illuminate\Foundation\Http\{closure}(Object(Illuminate\Http\Request))
#37 C:\PreIPO\backend\app\Http\Middleware\RedirectMiddleware.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#38 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\RedirectMiddleware->handle(Object(Illuminate\Http\Request), Object(Closure))
#39 C:\PreIPO\backend\app\Http\Middleware\CheckMaintenanceMode.php(48): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#40 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\CheckMaintenanceMode->handle(Object(Illuminate\Http\Request), Object(Closure))
#41 C:\PreIPO\backend\app\Http\Middleware\SanitizeInput.php(33): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#42 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\SanitizeInput->handle(Object(Illuminate\Http\Request), Object(Closure))
#43 C:\PreIPO\backend\app\Http\Middleware\ForceHttps.php(23): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#44 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): App\Http\Middleware\ForceHttps->handle(Object(Illuminate\Http\Request), Object(Closure))
#45 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#46 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#47 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#48 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull.php(31): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#49 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull->handle(Object(Illuminate\Http\Request), Object(Closure))
#50 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TransformsRequest.php(21): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#51 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\TrimStrings.php(51): Illuminate\Foundation\Http\Middleware\TransformsRequest->handle(Object(Illuminate\Http\Request), Object(Closure))
#52 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\TrimStrings->handle(Object(Illuminate\Http\Request), Object(Closure))
#53 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\ValidatePostSize.php(27): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#54 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\ValidatePostSize->handle(Object(Illuminate\Http\Request), Object(Closure))
#55 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance.php(110): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#56 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\PreventRequestsDuringMaintenance->handle(Object(Illuminate\Http\Request), Object(Closure))
#57 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\HandleCors.php(62): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#58 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\HandleCors->handle(Object(Illuminate\Http\Request), Object(Closure))
#59 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Http\Middleware\TrustProxies.php(58): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#60 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Http\Middleware\TrustProxies->handle(Object(Illuminate\Http\Request), Object(Closure))
#61 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks.php(22): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#62 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(209): Illuminate\Foundation\Http\Middleware\InvokeDeferredCallbacks->handle(Object(Illuminate\Http\Request), Object(Closure))
#63 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Pipeline\Pipeline.php(127): Illuminate\Pipeline\Pipeline->Illuminate\Pipeline\{closure}(Object(Illuminate\Http\Request))
#64 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(176): Illuminate\Pipeline\Pipeline->then(Object(Closure))
#65 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Http\Kernel.php(145): Illuminate\Foundation\Http\Kernel->sendRequestThroughRouter(Object(Illuminate\Http\Request))
#66 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(607): Illuminate\Foundation\Http\Kernel->handle(Object(Illuminate\Http\Request))
#67 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(573): Illuminate\Foundation\Testing\TestCase->call('POST', '/api/v1/admin/k...', Array, Array, Array, Array, '[]')
#68 C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Foundation\Testing\Concerns\MakesHttpRequests.php(411): Illuminate\Foundation\Testing\TestCase->json('POST', '/api/v1/admin/k...', Array, Array, 0)
#69 C:\PreIPO\backend\tests\Feature\KycTest.php(70): Illuminate\Foundation\Testing\TestCase->postJson('/api/v1/admin/k...')
#70 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(1667): Tests\Feature\KycTest->admin_can_approve_kyc()
#71 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(519): PHPUnit\Framework\TestCase->runTest()
#72 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestRunner\TestRunner.php(87): PHPUnit\Framework\TestCase->runBare()
#73 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestCase.php(365): PHPUnit\Framework\TestRunner->run(Object(Tests\Feature\KycTest))
#74 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestCase->run()
#75 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#76 C:\PreIPO\backend\vendor\phpunit\phpunit\src\Framework\TestSuite.php(369): PHPUnit\Framework\TestSuite->run()
#77 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\TestRunner.php(64): PHPUnit\Framework\TestSuite->run()
#78 C:\PreIPO\backend\vendor\phpunit\phpunit\src\TextUI\Application.php(211): PHPUnit\TextUI\TestRunner->run(Object(PHPUnit\TextUI\Configuration\Configuration), Object(PHPUnit\Runner\ResultCache\DefaultResultCache), Object(PHPUnit\Framework\TestSuite))
#79 C:\PreIPO\backend\vendor\phpunit\phpunit\phpunit(104): PHPUnit\TextUI\Application->run(Array)
#80 {main}

----------------------------------------------------------------------------------

Attempt to read property "value" on string[39;22m

  at [32mtests\Feature\KycTest.php[39m:[32m72[39m
     68â–• 
     69â–•         $response = $this->actingAs($this->admin)
     70â–•                          ->postJson("/api/v1/admin/kyc-queue/{$kyc->id}/approve");
     71â–• 
  âžœ  72â–•         $response->assertStatus(200);
     73â–•         $this->assertDatabaseHas('user_kyc', [
     74â–•             'id' => $kyc->id,
     75â–•             'status' => 'verified'
     76â–•         ]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\KycTest[22m [90m>[39m user can upload kyc documents                                               [41;1m Error [49;22m  
[39;1m  Call to undefined method Illuminate\Http\Testing\FileFactory::pdf()[39;22m

  at [32mtests\Feature\KycTest.php[39m:[32m47[39m
     43â–•                              // Fake files
     44â–•                              'pan' => UploadedFile::fake()->image('pan.jpg'),
     45â–•                              'aadhaar_front' => UploadedFile::fake()->image('front.jpg'),
     46â–•                              'aadhaar_back' => UploadedFile::fake()->image('back.jpg'),
  âžœ  47â–•                              'bank_proof' => UploadedFile::fake()->pdf('bank.pdf'),
     48â–•                              'demat_proof' => UploadedFile::fake()->pdf('demat.pdf'),
     49â–•                          ]);
     50â–• 
     51â–•         $response->assertStatus(201);

  [33m1   [39m[39;1mtests\Feature\KycTest.php[39;22m:[39;1m47[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m promote to next tier convenience method            
[39;1m  App\Enums\DisclosureTier Enum (TIER_1_UPCOMING, 'tier_1_upcoming') does not match expected type "string".[39;22m

  at [32mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39m:[32m186[39m
    182â–•             $this->adminUser,
    183â–•             'Progressing to next tier'
    184â–•         );
    185â–• 
  âžœ 186â–•         $this->assertEquals(DisclosureTier::TIER_1_UPCOMING->value, $result->disclosure_tier);
    187â–•     }
    188â–• 
    189â–•     /**
    190â–•      * Test promoteToNextTier fails at maximum tier.

  [33m1   [39m[39;1mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39;22m:[39;1m186[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m promote tier 0 to tier 1 succeeds                  
[39;1m  App\Enums\DisclosureTier Enum (TIER_1_UPCOMING, 'tier_1_upcoming') does not match expected type "string".[39;22m

  at [32mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39m:[32m66[39m
     62â–•             $this->adminUser,
     63â–•             'Disclosure submission received'
     64â–•         );
     65â–• 
  âžœ  66â–•         $this->assertEquals(DisclosureTier::TIER_1_UPCOMING->value, $result->disclosure_tier);
     67â–•         $this->company->refresh();
     68â–•         $this->assertEquals(DisclosureTier::TIER_1_UPCOMING->value, $this->company->disclosure_tier);
     69â–•     }
     70â–•

  [33m1   [39m[39;1mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39;22m:[39;1m66[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m validation requirements for tier 2    [41;1m TypeError [49;22m  
[39;1m  App\Enums\DisclosureTier::tryFrom(): Argument #1 ($value) must be of type string|int, App\Enums\DisclosureTier given[39;22m

  at [32mapp\Services\CompanyDisclosureTierService.php[39m:[32m205[39m
    201â–•      */
    202â–•     public function getCurrentTier(Company $company): DisclosureTier
    203â–•     {
    204â–•         $value = $company->disclosure_tier ?? DisclosureTier::TIER_0_PENDING->value;
  âžœ 205â–•         $tier = DisclosureTier::tryFrom($value);
    206â–• 
    207â–•         if ($tier === null) {
    208â–•             Log::warning('Company has invalid disclosure_tier value', [
    209â–•                 'company_id' => $company->id,

  [33m1   [39m[39;1mapp\Services\CompanyDisclosureTierService.php[39;22m:[39;1m205[39;22m
  [33m2   [39m[39;1mapp\Services\CompanyDisclosureTierService.php[39;22m:[39;1m342[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m is publicly visible returns correctâ€¦  [41;1m TypeError [49;22m  
[39;1m  App\Enums\DisclosureTier::tryFrom(): Argument #1 ($value) must be of type string|int, App\Enums\DisclosureTier given[39;22m

  at [32mapp\Services\CompanyDisclosureTierService.php[39m:[32m205[39m
    201â–•      */
    202â–•     public function getCurrentTier(Company $company): DisclosureTier
    203â–•     {
    204â–•         $value = $company->disclosure_tier ?? DisclosureTier::TIER_0_PENDING->value;
  âžœ 205â–•         $tier = DisclosureTier::tryFrom($value);
    206â–• 
    207â–•         if ($tier === null) {
    208â–•             Log::warning('Company has invalid disclosure_tier value', [
    209â–•                 'company_id' => $company->id,

  [33m1   [39m[39;1mapp\Services\CompanyDisclosureTierService.php[39;22m:[39;1m205[39;22m
  [33m2   [39m[39;1mapp\Services\CompanyDisclosureTierService.php[39;22m:[39;1m223[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m closure promotion succeeds through service         
[39;1m  Failed asserting that null matches expected 'tier_0_pending'.[39;22m

  at [32mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39m:[32m292[39m
    288â–•      * Verifies DB::table() bypass works correctly.
    289â–•      */
    290â–•     public function test_closure_promotion_succeeds_through_service(): void
    291â–•     {
  âžœ 292â–•         $this->assertEquals(DisclosureTier::TIER_0_PENDING->value, $this->company->disclosure_tier);
    293â–• 
    294â–•         $result = $this->service->promote(
    295â–•             $this->company,
    296â–•             DisclosureTier::TIER_1_UPCOMING,

  [33m1   [39m[39;1mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39;22m:[39;1m292[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m tier skip is rejected                              
[39;1m  Failed asserting that exception message 'Disclosure tier immutability violation on Company ID: 6512. Tier skipping is forbidden. Must promote one tier at a time. Current: 'tier_0_pending', Attempted: 'tier_2_live'.' contains 'tier skipping is forbidden'.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m closure public queries exclude non public tiers    
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39m:[32m368[39m
    364â–•             ->get();
    365â–• 
    366â–•         $this->assertFalse($publicCompanies->contains('id', $tier0->id));
    367â–•         $this->assertFalse($publicCompanies->contains('id', $tier1->id));
  âžœ 368â–•         $this->assertTrue($publicCompanies->contains('id', $tier2->id));
    369â–•         $this->assertTrue($publicCompanies->contains('id', $tier3->id));
    370â–•     }
    371â–• }
    372â–•

  [33m1   [39m[39;1mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39;22m:[39;1m368[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m promote tier 2 to tier 3 succeeds     [41;1m TypeError [49;22m  
[39;1m  App\Enums\DisclosureTier::tryFrom(): Argument #1 ($value) must be of type string|int, App\Enums\DisclosureTier given[39;22m

  at [32mapp\Services\CompanyDisclosureTierService.php[39m:[32m64[39m
     60â–•         array $metadata = []
     61â–•     ): Company {
     62â–•         // Get current tier as enum
     63â–•         $currentTierValue = $company->disclosure_tier ?? DisclosureTier::TIER_0_PENDING->value;
  âžœ  64â–•         $currentTier = DisclosureTier::tryFrom($currentTierValue);
     65â–• 
     66â–•         if ($currentTier === null) {
     67â–•             throw DisclosureTierImmutabilityException::invalidTier(
     68â–•                 (string) $company->id,

  [33m1   [39m[39;1mapp\Services\CompanyDisclosureTierService.php[39;22m:[39;1m64[39;22m
  [33m2   [39m[39;1mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39;22m:[39;1m110[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m get current tier returns correct enuâ€¦ [41;1m TypeError [49;22m  
[39;1m  App\Enums\DisclosureTier::tryFrom(): Argument #1 ($value) must be of type string|int, App\Enums\DisclosureTier given[39;22m

  at [32mapp\Services\CompanyDisclosureTierService.php[39m:[32m205[39m
    201â–•      */
    202â–•     public function getCurrentTier(Company $company): DisclosureTier
    203â–•     {
    204â–•         $value = $company->disclosure_tier ?? DisclosureTier::TIER_0_PENDING->value;
  âžœ 205â–•         $tier = DisclosureTier::tryFrom($value);
    206â–• 
    207â–•         if ($tier === null) {
    208â–•             Log::warning('Company has invalid disclosure_tier value', [
    209â–•                 'company_id' => $company->id,

  [33m1   [39m[39;1mapp\Services\CompanyDisclosureTierService.php[39;22m:[39;1m205[39;22m
  [33m2   [39m[39;1mtests\Feature\Services\CompanyDisclosureTierServiceTest.php[39;22m:[39;1m224[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m downgrade is rejected                              
[39;1m  Failed asserting that exception of type "TypeError" matches expected exception "App\Exceptions\DisclosureTierImmutabilityException". Message was: "App\Enums\DisclosureTier::tryFrom(): Argument #1 ($value) must be of type string|int, App\Enums\DisclosureTier given" at
C:\PreIPO\backend\app\Services\CompanyDisclosureTierService.php:64
C:\PreIPO\backend\tests\Feature\Services\CompanyDisclosureTierServiceTest.php:152
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m promote to next tier fails at maximum              
[39;1m  Failed asserting that exception of type "TypeError" matches expected exception "RuntimeException". Message was: "App\Enums\DisclosureTier::tryFrom(): Argument #1 ($value) must be of type string|int, App\Enums\DisclosureTier given" at
C:\PreIPO\backend\app\Services\CompanyDisclosureTierService.php:178
C:\PreIPO\backend\tests\Feature\Services\CompanyDisclosureTierServiceTest.php:203
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\Services\CompanyDisclosureTierServiceTest[22m [90m>[39m promote tier 1 to tier 2 succeeâ€¦ [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'disclosure_module_id' doesn't have a default value (Connection: mysql, SQL: insert into `company_disclosures` (`status`, `disclosure_data`, `company_id`, `updated_at`, `created_at`) values (approved, [], 6522, 2026-02-22 17:44:57, 2026-02-22 17:44:57))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'disclosure_module_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m uploading new logo deletes old one                                    
[39;1m  Failed asserting that null is not equal to null.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m508[39m
    504â–• 
    505â–•         $secondPath = Setting::where('key', 'site_logo')->value('value');
    506â–• 
    507â–•         // First file should be deleted, second should exist
  âžœ 508â–•         $this->assertNotEquals($firstPath, $secondPath);
    509â–•     }
    510â–• }
    511â–•

  [33m1   [39m[39;1mtests\Feature\ThemeSeoControllerTest.php[39;22m:[39;1m508[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m seo validates meta title suffix max length                            
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m333[39m
    329â–•             ->postJson('/api/v1/admin/settings/seo', [
    330â–•                 'meta_title_suffix' => str_repeat('a', 101) // Exceeds 100 char max
    331â–•             ]);
    332â–• 
  âžœ 333â–•         $response->assertStatus(422)
    334â–•             ->assertJsonValidationErrors(['meta_title_suffix']);
    335â–•     }
    336â–• 
    337â–•     // ==================== GOOGLE ANALYTICS ID TESTS ====================

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m theme rejects invalid hex format                                      
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m129[39m
    125â–•                 ->postJson('/api/v1/admin/settings/theme', [
    126â–•                     'primary_color' => $color
    127â–•                 ]);
    128â–• 
  âžœ 129â–•             $response->assertStatus(422, "Color '$color' should be rejected");
    130â–•         }
    131â–•     }
    132â–• 
    133â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m seo update clears settings cache                                      
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m480[39m
    476â–•             ->postJson('/api/v1/admin/settings/seo', [
    477â–•                 'meta_title_suffix' => 'New'
    478â–•             ]);
    479â–• 
  âžœ 480â–•         $response->assertStatus(200);
    481â–• 
    482â–•         // Cache should be cleared
    483â–•         $cached = cache()->get('settings');
    484â–•         $this->assertNull($cached);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m seo validates google analytics id format                              
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m389[39m
    385â–•                 ->postJson('/api/v1/admin/settings/seo', [
    386â–•                     'google_analytics_id' => $id
    387â–•                 ]);
    388â–• 
  âžœ 389â–•             $response->assertStatus(422, "GA ID '$id' should be rejected")
    390â–•                 ->assertJsonValidationErrors(['google_analytics_id']);
    391â–•         }
    392â–•     }
    393â–•

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m theme accepts valid hex colors                                        
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m150[39m
    146â–•                 ->postJson('/api/v1/admin/settings/theme', [
    147â–•                     'primary_color' => $color
    148â–•                 ]);
    149â–• 
  âžœ 150â–•             $response->assertStatus(200, "Color '$color' should be accepted");
    151â–•         }
    152â–•     }
    153â–• 
    154â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m logo validates file type                                              
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m195[39m
    191â–•             ->postJson('/api/v1/admin/settings/theme', [
    192â–•                 'logo' => UploadedFile::fake()->create('document.pdf', 100)
    193â–•             ]);
    194â–• 
  âžœ 195â–•         $response->assertStatus(422)
    196â–•             ->assertJsonValidationErrors(['logo']);
    197â–•     }
    198â–• 
    199â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can set google analytics ua id                                  
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m362[39m
    358â–•             ->postJson('/api/v1/admin/settings/seo', [
    359â–•                 'google_analytics_id' => 'UA-12345678-1'
    360â–•             ]);
    361â–• 
  âžœ 362â–•         $response->assertStatus(200);
    363â–• 
    364â–•         $this->assertDatabaseHas('settings', [
    365â–•             'key' => 'seo_google_analytics_id',
    366â–•             'value' => 'UA-12345678-1'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m regular user cannot update theme                                      
[39;1m  Expected response status code [403] but received 404.
Failed asserting that 404 is identical to 403.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m426[39m
    422â–•             ->postJson('/api/v1/admin/settings/theme', [
    423â–•                 'primary_color' => '#FF0000'
    424â–•             ]);
    425â–• 
  âžœ 426â–•         $response->assertStatus(403);
    427â–•     }
    428â–• 
    429â–•     #[\PHPUnit\Framework\Attributes\Test]
    430â–•     public function regular_user_cannot_update_seo()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can update meta title suffix                                    
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m305[39m
    301â–•             ->postJson('/api/v1/admin/settings/seo', [
    302â–•                 'meta_title_suffix' => ' | MyCompany'
    303â–•             ]);
    304â–• 
  âžœ 305â–•         $response->assertStatus(200);
    306â–• 
    307â–•         $this->assertDatabaseHas('settings', [
    308â–•             'key' => 'seo_meta_title_suffix',
    309â–•             'value' => ' | MyCompany'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m seo accepts valid google analytics ids                                
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m413[39m
    409â–•                 ->postJson('/api/v1/admin/settings/seo', [
    410â–•                     'google_analytics_id' => $id
    411â–•                 ]);
    412â–• 
  âžœ 413â–•             $response->assertStatus(200, "GA ID '$id' should be accepted");
    414â–•         }
    415â–•     }
    416â–• 
    417â–•     // ==================== AUTHORIZATION TESTS ====================

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can update secondary color                                      
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m57[39m
     53â–•             ->postJson('/api/v1/admin/settings/theme', [
     54â–•                 'secondary_color' => '#00FF00'
     55â–•             ]);
     56â–• 
  âžœ  57â–•         $response->assertStatus(200);
     58â–• 
     59â–•         $this->assertDatabaseHas('settings', [
     60â–•             'key' => 'theme_secondary_color',
     61â–•             'value' => '#00FF00'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m favicon validates max file size                                       
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m273[39m
    269â–•             ->postJson('/api/v1/admin/settings/theme', [
    270â–•                 'favicon' => UploadedFile::fake()->image('favicon.png')->size(600) // 600KB, max is 512KB
    271â–•             ]);
    272â–• 
  âžœ 273â–•         $response->assertStatus(422)
    274â–•             ->assertJsonValidationErrors(['favicon']);
    275â–•     }
    276â–• 
    277â–•     // ==================== SEO UPDATE TESTS ====================

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can update font family                                          
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m73[39m
     69â–•             ->postJson('/api/v1/admin/settings/theme', [
     70â–•                 'font_family' => 'Inter, sans-serif'
     71â–•             ]);
     72â–• 
  âžœ  73â–•         $response->assertStatus(200);
     74â–• 
     75â–•         $this->assertDatabaseHas('settings', [
     76â–•             'key' => 'theme_font_family',
     77â–•             'value' => 'Inter, sans-serif'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m theme validates hex color format                                      
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m106[39m
    102â–•             ->postJson('/api/v1/admin/settings/theme', [
    103â–•                 'primary_color' => 'not-a-color'
    104â–•             ]);
    105â–• 
  âžœ 106â–•         $response->assertStatus(422)
    107â–•             ->assertJsonValidationErrors(['primary_color']);
    108â–•     }
    109â–• 
    110â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m favicon validates file type                                           
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m259[39m
    255â–•             ->postJson('/api/v1/admin/settings/theme', [
    256â–•                 'favicon' => UploadedFile::fake()->image('favicon.jpg') // JPG not allowed for favicon
    257â–•             ]);
    258â–• 
  âžœ 259â–•         $response->assertStatus(422)
    260â–•             ->assertJsonValidationErrors(['favicon']);
    261â–•     }
    262â–• 
    263â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m seo validates robots txt max length                                   
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m321[39m
    317â–•             ->postJson('/api/v1/admin/settings/seo', [
    318â–•                 'robots_txt' => str_repeat('a', 5001) // Exceeds 5000 char max
    319â–•             ]);
    320â–• 
  âžœ 321â–•         $response->assertStatus(422)
    322â–•             ->assertJsonValidationErrors(['robots_txt']);
    323â–•     }
    324â–• 
    325â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m unauthenticated user cannot update theme                              
[39;1m  Expected response status code [401] but received 404.
Failed asserting that 404 is identical to 401.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m447[39m
    443â–•         $response = $this->postJson('/api/v1/admin/settings/theme', [
    444â–•             'primary_color' => '#FF0000'
    445â–•         ]);
    446â–• 
  âžœ 447â–•         $response->assertStatus(401);
    448â–•     }
    449â–• 
    450â–•     // ==================== CACHE CLEARING TESTS ====================
    451â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m logo accepts valid image types                                        
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m226[39m
    222â–•                 ->postJson('/api/v1/admin/settings/theme', [
    223â–•                     'logo' => UploadedFile::fake()->image("logo.$type", 200, 100)
    224â–•                 ]);
    225â–• 
  âžœ 226â–•             $response->assertStatus(200, "Logo type '$type' should be accepted");
    227â–•         }
    228â–•     }
    229â–• 
    230â–•     // ==================== FAVICON UPLOAD TESTS ====================

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can upload favicon                                              
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m241[39m
    237â–•             ->postJson('/api/v1/admin/settings/theme', [
    238â–•                 'favicon' => UploadedFile::fake()->image('favicon.png', 32, 32)
    239â–•             ]);
    240â–• 
  âžœ 241â–•         $response->assertStatus(200);
    242â–• 
    243â–•         $this->assertDatabaseHas('settings', [
    244â–•             'key' => 'site_favicon',
    245â–•             'group' => 'theme'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m logo validates max file size                                          
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m209[39m
    205â–•             ->postJson('/api/v1/admin/settings/theme', [
    206â–•                 'logo' => UploadedFile::fake()->image('large-logo.png')->size(3000) // 3MB, max is 2MB
    207â–•             ]);
    208â–• 
  âžœ 209â–•         $response->assertStatus(422)
    210â–•             ->assertJsonValidationErrors(['logo']);
    211â–•     }
    212â–• 
    213â–•     #[\PHPUnit\Framework\Attributes\Test]

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can set google analytics ga4 id                                 
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m346[39m
    342â–•             ->postJson('/api/v1/admin/settings/seo', [
    343â–•                 'google_analytics_id' => 'G-ABCD123456'
    344â–•             ]);
    345â–• 
  âžœ 346â–•         $response->assertStatus(200);
    347â–• 
    348â–•         $this->assertDatabaseHas('settings', [
    349â–•             'key' => 'seo_google_analytics_id',
    350â–•             'value' => 'G-ABCD123456'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m theme update clears settings cache                                    
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m462[39m
    458â–•             ->postJson('/api/v1/admin/settings/theme', [
    459â–•                 'primary_color' => '#FFFFFF'
    460â–•             ]);
    461â–• 
  âžœ 462â–•         $response->assertStatus(200);
    463â–• 
    464â–•         // Cache should be cleared (null or different value)
    465â–•         $cached = cache()->get('settings');
    466â–•         $this->assertNull($cached);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can update robots txt                                           
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m288[39m
    284â–•             ->postJson('/api/v1/admin/settings/seo', [
    285â–•                 'robots_txt' => $robotsTxt
    286â–•             ]);
    287â–• 
  âžœ 288â–•         $response->assertStatus(200)
    289â–•             ->assertJson(['message' => 'SEO settings updated']);
    290â–• 
    291â–•         $this->assertDatabaseHas('settings', [
    292â–•             'key' => 'seo_robots_txt',

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can update multiple theme settings                              
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m91[39m
     87â–•                 'secondary_color' => '#654321',
     88â–•                 'font_family' => 'Roboto'
     89â–•             ]);
     90â–• 
  âžœ  91â–•         $response->assertStatus(200);
     92â–• 
     93â–•         $this->assertDatabaseHas('settings', ['key' => 'theme_primary_color', 'value' => '#123456']);
     94â–•         $this->assertDatabaseHas('settings', ['key' => 'theme_secondary_color', 'value' => '#654321']);
     95â–•         $this->assertDatabaseHas('settings', ['key' => 'theme_font_family', 'value' => 'Roboto']);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can upload logo                                                 
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m177[39m
    173â–•             ->postJson('/api/v1/admin/settings/theme', [
    174â–•                 'logo' => UploadedFile::fake()->image('logo.png', 200, 100)
    175â–•             ]);
    176â–• 
  âžœ 177â–•         $response->assertStatus(200);
    178â–• 
    179â–•         $this->assertDatabaseHas('settings', [
    180â–•             'key' => 'site_logo',
    181â–•             'group' => 'theme'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m theme validates font family max length                                
[39;1m  Expected response status code [422] but received 404.
Failed asserting that 404 is identical to 422.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m162[39m
    158â–•             ->postJson('/api/v1/admin/settings/theme', [
    159â–•                 'font_family' => str_repeat('a', 101) // Exceeds 100 char max
    160â–•             ]);
    161â–• 
  âžœ 162â–•         $response->assertStatus(422)
    163â–•             ->assertJsonValidationErrors(['font_family']);
    164â–•     }
    165â–• 
    166â–•     // ==================== LOGO UPLOAD TESTS ====================

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m regular user cannot update seo                                        
[39;1m  Expected response status code [403] but received 404.
Failed asserting that 404 is identical to 403.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m437[39m
    433â–•             ->postJson('/api/v1/admin/settings/seo', [
    434â–•                 'meta_title_suffix' => 'Hacked'
    435â–•             ]);
    436â–• 
  âžœ 437â–•         $response->assertStatus(403);
    438â–•     }
    439â–• 
    440â–•     #[\PHPUnit\Framework\Attributes\Test]
    441â–•     public function unauthenticated_user_cannot_update_theme()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Feature\ThemeSeoControllerTest[22m [90m>[39m admin can update primary color                                        
[39;1m  Expected response status code [200] but received 404.
Failed asserting that 404 is identical to 200.[39;22m

  at [32mtests\Feature\ThemeSeoControllerTest.php[39m:[32m40[39m
     36â–•             ->postJson('/api/v1/admin/settings/theme', [
     37â–•                 'primary_color' => '#FF5733'
     38â–•             ]);
     39â–• 
  âžœ  40â–•         $response->assertStatus(200)
     41â–•             ->assertJson(['message' => 'Theme updated successfully']);
     42â–• 
     43â–•         $this->assertDatabaseHas('settings', [
     44â–•             'key' => 'theme_primary_color',

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DisputeStatsCacheTest[22m [90m>[39m get overview counts disputes correctly                  [41;1m ErrorException [49;22m  
[39;1m  Undefined property: stdClass::$status[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Query\Builder.php[39m:[32m3424[39m
    3420â–•                 $results[] = $row->$column;
    3421â–•             }
    3422â–•         } else {
    3423â–•             foreach ($queryResult as $row) {
  âžœ 3424â–•                 $results[$row->$key] = $row->$column;
    3425â–•             }
    3426â–•         }
    3427â–• 
    3428â–•         return new Collection($results);

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Query\Builder.php[39;22m:[39;1m3381[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php[39;22m:[39;1m991[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DisputeStatsCacheTest[22m [90m>[39m clear cache removes all stats                                             
[39;1m  Failed asserting that '2026-02-22T17:45:34+00:00' is not equal to '2026-02-22T17:45:34+00:00'.[39;22m

  at [32mtests\Unit\DisputeStatsCacheTest.php[39m:[32m208[39m
    204â–•         $stats2 = $this->cacheService->getOverview();
    205â–•         $computedAt2 = $stats2['computed_at'];
    206â–• 
    207â–•         // Timestamps should be different (freshly computed)
  âžœ 208â–•         $this->assertNotEquals($computedAt1, $computedAt2);
    209â–•     }
    210â–• 
    211â–•     // ==================== ALL STATS COMBINED TEST ====================
    212â–•

  [33m1   [39m[39;1mtests\Unit\DisputeStatsCacheTest.php[39;22m:[39;1m208[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DisputeStatsCacheTest[22m [90m>[39m get overview force refresh bypasses cache               [41;1m ErrorException [49;22m  
[39;1m  Undefined property: stdClass::$status[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Query\Builder.php[39m:[32m3424[39m
    3420â–•                 $results[] = $row->$column;
    3421â–•             }
    3422â–•         } else {
    3423â–•             foreach ($queryResult as $row) {
  âžœ 3424â–•                 $results[$row->$key] = $row->$column;
    3425â–•             }
    3426â–•         }
    3427â–• 
    3428â–•         return new Collection($results);

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Query\Builder.php[39;22m:[39;1m3381[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php[39;22m:[39;1m991[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SmsServiceTest[22m [90m>[39m send sms respects user preferences                             [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'notification_type' doesn't have a default value (Connection: mysql, SQL: insert into `user_notification_preferences` (`user_id`, `updated_at`, `created_at`) values (34526, 2026-02-22 17:45:35, 2026-02-22 17:45:35))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'notification_type' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SmsServiceTest[22m [90m>[39m send sms handles msg91 failure                                                   
[39;1m  Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'failed'
+'sent'[39;22m

  at [32mtests\Unit\SmsServiceTest.php[39m:[32m91[39m
     87â–•         Http::fake(['*' => Http::response('Server Error', 500)]);
     88â–• 
     89â–•         $log = $this->service->send($this->user, "Test", "slug");
     90â–• 
  âžœ  91â–•         $this->assertEquals('failed', $log->fresh()->status);
     92â–•         $this->assertStringContainsString('Server Error', $log->fresh()->error_message);
     93â–•     }
     94â–• 
     95â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Unit\SmsServiceTest.php[39;22m:[39;1m91[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SmsServiceTest[22m [90m>[39m send sms logs delivery                                         [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'to_mobile' in 'where clause' (Connection: mysql, SQL: select exists(select * from `sms_logs` where (`user_id` = 34528 and `to_mobile` = 9876543210 and `status` = sent and `gateway_message_id` = abc)) as `exists`)[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m407[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[42S22]: Column not found: 1054 Unknown column 'to_mobile' in 'where clause'")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SmsServiceTest[22m [90m>[39m send sms uses correct template id                                                
[39;1m  An expected request was not recorded.
Failed asserting that false is true.[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Http\Client\Factory.php[39m:[32m354[39m
    350â–•      * @return void
    351â–•      */
    352â–•     public function assertSent($callback)
    353â–•     {
  âžœ 354â–•         PHPUnit::assertTrue(
    355â–•             $this->recorded($callback)->count() > 0,
    356â–•             'An expected request was not recorded.'
    357â–•         );
    358â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Http\Client\Factory.php[39;22m:[39;1m354[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php[39;22m:[39;1m361[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SmsServiceTest[22m [90m>[39m send sms limits to 160 chars                           [41;1m BadMethodCallException [49;22m  
[39;1m  Received Mockery_7_Illuminate_Log_LogManager::error(), but no expectations were specified[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php[39m:[32m361[39m
    357â–•         if (! $instance) {
    358â–•             throw new RuntimeException('A facade root has not been set.');
    359â–•         }
    360â–• 
  âžœ 361â–•         return $instance->$method(...$args);
    362â–•     }
    363â–• }
    364â–•

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Support\Facades\Facade.php[39;22m:[39;1m361[39;22m
  [33m2   [39m[39;1mapp\Services\SmsService.php[39;22m:[39;1m55[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal update to featured blocked for tier 2                  [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'TechStart sunt' (ID: 5234). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m non featured deal at tier 2 can be saved                    [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'FinGrow eum' (ID: 5235). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m draft deal at tier 1 can be saved                           [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'TechStart saepe' (ID: 5236). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal creation allowed for tier 3 featured                   [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'DataPro incidunt' (ID: 5240). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal creation allowed for tier 2 live                       [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'SmartSolutions et' (ID: 5241). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal activation allowed for tier 2 live                     [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'SmartSolutions dolor' (ID: 5242). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal featuring allowed for tier 3 featured                  [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'SmartSolutions quae' (ID: 5243). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal status update to active blocked for tier 1             [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'SmartSolutions quibusdam' (ID: 5244). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal activation blocked for tier 1 upcoming                 [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'CloudNine magni' (ID: 5245). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m activation exception shows correct operation                [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'FinGrow impedit' (ID: 5246). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m featuring exception shows correct operation                 [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'EduLearn omnis' (ID: 5249). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal activation allowed for tier 3 featured                 [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'HealthFirst totam' (ID: 5250). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\DealTierGateTest[22m [90m>[39m deal creation allowed for tier 1 upcoming                   [41;1m DomainException [49;22m  
[39;1m  Cannot create deal: No inventory available for product 'EduLearn facere' (ID: 5251). Create a BulkPurchase with inventory first. INVARIANT: Deals must have backing inventory.[39;22m

  at [32mapp\Models\Deal.php[39m:[32m221[39m
    217â–•             // GATE 1: New deal creation requires inventory to exist
    218â–•             // This prevents deals from being created without backing inventory
    219â–•             if (!$deal->exists) {
    220â–•                 if ($availableInventory <= 0) {
  âžœ 221â–•                     throw new \DomainException(
    222â–•                         "Cannot create deal: No inventory available for product '{$product->name}' (ID: {$product->id}). " .
    223â–•                         "Create a BulkPurchase with inventory first. " .
    224â–•                         "INVARIANT: Deals must have backing inventory."
    225â–•                     );

  [33m1   [39m[39;1mapp\Models\Deal.php[39;22m:[39;1m221[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawServiceTest[22m [90m>[39m send winner notifications                                         [41;1m Error [49;22m  
[39;1m  Class "Tests\Unit\Log" not found[39;22m

  at [32mtests\Unit\LuckyDrawServiceTest.php[39m:[32m148[39m
    144â–• 
    145â–•     #[\PHPUnit\Framework\Attributes\Test]
    146â–•     public function test_send_winner_notifications()
    147â–•     {
  âžœ 148â–•         Log::shouldReceive('info')->once()->with('Queueing winner notification for User #1');
    149â–• 
    150â–•         $this->service->sendWinnerNotifications([1]);
    151â–•     }
    152â–• }

  [33m1   [39m[39;1mtests\Unit\LuckyDrawServiceTest.php[39;22m:[39;1m148[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawServiceTest[22m [90m>[39m allocate bonus entries for streaks                                         
[39;1m  Failed asserting that a row in the table [lucky_draw_entries] matches the attributes {
    "user_id": 34558,
    "lucky_draw_id": 430,
    "base_entries": 5,
    "bonus_entries": 6
}.

Found: [
    {
        "user_id": 34559,
        "lucky_draw_id": 430,
        "base_entries": 5,
        "bonus_entries": 6
    }
].[39;22m

  at [32mtests\Unit\LuckyDrawServiceTest.php[39m:[32m88[39m
     84â–•         $payment = Payment::factory()->create(['subscription_id' => $sub->id, 'is_on_time' => true]);
     85â–•         
     86â–•         $this->service->allocateEntries($payment);
     87â–•         
  âžœ  88â–•         $this->assertDatabaseHas('lucky_draw_entries', [
     89â–•             'user_id' => $user->id,
     90â–•             'lucky_draw_id' => $this->draw->id,
     91â–•             'base_entries' => 5, // From plan
     92â–•             'bonus_entries' => 6  // 1 (on-time) + 5 (streak)

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawServiceTest[22m [90m>[39m distribute prizes to wallets                             [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`lucky_draw_entries`, CONSTRAINT `lucky_draw_entries_payment_id_foreign` FOREIGN KEY (`payment_id`) REFERENCES `payments` (`id`) ON DELETE CASCADE) (Connection: mysql, SQL: insert into `lucky_draw_entries` (`user_id`, `lucky_draw_id`, `payment_id`, `base_entries`, `updated_at`, `created_at`) values (34560, 432, 1, 1, 2026-02-22 17:45:45, 2026-02-22 17:45:45))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`lucky_draw_entries`, CONSTRAINT `lucky_draw_entries_payment_id_foreign` FOREIGN KEY (`payment_id`) REFERENCES `payments` (`id`) ON DELETE CASCADE)")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawServiceTest[22m [90m>[39m allocate entries based on plan                                             
[39;1m  Failed asserting that a row in the table [lucky_draw_entries] matches the attributes {
    "user_id": 34561,
    "lucky_draw_id": 433,
    "base_entries": 5,
    "bonus_entries": 0
}.

Found: [
    {
        "user_id": 34562,
        "lucky_draw_id": 433,
        "base_entries": 5,
        "bonus_entries": 0
    }
].[39;22m

  at [32mtests\Unit\LuckyDrawServiceTest.php[39m:[32m65[39m
     61â–•         $payment = Payment::factory()->create(['subscription_id' => $sub->id, 'is_on_time' => false]);
     62â–•         
     63â–•         $this->service->allocateEntries($payment);
     64â–•         
  âžœ  65â–•         $this->assertDatabaseHas('lucky_draw_entries', [
     66â–•             'user_id' => $user->id,
     67â–•             'lucky_draw_id' => $this->draw->id,
     68â–•             'base_entries' => 5, // From plan
     69â–•             'bonus_entries' => 0

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawServiceTest[22m [90m>[39m select winners uses weighted random                      [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`lucky_draw_entries`, CONSTRAINT `lucky_draw_entries_payment_id_foreign` FOREIGN KEY (`payment_id`) REFERENCES `payments` (`id`) ON DELETE CASCADE) (Connection: mysql, SQL: insert into `lucky_draw_entries` (`user_id`, `lucky_draw_id`, `payment_id`, `base_entries`, `updated_at`, `created_at`) values (34563, 434, 1, 100, 2026-02-22 17:45:46, 2026-02-22 17:45:46))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`lucky_draw_entries`, CONSTRAINT `lucky_draw_entries_payment_id_foreign` FOREIGN KEY (`payment_id`) REFERENCES `payments` (`id`) ON DELETE CASCADE)")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email uses correct template                                      [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email replaces variables                                         [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email queues for async delivery                                  [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m batch email sends in chunks                                           [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email logs delivery                                              [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email validates recipient                                        [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email respects user preferences                                  [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\EmailServiceTest[22m [90m>[39m send email handles sendgrid failure                                   [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\EmailTemplateFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalServiceTest[22m [90m>[39m approve withdrawal initiates bank transfer event                 [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\WithdrawalService::requestWithdrawal()[39;22m

  at [32mtests\Unit\WithdrawalServiceTest.php[39m:[32m69[39m
     65â–•     public function test_approve_withdrawal_initiates_bank_transfer_event()
     66â–•     {
     67â–•         Event::fake(); // Tell Laravel to intercept events
     68â–• 
  âžœ  69â–•         $withdrawal = $this->service->requestWithdrawal($this->user, 1000, []);
     70â–•         $this->assertEquals('pending', $withdrawal->fresh()->status); // Not auto-approved
     71â–• 
     72â–•         $this->service->approveWithdrawal($withdrawal, $this->admin);
     73â–•

  [33m1   [39m[39;1mtests\Unit\WithdrawalServiceTest.php[39;22m:[39;1m69[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalServiceTest[22m [90m>[39m request withdrawal validates kyc approved                                 
[39;1m  Failed asserting that exception of type "Error" matches expected exception "Exception". Message was: "Call to undefined method App\Services\WithdrawalService::requestWithdrawal()" at
C:\PreIPO\backend\tests\Unit\WithdrawalServiceTest.php:52
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalServiceTest[22m [90m>[39m request withdrawal validates minimum amount                               
[39;1m  Failed asserting that exception of type "Error" matches expected exception "Exception". Message was: "Call to undefined method App\Services\WithdrawalService::requestWithdrawal()" at
C:\PreIPO\backend\tests\Unit\WithdrawalServiceTest.php:61
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalServiceTest[22m [90m>[39m complete withdrawal updates wallet balance                       [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\WithdrawalService::requestWithdrawal()[39;22m

  at [32mtests\Unit\WithdrawalServiceTest.php[39m:[32m83[39m
     79â–• 
     80â–•     #[\PHPUnit\Framework\Attributes\Test]
     81â–•     public function test_complete_withdrawal_updates_wallet_balance()
     82â–•     {
  âžœ  83â–•         $withdrawal = $this->service->requestWithdrawal($this->user, 1000, []);
     84â–• 
     85â–•         // At this point, balance is 4000, locked is 1000
     86â–•         $this->assertEquals(4000, $this->wallet->fresh()->balance);
     87â–•         $this->assertEquals(1000, $this->wallet->fresh()->locked_balance);

  [33m1   [39m[39;1mtests\Unit\WithdrawalServiceTest.php[39;22m:[39;1m83[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SqlInjectionTest[22m [90m>[39m sql injection prevention works                         [41;1m UnknownTypeException [49;22m  
[39;1m  Class or interface "Tests\Unit\Statement" does not exist[39;22m

  at [32mtests\Unit\SqlInjectionTest.php[39m:[32m18[39m
     14â–•         // The malicious payload
     15â–•         $maliciousInput = "' OR '1'='1";
     16â–• 
     17â–•         // Mock the database connection
  âžœ  18â–•         $statementMock = $this->createMock(Statement::class);
     19â–•         $connectionMock = $this->createMock(Connection::class);
     20â–• 
     21â–•         // We expect the 'executeQuery' (or similar) method to be called
     22â–•         // with the *unaltered* malicious string as a *parameter*,

  [33m1   [39m[39;1mtests\Unit\SqlInjectionTest.php[39;22m:[39;1m18[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserProfitShareTest[22m [90m>[39m user share validates amount positive                               [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\ProfitShareFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserProfitShareTest[22m [90m>[39m user share tracks credited to wallet                               [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\ProfitShareFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserProfitShareTest[22m [90m>[39m user share belongs to profit share                                 [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\ProfitShareFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserProfitShareTest[22m [90m>[39m user share belongs to user                                         [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\ProfitShareFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawTest[22m [90m>[39m lucky draw calculates total entries                                      [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawTest[22m [90m>[39m lucky draw has entries relationship                                      [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReportServiceTest[22m [90m>[39m user retention report calculates churn                                        
[39;1m  Failed asserting that 0 matches expected 2.[39;22m

  at [32mtests\Unit\ReportServiceTest.php[39m:[32m72[39m
     68â–•         ]);
     69â–• 
     70â–•         $metrics = $this->service->getRetentionMetrics(now()->subMonth(), now());
     71â–• 
  âžœ  72â–•         $this->assertEquals(2, $metrics['users_lost']);
     73â–•         $this->assertEquals(20, $metrics['churn_rate']); // 2 / 10
     74â–•     }
     75â–• 
     76â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Unit\ReportServiceTest.php[39;22m:[39;1m72[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReportServiceTest[22m [90m>[39m financial summary calculates profit                                           
[39;1m  Failed asserting that 0.0 matches expected 10000.[39;22m

  at [32mtests\Unit\ReportServiceTest.php[39m:[32m39[39m
     35â–•         BonusTransaction::factory()->create(['amount' => 1000]);
     36â–• 
     37â–•         $summary = $this->service->getFinancialSummary(now()->subDay(), now()->addDay());
     38â–• 
  âžœ  39â–•         $this->assertEquals(10000, $summary['revenue']);
     40â–•         $this->assertEquals(2000, $summary['expenses']);
     41â–•         $this->assertEquals(8000, $summary['profit']);
     42â–•     }
     43â–•

  [33m1   [39m[39;1mtests\Unit\ReportServiceTest.php[39;22m:[39;1m39[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReportServiceTest[22m [90m>[39m kyc completion report calculates percentage                          [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\ReportService::getKycCompletion()[39;22m

  at [32mtests\Unit\ReportServiceTest.php[39m:[32m82[39m
     78â–•     {
     79â–•         User::factory()->count(3)->create()->each(fn($u) => $u->kyc->update(['status' => 'verified']));
     80â–•         User::factory()->count(1)->create()->each(fn($u) => $u->kyc->update(['status' => 'pending']));
     81â–• 
  âžœ  82â–•         $percentage = $this->service->getKycCompletion();
     83â–• 
     84â–•         $this->assertEquals(75, $percentage); // 3 out of 4
     85â–•     }
     86â–•

  [33m1   [39m[39;1mtests\Unit\ReportServiceTest.php[39;22m:[39;1m82[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReportServiceTest[22m [90m>[39m tds exemption for amounts below 10k                                  [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\ReportService::getTdsReport()[39;22m

  at [32mtests\Unit\ReportServiceTest.php[39m:[32m108[39m
    104â–•         // User A: Not eligible
    105â–•         $userA = User::factory()->create();
    106â–•         BonusTransaction::factory()->create(['user_id' => $userA->id, 'amount' => 9000]); // < 10k
    107â–•         
  âžœ 108â–•         $report = $this->service->getTdsReport(now()->subDay(), now()->addDay());
    109â–•         
    110â–•         $this->assertEquals(0, count($report));
    111â–•     }
    112â–•

  [33m1   [39m[39;1mtests\Unit\ReportServiceTest.php[39;22m:[39;1m108[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReportServiceTest[22m [90m>[39m user growth report calculates correctly                                       
[39;1m  Failed asserting that 15 matches expected 3.[39;22m

  at [32mtests\Unit\ReportServiceTest.php[39m:[32m53[39m
     49â–• 
     50â–•         $growth = $this->service->getUserGrowth(now()->subDays(5), now());
     51â–•         
     52â–•         $this->assertEquals(2, $growth->count()); // 2 groups (yesterday, today)
  âžœ  53â–•         $this->assertEquals(3, $growth[0]['count']);
     54â–•         $this->assertEquals(2, $growth[1]['count']);
     55â–•     }
     56â–• 
     57â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Unit\ReportServiceTest.php[39;22m:[39;1m53[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReportServiceTest[22m [90m>[39m tds calculation applies 10 percent                                   [41;1m Error [49;22m  
[39;1m  Call to undefined method App\Services\ReportService::getTdsReport()[39;22m

  at [32mtests\Unit\ReportServiceTest.php[39m:[32m94[39m
     90â–•         // User A: Eligible for TDS
     91â–•         $userA = User::factory()->create();
     92â–•         BonusTransaction::factory()->create(['user_id' => $userA->id, 'amount' => 15000]); // > 10k
     93â–• 
  âžœ  94â–•         $report = $this->service->getTdsReport(now()->subDay(), now()->addDay());
     95â–• 
     96â–•         $this->assertEquals(1, count($report));
     97â–•         $this->assertEquals(15000, $report[0]['gross_amount']);
     98â–•         $this->assertEquals(1500, $report[0]['tds_deducted']); // 10%

  [33m1   [39m[39;1mtests\Unit\ReportServiceTest.php[39;22m:[39;1m94[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus not awarded for late paymâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7172 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m73[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus streak resets on late payâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7173 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m139[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus amount varies by plan      [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7175 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m95[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus respects global toggle     [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7176 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m201[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus multiplies for streak      [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7177 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m115[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus awarded for on time paymeâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7178 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m56[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus respects grace period      [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7179 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m184[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorConsistencyTest[22m [90m>[39m consistency bonus uses configured amounts    [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7180 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorConsistencyTest.php[39;22m:[39;1m162[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\PaymentTest[22m [90m>[39m payment belongs to subscription                                 [41;1m RuntimeException [49;22m  
[39;1m  Payment creation FAILED: amount_paise is REQUIRED. Float fallback is PROHIBITED. Set amount_paise explicitly.[39;22m

  at [32mapp\Models\Payment.php[39m:[32m182[39m
    178â–•                     'user_id' => $payment->user_id,
    179â–•                     'subscription_id' => $payment->subscription_id,
    180â–•                 ]);
    181â–• 
  âžœ 182â–•                 throw new \RuntimeException(
    183â–•                     "Payment creation FAILED: amount_paise is REQUIRED. " .
    184â–•                     "Float fallback is PROHIBITED. Set amount_paise explicitly."
    185â–•                 );
    186â–•             }

  [33m1   [39m[39;1mapp\Models\Payment.php[39;22m:[39;1m182[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\PaymentTest[22m [90m>[39m payment belongs to user                                         [41;1m RuntimeException [49;22m  
[39;1m  Payment creation FAILED: amount_paise is REQUIRED. Float fallback is PROHIBITED. Set amount_paise explicitly.[39;22m

  at [32mapp\Models\Payment.php[39m:[32m182[39m
    178â–•                     'user_id' => $payment->user_id,
    179â–•                     'subscription_id' => $payment->subscription_id,
    180â–•                 ]);
    181â–• 
  âžœ 182â–•                 throw new \RuntimeException(
    183â–•                     "Payment creation FAILED: amount_paise is REQUIRED. " .
    184â–•                     "Float fallback is PROHIBITED. Set amount_paise explicitly."
    185â–•                 );
    186â–•             }

  [33m1   [39m[39;1mapp\Models\Payment.php[39;22m:[39;1m182[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\PaymentTest[22m [90m>[39m payment status enum validates                                   [41;1m RuntimeException [49;22m  
[39;1m  Invalid payment state transition: 'paid' â†’ 'failed'. Valid transitions from 'paid': [refunded, settled, chargeback_pending][39;22m

  at [32mapp\Models\Payment.php[39m:[32m215[39m
    211â–•                         'new_status' => $newStatus,
    212â–•                         'valid_transitions' => self::VALID_TRANSITIONS[$oldStatus] ?? [],
    213â–•                     ]);
    214â–• 
  âžœ 215â–•                     throw new \RuntimeException(
    216â–•                         "Invalid payment state transition: '{$oldStatus}' â†’ '{$newStatus}'. " .
    217â–•                         "Valid transitions from '{$oldStatus}': [" .
    218â–•                         implode(', ', self::VALID_TRANSITIONS[$oldStatus] ?? []) . "]"
    219â–•                     );

  [33m1   [39m[39;1mapp\Models\Payment.php[39;22m:[39;1m215[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Events\Dispatcher.php[39;22m:[39;1m459[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalTest[22m [90m>[39m withdrawal calculates net amount                               [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list' (Connection: mysql, SQL: insert into `withdrawals` (`user_id`, `wallet_id`, `amount_paise`, `fee_paise`, `tds_deducted_paise`, `net_amount_paise`, `status`, `bank_details`, `admin_id`, `utr_number`, `rejection_reason`, `amount`, `fee`, `updated_at`, `created_at`) values (34727, 37086, 853449, 0, 0, 853449, pending, {"bank_account_number":"152295858498","bank_ifsc":"TEST0001234","bank_name":"Kreiger, Lehner and Runolfsson","account_holder_name":"Margot Crist"}, ?, ?, ?, 1000, 50, 2026-02-22 17:46:04, 2026-02-22 17:46:04))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m47[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list'")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalTest[22m [90m>[39m withdrawal validates amount positive                                             
[39;1m  Failed asserting that exception of type "Illuminate\Database\QueryException" matches expected exception "InvalidArgumentException". Message was: "SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list' (Connection: mysql, SQL: insert into `withdrawals` (`user_id`, `wallet_id`, `amount_paise`, `fee_paise`, `tds_deducted_paise`, `net_amount_paise`, `status`, `bank_details`, `admin_id`, `utr_number`, `rejection_reason`, `amount`, `updated_at`, `created_at`) values (34731, 37092, 3949939, 0, 0, 3949939, pending, {"bank_account_number":"613931","bank_ifsc":"TEST0001234","bank_name":"Nolan, Nolan and Kozey","account_holder_name":"Prof. Brendon Hoppe"}, ?, ?, ?, -100, 2026-02-22 17:46:04, 2026-02-22 17:46:04))" at
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php:47
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Connection.php:812
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Connection.php:779
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php:42
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Query\Processors\MySqlProcessor.php:35
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Query\Builder.php:3766
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php:2120
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:1359
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:1324
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:1163
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php:352
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Collections\Traits\EnumeratesValues.php:261
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php:347
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php:303
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php:297
C:\PreIPO\backend\tests\Unit\WithdrawalTest.php:78
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalTest[22m [90m>[39m withdrawal calculates fee                                      [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list' (Connection: mysql, SQL: insert into `withdrawals` (`user_id`, `wallet_id`, `amount_paise`, `fee_paise`, `tds_deducted_paise`, `net_amount_paise`, `status`, `bank_details`, `admin_id`, `utr_number`, `rejection_reason`, `amount`, `fee`, `updated_at`, `created_at`) values (34735, 37098, 2281149, 0, 0, 2281149, pending, {"bank_account_number":"3172522118600","bank_ifsc":"TEST0001234","bank_name":"Zemlak, Konopelski and Murray","account_holder_name":"Mrs. Luisa Hyatt"}, ?, ?, ?, 1000, 50, 2026-02-22 17:46:04, 2026-02-22 17:46:04))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m47[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list'")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WithdrawalTest[22m [90m>[39m withdrawal tracks processed by admin                           [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list' (Connection: mysql, SQL: insert into `withdrawals` (`user_id`, `wallet_id`, `amount_paise`, `fee_paise`, `tds_deducted_paise`, `net_amount_paise`, `status`, `bank_details`, `admin_id`, `utr_number`, `rejection_reason`, `amount`, `updated_at`, `created_at`) values (34739, 37104, 1318641, 0, 0, 1318641, pending, {"bank_account_number":"23591582","bank_ifsc":"TEST0001234","bank_name":"Rosenbaum-Kovacek","account_holder_name":"Judson Hammes"}, 34740, ?, ?, 1000, 2026-02-22 17:46:04, 2026-02-22 17:46:04))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m47[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[42S22]: Column not found: 1054 Unknown column 'amount' in 'field list'")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\FeatureFlagTest[22m [90m>[39m feature flag validates identifier unique                               [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\FeatureFlagFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\FeatureFlagTest[22m [90m>[39m feature flag checks if enabled                                         [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\FeatureFlagFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\FeatureFlagTest[22m [90m>[39m percentage flag is off for guests                                      [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\FeatureFlagFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\FeatureFlagTest[22m [90m>[39m percentage flag is off if globally disabled                            [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\FeatureFlagFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\FeatureFlagTest[22m [90m>[39m feature flag tracks enabled for percentage                             [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\FeatureFlagFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\PlanTest[22m [90m>[39m plan scope active returns only active                                                  
[39;1m  Failed asserting that 73 matches expected 1.[39;22m

  at [32mtests\Unit\PlanTest.php[39m:[32m68[39m
     64â–•     {
     65â–•         Plan::factory()->create(['is_active' => true]);
     66â–•         Plan::factory()->create(['is_active' => false]);
     67â–• 
  âžœ  68â–•         $this->assertEquals(1, Plan::active()->count());
     69â–•     }
     70â–• 
     71â–•     #[\PHPUnit\Framework\Attributes\Test]
     72â–•     public function test_plan_calculates_total_investment()

  [33m1   [39m[39;1mtests\Unit\PlanTest.php[39;22m:[39;1m68[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ProfitShareServiceTest[22m [90m>[39m distribute to wallets credits correctly            [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\ProfitShareService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\ProfitShareServiceTest.php on line 25 and exactly 2 expected[39;22m

  at [32mapp\Services\ProfitShareService.php[39m:[32m29[39m
     25â–•      * Use 4 decimal places for all financial calculations to prevent float drift
     26â–•      */
     27â–•     private const BCMATH_SCALE = 4;
     28â–• 
  âžœ  29â–•     public function __construct(
     30â–•         WalletService $walletService,
     31â–•         DoubleEntryLedgerService $ledgerService
     32â–•     ) {
     33â–•         $this->walletService = $walletService;

  [33m1   [39m[39;1mapp\Services\ProfitShareService.php[39;22m:[39;1m29[39;22m
  [33m2   [39m[39;1mtests\Unit\ProfitShareServiceTest.php[39;22m:[39;1m25[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ProfitShareServiceTest[22m [90m>[39m calculate distribution applies plan percentage     [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\ProfitShareService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\ProfitShareServiceTest.php on line 25 and exactly 2 expected[39;22m

  at [32mapp\Services\ProfitShareService.php[39m:[32m29[39m
     25â–•      * Use 4 decimal places for all financial calculations to prevent float drift
     26â–•      */
     27â–•     private const BCMATH_SCALE = 4;
     28â–• 
  âžœ  29â–•     public function __construct(
     30â–•         WalletService $walletService,
     31â–•         DoubleEntryLedgerService $ledgerService
     32â–•     ) {
     33â–•         $this->walletService = $walletService;

  [33m1   [39m[39;1mapp\Services\ProfitShareService.php[39;22m:[39;1m29[39;22m
  [33m2   [39m[39;1mtests\Unit\ProfitShareServiceTest.php[39;22m:[39;1m25[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ProfitShareServiceTest[22m [90m>[39m calculate profit uses correct formula              [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\ProfitShareService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\ProfitShareServiceTest.php on line 25 and exactly 2 expected[39;22m

  at [32mapp\Services\ProfitShareService.php[39m:[32m29[39m
     25â–•      * Use 4 decimal places for all financial calculations to prevent float drift
     26â–•      */
     27â–•     private const BCMATH_SCALE = 4;
     28â–• 
  âžœ  29â–•     public function __construct(
     30â–•         WalletService $walletService,
     31â–•         DoubleEntryLedgerService $ledgerService
     32â–•     ) {
     33â–•         $this->walletService = $walletService;

  [33m1   [39m[39;1mapp\Services\ProfitShareService.php[39;22m:[39;1m29[39;22m
  [33m2   [39m[39;1mtests\Unit\ProfitShareServiceTest.php[39;22m:[39;1m25[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ProfitShareServiceTest[22m [90m>[39m reversal debits wallets correctly                  [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\ProfitShareService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\ProfitShareServiceTest.php on line 25 and exactly 2 expected[39;22m

  at [32mapp\Services\ProfitShareService.php[39m:[32m29[39m
     25â–•      * Use 4 decimal places for all financial calculations to prevent float drift
     26â–•      */
     27â–•     private const BCMATH_SCALE = 4;
     28â–• 
  âžœ  29â–•     public function __construct(
     30â–•         WalletService $walletService,
     31â–•         DoubleEntryLedgerService $ledgerService
     32â–•     ) {
     33â–•         $this->walletService = $walletService;

  [33m1   [39m[39;1mapp\Services\ProfitShareService.php[39;22m:[39;1m29[39;22m
  [33m2   [39m[39;1mtests\Unit\ProfitShareServiceTest.php[39;22m:[39;1m25[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ProfitShareServiceTest[22m [90m>[39m calculate distribution checks eligibility          [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\ProfitShareService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\ProfitShareServiceTest.php on line 25 and exactly 2 expected[39;22m

  at [32mapp\Services\ProfitShareService.php[39m:[32m29[39m
     25â–•      * Use 4 decimal places for all financial calculations to prevent float drift
     26â–•      */
     27â–•     private const BCMATH_SCALE = 4;
     28â–• 
  âžœ  29â–•     public function __construct(
     30â–•         WalletService $walletService,
     31â–•         DoubleEntryLedgerService $ledgerService
     32â–•     ) {
     33â–•         $this->walletService = $walletService;

  [33m1   [39m[39;1mapp\Services\ProfitShareService.php[39;22m:[39;1m29[39;22m
  [33m2   [39m[39;1mtests\Unit\ProfitShareServiceTest.php[39;22m:[39;1m25[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserKycTest[22m [90m>[39m aadhaar number format validates                                                     
[39;1m  Failed asserting that '123456789012' matches PCRE pattern "/^[2-9]{1}[0-9]{3}\s[0-9]{4}\s[0-9]{4}$|^[2-9]{1}[0-9]{11}$/".[39;22m

  at [32mtests\Unit\UserKycTest.php[39m:[32m164[39m
    160â–•     #[\PHPUnit\Framework\Attributes\Test]
    161â–•     public function test_aadhaar_number_format_validates()
    162â–•     {
    163â–•         // Valid Aadhaar (12 digits)
  âžœ 164â–•         $this->assertMatchesRegularExpression(UserKyc::AADHAAR_REGEX, '123456789012');
    165â–• 
    166â–•         // Invalid
    167â–•         $this->assertDoesNotMatchRegularExpression(UserKyc::AADHAAR_REGEX, '1234'); // Too short
    168â–•         $this->assertDoesNotMatchRegularExpression(UserKyc::AADHAAR_REGEX, '1234abc56789'); // Alphanumeric

  [33m1   [39m[39;1mtests\Unit\UserKycTest.php[39;22m:[39;1m164[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify pan handles api failure                    [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify pan calls income tax api                   [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verification logs all attempts                    [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify pan caches successful result               [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify aadhaar handles api failure                [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify pan validates dob match                    [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify pan validates name match                   [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify aadhaar validates name match               [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify bank account validates ifsc code           [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\VerificationServiceTest[22m [90m>[39m verify aadhaar calls digilocker api               [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\VerificationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\VerificationServiceTest.php on line 21 and exactly 1 expected[39;22m

  at [32mapp\Services\VerificationService.php[39m:[32m26[39m
     22â–•     protected $digilockerClientSecret;
     23â–•     protected $digilockerRedirectUri;
     24â–•     protected $kycOrchestrator; // ADDED: KycOrchestrator dependency
     25â–• 
  âžœ  26â–•     public function __construct(KycOrchestrator $kycOrchestrator)
     27â–•     {
     28â–•         $this->digilockerClientId = env('DIGILOCKER_CLIENT_ID');
     29â–•         $this->digilockerClientSecret = env('DIGILOCKER_CLIENT_SECRET');
     30â–•         $this->digilockerRedirectUri = env('APP_URL') . '/api/v1/kyc/digilocker/callback';

  [33m1   [39m[39;1mapp\Services\VerificationService.php[39;22m:[39;1m26[39;22m
  [33m2   [39m[39;1mtests\Unit\VerificationServiceTest.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SettingHelperTest[22m [90m>[39m helper invalidates cache on update                                            
[39;1m  Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'new_value'
+'old_value'[39;22m

  at [32mtests\Unit\SettingHelperTest.php[39m:[32m113[39m
    109â–•             ]
    110â–•         ]);
    111â–•         
    112â–•         // 3. The helper function *should* now miss the cache and re-fetch
  âžœ 113â–•         $this->assertEquals('new_value', setting('update_test'));
    114â–•     }
    115â–• 
    116â–•     public function test_setting_tracks_updated_by_admin()
    117â–•     {

  [33m1   [39m[39;1mtests\Unit\SettingHelperTest.php[39;22m:[39;1m113[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SettingHelperTest[22m [90m>[39m setting tracks updated by admin                                               
[39;1m  Failed asserting that a row in the table [settings] matches the attributes {
    "key": "admin_track",
    "updated_by": 34767
}.

Found similar results: [
    {
        "key": "admin_track",
        "updated_by": null
    }
].[39;22m

  at [32mtests\Unit\SettingHelperTest.php[39m:[32m126[39m
    122â–•                 ['key' => 'admin_track', 'value' => 'v2']
    123â–•             ]
    124â–•         ]);
    125â–• 
  âžœ 126â–•         $this->assertDatabaseHas('settings', [
    127â–•             'key' => 'admin_track',
    128â–•             'updated_by' => $this->admin->id
    129â–•         ]);
    130â–•     }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReferralCampaignTest[22m [90m>[39m campaign validates bonus amount positive                                   
[39;1m  Failed asserting that exception of type "Error" matches expected exception "InvalidArgumentException". Message was: "Call to a member function isBefore() on null" at
C:\PreIPO\backend\app\Models\ReferralCampaign.php:45
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:459
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:287
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:267
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:233
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Concerns\HasEvents.php:224
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:1147
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php:1128
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\helpers.php:399
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php:1127
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Traits\ForwardsCalls.php:23
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:2372
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:2384
C:\PreIPO\backend\tests\Unit\ReferralCampaignTest.php:35
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReferralCampaignTest[22m [90m>[39m campaign validates date range                                              
[39;1m  Failed asserting that exception of type "Error" matches expected exception "InvalidArgumentException". Message was: "Call to a member function isBefore() on null" at
C:\PreIPO\backend\app\Models\ReferralCampaign.php:45
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:459
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:287
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:267
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Events\Dispatcher.php:233
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Concerns\HasEvents.php:224
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:1147
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php:1128
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\helpers.php:399
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Builder.php:1127
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Support\Traits\ForwardsCalls.php:23
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:2372
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Model.php:2384
C:\PreIPO\backend\tests\Unit\ReferralCampaignTest.php:20
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\InventoryServiceTest[22m [90m>[39m check available inventory calculates correctly                             
[39;1m  Failed asserting that 12377659.0 matches expected 150000.[39;22m

  at [32mtests\Unit\InventoryServiceTest.php[39m:[32m43[39m
     39â–•         ]));
     40â–• 
     41â–•         $available = $this->service->getAvailableInventory($this->product);
     42â–•         
  âžœ  43â–•         $this->assertEquals(150000, $available);
     44â–•     }
     45â–• 
     46â–•     #[\PHPUnit\Framework\Attributes\Test]
     47â–•     public function test_low_stock_alert_triggers_at_10_percent()

  [33m1   [39m[39;1mtests\Unit\InventoryServiceTest.php[39;22m:[39;1m43[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\InventoryServiceTest[22m [90m>[39m reorder suggestion based on allocation rate                                
[39;1m  Expected: [39;22m[31mAt current rate (â‚¹1000/day), inventory will last 276 days. Suggest reorder by 2026-11-18.[39m[39;1m

  To contain: [39;22m[32m30 days[39m

  at [32mtests\Unit\InventoryServiceTest.php[39m:[32m101[39m
     97â–•         // Days Remaining = 30,000 / 1000 = 30
     98â–•         
     99â–•         $suggestion = $this->service->getReorderSuggestion($this->product);
    100â–• 
  âžœ 101â–•         $this->assertStringContainsString("30 days", $suggestion);
    102â–•     }
    103â–• }

  [33m1   [39m[39;1mtests\Unit\InventoryServiceTest.php[39;22m:[39;1m101[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\InventoryServiceTest[22m [90m>[39m low stock alert triggers at 10 percent                                     
[39;1m  Failed asserting that false is true.[39;22m

  at [32mtests\Unit\InventoryServiceTest.php[39m:[32m56[39m
     52â–•             'total_value_received' => 100000,
     53â–•             'value_remaining' => 10000
     54â–•         ]));
     55â–• 
  âžœ  56â–•         $this->assertTrue($this->service->checkLowStock($this->product));
     57â–• 
     58â–•         // 100k Total, 11k Remaining (11% Left, 89% Sold)
     59â–•         BulkPurchase::create(BulkPurchase::factory()->raw([
     60â–•             'product_id' => $this->product->id,

  [33m1   [39m[39;1mtests\Unit\InventoryServiceTest.php[39;22m:[39;1m56[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus only awarded once per milestoâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7233 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m230[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus respects global toggle         [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7234 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m217[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus awarded at month 24            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7235 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m80[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus amount varies by plan          [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7237 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m135[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus not awarded if non consecutivâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7238 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m114[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus supports custom milestones     [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7239 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m199[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus awarded at month 36            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7240 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m96[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus applies referral multiplier    [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7241 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m152[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus uses configured amounts        [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7242 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m175[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorMilestoneTest[22m [90m>[39m milestone bonus awarded at month 12            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7243 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorMilestoneTest.php[39;22m:[39;1m63[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SettingTest[22m [90m>[39m setting tracks updated by admin                                                     
[39;1m  Failed asserting that a row in the table [settings] matches the attributes {
    "key": "audit_test",
    "value": "updated",
    "updated_by": 35000
}.

Found similar results: [
    {
        "key": "audit_test",
        "value": "initial",
        "updated_by": null
    }
].[39;22m

  at [32mtests\Unit\SettingTest.php[39m:[32m133[39m
    129â–•                 ['key' => 'audit_test', 'value' => 'updated']
    130â–•             ]
    131â–•         ]);
    132â–• 
  âžœ 133â–•         $this->assertDatabaseHas('settings', [
    134â–•             'key' => 'audit_test',
    135â–•             'value' => 'updated',
    136â–•             'updated_by' => $this->admin->id
    137â–•         ]);

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus formula evaluation works   [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7244 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m224[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus respects configured rate   [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7245 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m105[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus increases linearly each mâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7246 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m84[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus respects global toggle     [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7247 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m205[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus calculates correctly at mâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7248 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m68[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus uses month override if coâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7249 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m150[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus applies referral multipliâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7250 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m124[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus caps at maximum percentagâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7251 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m170[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus uses payment amount as baâ€¦ [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7252 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m187[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorProgressiveTest[22m [90m>[39m progressive bonus not awarded before startâ€¦  [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7253 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorProgressiveTest.php[39;22m:[39;1m55[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [30;48;5;220;1m RISKY [39;49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m fetch payment details calls api                                              
[39;1m  This test did not perform any assertions[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m create order sets correct amount                [41;1m InvalidArgumentException [49;22m  
[39;1m  Payment amount must be between â‚¹500 and â‚¹1000000.[39;22m

  at [32mapp\Services\RazorpayService.php[39m:[32m249[39m
    245â–•         $min = (float) setting('min_payment_amount', 1);
    246â–•         $max = (float) setting('max_payment_amount', 1000000);
    247â–• 
    248â–•         if ($amount < $min || $amount > $max) {
  âžœ 249â–•             throw new InvalidArgumentException("Payment amount must be between â‚¹{$min} and â‚¹{$max}.");
    250â–•         }
    251â–•     }
    252â–• 
    253â–•     private function log($message, $level = 'info')

  [33m1   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m249[39;22m
  [33m2   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m51[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m create order calls razorpay api                 [41;1m InvalidArgumentException [49;22m  
[39;1m  Payment amount must be between â‚¹500 and â‚¹1000000.[39;22m

  at [32mapp\Services\RazorpayService.php[39m:[32m249[39m
    245â–•         $min = (float) setting('min_payment_amount', 1);
    246â–•         $max = (float) setting('max_payment_amount', 1000000);
    247â–• 
    248â–•         if ($amount < $min || $amount > $max) {
  âžœ 249â–•             throw new InvalidArgumentException("Payment amount must be between â‚¹{$min} and â‚¹{$max}.");
    250â–•         }
    251â–•     }
    252â–• 
    253â–•     private function log($message, $level = 'info')

  [33m1   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m249[39;22m
  [33m2   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m51[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m capture payment validates amount                                            
[39;1m  Failed asserting that exception message 'Payment amount must be a positive number.' contains 'Amount must be positive'.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [30;48;5;220;1m RISKY [39;49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m capture payment calls razorpay api                                           
[39;1m  This test did not perform any assertions[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m create order sets currency inr                  [41;1m InvalidArgumentException [49;22m  
[39;1m  Payment amount must be between â‚¹500 and â‚¹1000000.[39;22m

  at [32mapp\Services\RazorpayService.php[39m:[32m249[39m
    245â–•         $min = (float) setting('min_payment_amount', 1);
    246â–•         $max = (float) setting('max_payment_amount', 1000000);
    247â–• 
    248â–•         if ($amount < $min || $amount > $max) {
  âžœ 249â–•             throw new InvalidArgumentException("Payment amount must be between â‚¹{$min} and â‚¹{$max}.");
    250â–•         }
    251â–•     }
    252â–• 
    253â–•     private function log($message, $level = 'info')

  [33m1   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m249[39;22m
  [33m2   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m51[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [30;48;5;220;1m RISKY [39;49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m refund payment handles partial refund                                        
[39;1m  This test did not perform any assertions[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m create order handles api failure                                            
[39;1m  Failed asserting that exception message 'Payment amount must be between â‚¹500 and â‚¹1000000.' contains 'Network Error'.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m service logs all api calls                      [41;1m InvalidArgumentException [49;22m  
[39;1m  Payment amount must be between â‚¹500 and â‚¹1000000.[39;22m

  at [32mapp\Services\RazorpayService.php[39m:[32m249[39m
    245â–•         $min = (float) setting('min_payment_amount', 1);
    246â–•         $max = (float) setting('max_payment_amount', 1000000);
    247â–• 
    248â–•         if ($amount < $min || $amount > $max) {
  âžœ 249â–•             throw new InvalidArgumentException("Payment amount must be between â‚¹{$min} and â‚¹{$max}.");
    250â–•         }
    251â–•     }
    252â–• 
    253â–•     private function log($message, $level = 'info')

  [33m1   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m249[39;22m
  [33m2   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m51[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m create order includes receipt                   [41;1m InvalidArgumentException [49;22m  
[39;1m  Payment amount must be between â‚¹500 and â‚¹1000000.[39;22m

  at [32mapp\Services\RazorpayService.php[39m:[32m249[39m
    245â–•         $min = (float) setting('min_payment_amount', 1);
    246â–•         $max = (float) setting('max_payment_amount', 1000000);
    247â–• 
    248â–•         if ($amount < $min || $amount > $max) {
  âžœ 249â–•             throw new InvalidArgumentException("Payment amount must be between â‚¹{$min} and â‚¹{$max}.");
    250â–•         }
    251â–•     }
    252â–• 
    253â–•     private function log($message, $level = 'info')

  [33m1   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m249[39;22m
  [33m2   [39m[39;1mapp\Services\RazorpayService.php[39;22m:[39;1m51[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m verify signature rejects invalid signature                     [41;1m Exception [49;22m  
[39;1m  Invalid Signature[39;22m

  at [32mtests\Unit\RazorpayServiceTest.php[39m:[32m139[39m
    135â–•     {
    136â–•         $utilityMock = Mockery::mock();
    137â–•         $utilityMock->shouldReceive('verifyPaymentSignature')
    138â–•             ->once()
  âžœ 139â–•             ->andThrow(new \Exception("Invalid Signature"));
    140â–• 
    141â–•         $this->mockApi->utility = $utilityMock;
    142â–• 
    143â–•         $result = $this->service->verifySignature(['a' => 1]);

  [33m1   [39m[39;1mtests\Unit\RazorpayServiceTest.php[39;22m:[39;1m139[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [30;48;5;220;1m RISKY [39;49;22m [1mTests\Unit\RazorpayServiceTest[22m [90m>[39m refund payment calls razorpay api                                            
[39;1m  This test did not perform any assertions[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserTest[22m [90m>[39m user has profile relationship                                                          
[39;1m  Failed asserting that null matches expected 'Test'.[39;22m

  at [32mtests\Unit\UserTest.php[39m:[32m112[39m
    108â–•         $user = User::factory()->create();
    109â–•         $profile = UserProfile::create(['user_id' => $user->id, 'first_name' => 'Test']);
    110â–• 
    111â–•         $this->assertTrue($user->profile()->exists());
  âžœ 112â–•         $this->assertEquals('Test', $user->profile->first_name);
    113â–•     }
    114â–• 
    115â–•     #[\PHPUnit\Framework\Attributes\Test]
    116â–•     public function test_user_has_wallet_relationship()

  [33m1   [39m[39;1mtests\Unit\UserTest.php[39;22m:[39;1m112[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserTest[22m [90m>[39m user has wallet relationship                                                           
[39;1m  Failed asserting that 0 matches expected 100.[39;22m

  at [32mtests\Unit\UserTest.php[39m:[32m126[39m
    122â–•             'locked_balance_paise' => 0
    123â–•         ]);
    124â–• 
    125â–•         $this->assertTrue($user->wallet()->exists());
  âžœ 126â–•         $this->assertEquals(100, $user->wallet->balance); // Virtual accessor returns rupees
    127â–•     }
    128â–• 
    129â–•     #[\PHPUnit\Framework\Attributes\Test]
    130â–•     public function test_user_has_kyc_relationship()

  [33m1   [39m[39;1mtests\Unit\UserTest.php[39;22m:[39;1m126[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserTest[22m [90m>[39m user has kyc relationship                                                              
[39;1m  Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'pending'
+'verified'[39;22m

  at [32mtests\Unit\UserTest.php[39m:[32m136[39m
    132â–•         $user = User::factory()->create();
    133â–•         UserKyc::create(['user_id' => $user->id, 'status' => 'pending']);
    134â–• 
    135â–•         $this->assertTrue($user->kyc()->exists());
  âžœ 136â–•         $this->assertEquals('pending', $user->kyc->status);
    137â–•     }
    138â–• 
    139â–•     #[\PHPUnit\Framework\Attributes\Test]
    140â–•     public function test_user_has_subscriptions_relationship()

  [33m1   [39m[39;1mtests\Unit\UserTest.php[39;22m:[39;1m136[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorCelebrationTest[22m [90m>[39m birthday bonus awarded on user birthday                          
[39;1m  Failed asserting that a row in the table [bonus_transactions] does not match the attributes {
    "user_id": 35209
}.

Found similar results: [
    {
        "user_id": 35209
    }
].[39;22m

  at [32mtests\Unit\BonusCalculatorCelebrationTest.php[39m:[32m80[39m
     76â–•             'amount' => 50
     77â–•         ]);
     78â–•         
     79â–•         // User B does not
  âžœ  80â–•         $this->assertDatabaseMissing('bonus_transactions', ['user_id' => $this->userB->id]);
     81â–•     }
     82â–• 
     83â–•     #[\PHPUnit\Framework\Attributes\Test]
     84â–•     public function test_birthday_bonus_amount_varies_by_plan()

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment belongs to user                                 [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35225, 5270, 1476, 10, 1000, investment, 2026-02-22 17:46:52, 2026-02-22 17:46:52))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment tracks units allocated                          [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35228, 5271, 1477, 10, 1000, investment, 2026-02-22 17:46:52, 2026-02-22 17:46:52))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment belongs to bulk purchase                        [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35231, 5272, 1478, 10, 1000, investment, 2026-02-22 17:46:53, 2026-02-22 17:46:53))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment belongs to product                              [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35234, 5273, 1479, 10, 1000, investment, 2026-02-22 17:46:53, 2026-02-22 17:46:53))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment calculates profit loss                          [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35237, 5274, 1480, 10, 1000, investment, 2026-02-22 17:46:53, 2026-02-22 17:46:53))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment calculates current value                        [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35240, 5275, 1481, 10, 1000, investment, 2026-02-22 17:46:53, 2026-02-22 17:46:53))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment tracks allocation type                          [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35243, 5276, 1482, 10, 1000, investment, 2026-02-22 17:46:53, 2026-02-22 17:46:53))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\UserInvestmentTest[22m [90m>[39m investment calculates roi percentage                       [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value (Connection: mysql, SQL: insert into `user_investments` (`user_id`, `product_id`, `bulk_purchase_id`, `units_allocated`, `value_allocated`, `source`, `updated_at`, `created_at`) values (35246, 5277, 1483, 10, 1000, investment, 2026-02-22 17:46:53, 2026-02-22 17:46:53))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'payment_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ProductPriceHistoryTest[22m [90m>[39m price history orders by date descending                                 
[39;1m  Failed asserting that 116 matches expected 117.[39;22m

  at [32mtests\Unit\ProductPriceHistoryTest.php[39m:[32m84[39m
     80â–• 
     81â–•         // Fetch using 'latest' (which means order by date descending)
     82â–•         $latest = $this->product->priceHistory()->latest('recorded_at')->first();
     83â–• 
  âžœ  84â–•         $this->assertEquals($h2->id, $latest->id);
     85â–•     }
     86â–• }

  [33m1   [39m[39;1mtests\Unit\ProductPriceHistoryTest.php[39;22m:[39;1m84[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\OtpServiceTest[22m [90m>[39m resend otp respects cooldown period                                     [41;1m Error [49;22m  
[39;1m  Call to a member function diffInSeconds() on string[39;22m

  at [32mapp\Services\OtpService.php[39m:[32m25[39m
     21â–•             ->latest()
     22â–•             ->first();
     23â–• 
     24â–•         if ($existingOtp && $existingOtp->last_sent_at) {
  âžœ  25â–•             $diff = $existingOtp->last_sent_at->diffInSeconds(now());
     26â–•             if ($diff < 60) {
     27â–•                 // Cooldown active
     28â–•                 return null;
     29â–•             }

  [33m1   [39m[39;1mapp\Services\OtpService.php[39;22m:[39;1m25[39;22m
  [33m2   [39m[39;1mtests\Unit\OtpServiceTest.php[39;22m:[39;1m123[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\OtpServiceTest[22m [90m>[39m verify otp blocks after 3 attempts                                               
[39;1m  Failed asserting that 0 is true.[39;22m

  at [32mtests\Unit\OtpServiceTest.php[39m:[32m108[39m
    104â–•         $this->service->verify($this->user, 'email', '000000'); // Fail 1
    105â–•         $this->service->verify($this->user, 'email', '000000'); // Fail 2
    106â–•         $this->service->verify($this->user, 'email', '000000'); // Fail 3 (Blocks)
    107â–• 
  âžœ 108â–•         $this->assertTrue($otp->fresh()->blocked);
    109â–• 
    110â–•         $this->expectException(\Exception::class);
    111â–•         $this->expectExceptionMessage("Too many failed attempts");
    112â–•

  [33m1   [39m[39;1mtests\Unit\OtpServiceTest.php[39;22m:[39;1m108[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawEntryTest[22m [90m>[39m entry belongs to lucky draw                                         [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawEntryTest[22m [90m>[39m entry tracks bonus entries                                          [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawEntryTest[22m [90m>[39m entry belongs to user                                               [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawEntryTest[22m [90m>[39m entry tracks entries count                                          [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawEntryTest[22m [90m>[39m entry validates entries positive                                             
[39;1m  Failed asserting that exception of type "Error" matches expected exception "InvalidArgumentException". Message was: "Class "Database\Factories\LuckyDrawEntryFactory" not found" at
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php:871
C:\PreIPO\backend\vendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php:21
C:\PreIPO\backend\tests\Unit\LuckyDrawEntryTest.php:93
.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\LuckyDrawEntryTest[22m [90m>[39m entry calculates total entries                                      [41;1m Error [49;22m  
[39;1m  Class "Database\Factories\LuckyDrawEntryFactory" not found[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39m:[32m871[39m
    867â–•     public static function factoryForModel(string $modelName)
    868â–•     {
    869â–•         $factory = static::resolveFactoryName($modelName);
    870â–• 
  âžœ 871â–•         return $factory::new();
    872â–•     }
    873â–• 
    874â–•     /**
    875â–•      * Specify the callback that should be invoked to guess factory names based on dynamic relationship names.

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\Factory.php[39;22m:[39;1m871[39;22m
  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Eloquent\Factories\HasFactory.php[39;22m:[39;1m21[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReferralServiceTest[22m [90m>[39m referral multiplier uses configured tiers                      [41;1m TypeError [49;22m  
[39;1m  json_decode(): Argument #1 ($json) must be of type string, array given[39;22m

  at [32mapp\Services\ReferralService.php[39m:[32m54[39m
     50â–•         // --- MODULE 9 FIX: Robust JSON Parsing ---
     51â–•         $tiers = $defaultTiers;
     52â–•         
     53â–•         if ($config && !empty($config->value)) {
  âžœ  54â–•             $decoded = json_decode($config->value, true);
     55â–•             // Check if decode was successful AND is an array
     56â–•             if (json_last_error() === JSON_ERROR_NONE && is_array($decoded)) {
     57â–•                 $tiers = $decoded;
     58â–•             } else {

  [33m1   [39m[39;1mapp\Services\ReferralService.php[39;22m:[39;1m54[39;22m
  [33m2   [39m[39;1mtests\Unit\ReferralServiceTest.php[39;22m:[39;1m136[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\ReferralServiceTest[22m [90m>[39m referral multiplier varies by plan                             [41;1m TypeError [49;22m  
[39;1m  json_decode(): Argument #1 ($json) must be of type string, array given[39;22m

  at [32mapp\Services\ReferralService.php[39m:[32m54[39m
     50â–•         // --- MODULE 9 FIX: Robust JSON Parsing ---
     51â–•         $tiers = $defaultTiers;
     52â–•         
     53â–•         if ($config && !empty($config->value)) {
  âžœ  54â–•             $decoded = json_decode($config->value, true);
     55â–•             // Check if decode was successful AND is an array
     56â–•             if (json_last_error() === JSON_ERROR_NONE && is_array($decoded)) {
     57â–•                 $tiers = $decoded;
     58â–•             } else {

  [33m1   [39m[39;1mapp\Services\ReferralService.php[39;22m:[39;1m54[39;22m
  [33m2   [39m[39;1mtests\Unit\ReferralServiceTest.php[39;22m:[39;1m163[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\SupportServiceTest[22m [90m>[39m auto assign ticket to available agent                                        
[39;1m  Failed asserting that null matches expected 35355.[39;22m

  at [32mtests\Unit\SupportServiceTest.php[39m:[32m43[39m
     39â–•         // 2. Refresh from DB to see observer changes
     40â–•         $ticket->refresh();
     41â–• 
     42â–•         // 3. Check it was assigned to our admin
  âžœ  43â–•         $this->assertEquals($this->admin->id, $ticket->assigned_to);
     44â–•     }
     45â–• 
     46â–•     #[\PHPUnit\Framework\Attributes\Test]
     47â–•     public function test_escalate_ticket_after_sla_breach()

  [33m1   [39m[39;1mtests\Unit\SupportServiceTest.php[39;22m:[39;1m43[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\NotificationServiceTest[22m [90m>[39m send notification respects user preferences           [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'notification_type' doesn't have a default value (Connection: mysql, SQL: insert into `user_notification_preferences` (`user_id`, `updated_at`, `created_at`) values (35357, 2026-02-22 17:47:02, 2026-02-22 17:47:02))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'notification_type' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m withdraw decreases wallet balance                                             
[39;1m  Failed asserting that 997 matches expected 700.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m145[39m
    141â–•         $this->wallet->update(['balance_paise' => 100000]); // â‚¹1000
    142â–• 
    143â–•         $this->service->withdraw($this->user, 300, 'withdrawal', 'Test withdrawal');
    144â–• 
  âžœ 145â–•         $this->assertEquals(700.00, $this->wallet->fresh()->balance); // Virtual accessor
    146â–•     }
    147â–• 
    148â–•     #[\PHPUnit\Framework\Attributes\Test]
    149â–•     public function withdraw_creates_transaction_with_paise()

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m145[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m multiple operations maintain correct running balance                          
[39;1m  Failed asserting that 10 matches expected 1000.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m371[39m
    367â–•     {
    368â–•         // Deposit â‚¹1000 (100000 paise)
    369â–•         $t1 = $this->service->deposit($this->user, 1000, 'deposit', 'Initial');
    370â–•         $this->assertEquals(0, $t1->balance_before); // Virtual accessor (â‚¹)
  âžœ 371â–•         $this->assertEquals(1000, $t1->balance_after); // Virtual accessor (â‚¹)
    372â–•         $this->assertEquals(0, $t1->balance_before_paise); // Canonical paise
    373â–•         $this->assertEquals(100000, $t1->balance_after_paise); // Canonical paise
    374â–• 
    375â–•         // Withdraw â‚¹300 (30000 paise)

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m371[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m transaction records are immutable                                             
[39;1m  Failed asserting that a row in the table [transactions] matches the attributes {
    "id": 2940,
    "amount_paise": 10000
}.

Found similar results: [
    {
        "id": 2940,
        "amount_paise": 100
    }
].[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m329[39m
    325â–•     {
    326â–•         $transaction = $this->service->deposit($this->user, 100, 'deposit', 'Test');
    327â–• 
    328â–•         // Verify transaction exists with paise amount
  âžœ 329â–•         $this->assertDatabaseHas('transactions', [
    330â–•             'id' => $transaction->id,
    331â–•             'amount_paise' => 10000 // â‚¹100 = 10000 paise
    332â–•         ]);
    333â–•     }

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m unlock funds throws exception for insufficient locked balance                 
[39;1m  Failed asserting that exception of type "RuntimeException" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m handles exact balance withdrawal                                              
[39;1m  Failed asserting that 495 matches expected 0.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m361[39m
    357â–•         $this->wallet->update(['balance_paise' => 50000]); // â‚¹500
    358â–• 
    359â–•         $this->service->withdraw($this->user, 500, 'withdrawal', 'Full withdrawal');
    360â–• 
  âžœ 361â–•         $this->assertEquals(0.00, $this->wallet->fresh()->balance);
    362â–•         $this->assertEquals(0, $this->wallet->fresh()->balance_paise);
    363â–•     }
    364â–• 
    365â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m361[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m deposit stores reference when provided                      [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`bonus_transactions`, CONSTRAINT `bonus_transactions_subscription_id_foreign` FOREIGN KEY (`subscription_id`) REFERENCES `subscriptions` (`id`) ON DELETE CASCADE) (Connection: mysql, SQL: insert into `bonus_transactions` (`user_id`, `subscription_id`, `payment_id`, `type`, `amount`, `multiplier_applied`, `tds_deducted`, `updated_at`, `created_at`) values (35395, 1, 1, consistency, 50, 1, 0, 2026-02-22 17:47:06, 2026-02-22 17:47:06))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[23000]: Integrity constraint violation: 1452 Cannot add or update a child row: a foreign key constraint fails (`preipo_test`.`bonus_transactions`, CONSTRAINT `bonus_transactions_subscription_id_foreign` FOREIGN KEY (`subscription_id`) REFERENCES `subscriptions` (`id`) ON DELETE CASCADE)")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m withdraw creates transaction with paise                                       
[39;1m  Failed asserting that a row in the table [transactions] matches the attributes {
    "wallet_id": 37779,
    "type": "admin_adjustment",
    "amount_paise": 20000,
    "status": "completed"
}.

Found similar results: [
    {
        "wallet_id": 37779,
        "type": "admin_adjustment",
        "amount_paise": 200,
        "status": "completed"
    }
].[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m155[39m
    151â–•         $this->wallet->update(['balance_paise' => 50000]); // â‚¹500
    152â–• 
    153â–•         $this->service->withdraw($this->user, 200, 'admin_adjustment', 'Admin debit');
    154â–• 
  âžœ 155â–•         $this->assertDatabaseHas('transactions', [
    156â–•             'wallet_id' => $this->wallet->id,
    157â–•             'type' => 'admin_adjustment',
    158â–•             'amount_paise' => 20000, // â‚¹200 in paise
    159â–•             'status' => 'completed'

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m withdraw throws exception for insufficient funds                              
[39;1m  Failed asserting that exception of type "Exception" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m withdraw with lock moves funds to locked balance                              
[39;1m  Failed asserting that 997 matches expected 700.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m199[39m
    195â–•             true // lockBalance = true
    196â–•         );
    197â–• 
    198â–•         $wallet = $this->wallet->fresh();
  âžœ 199â–•         $this->assertEquals(700.00, $wallet->balance); // Virtual accessor
    200â–•         $this->assertEquals(300.00, $wallet->locked_balance); // Virtual accessor
    201â–•         $this->assertEquals('pending', $transaction->status);
    202â–•     }
    203â–•

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m199[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m withdraw without lock immediately debits                                      
[39;1m  Failed asserting that 997 matches expected 700.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m219[39m
    215â–•             false // lockBalance = false (immediate)
    216â–•         );
    217â–• 
    218â–•         $wallet = $this->wallet->fresh();
  âžœ 219â–•         $this->assertEquals(700.00, $wallet->balance); // Virtual accessor
    220â–•         $this->assertEquals(0.00, $wallet->locked_balance); // Virtual accessor
    221â–•         $this->assertEquals('completed', $transaction->status);
    222â–•     }
    223â–•

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m219[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m unlock funds decreases locked balance                                         
[39;1m  Failed asserting that 298 matches expected 100.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m246[39m
    242â–•         $this->service->unlockFunds($this->user, 200, 'Withdrawal cancelled');
    243â–• 
    244â–•         $wallet = $this->wallet->fresh();
    245â–•         $this->assertEquals(1000.00, $wallet->balance); // Balance unchanged
  âžœ 246â–•         $this->assertEquals(100.00, $wallet->locked_balance); // Locked decreased
    247â–•     }
    248â–• 
    249â–•     #[\PHPUnit\Framework\Attributes\Test]
    250â–•     public function unlock_funds_throws_exception_for_insufficient_locked_balance()

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m246[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m concurrent withdrawals respect balance limits                                 
[39;1m  Failed asserting that exception of type "Exception" is thrown.[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m concurrent deposits are handled safely                                        
[39;1m  Failed asserting that 5 matches expected 500.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m282[39m
    278â–•             $results[] = $this->service->deposit($this->user, 100, 'deposit', "Deposit $i");
    279â–•         }
    280â–• 
    281â–•         // All deposits should succeed and total should be â‚¹500 (50000 paise)
  âžœ 282â–•         $this->assertEquals(500.00, $this->wallet->fresh()->balance); // Virtual accessor
    283â–•         $this->assertEquals(50000, $this->wallet->fresh()->balance_paise); // Canonical paise
    284â–•         $this->assertCount(5, $results);
    285â–•     }
    286â–•

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m282[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m deposit records balance before and after                                      
[39;1m  Failed asserting that 1 matches expected 100.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m91[39m
     87â–• 
     88â–•         // Second deposit
     89â–•         $transaction = $this->service->deposit($this->user, 200, 'deposit', 'Second');
     90â–• 
  âžœ  91â–•         $this->assertEquals(100.00, $transaction->balance_before);
     92â–•         $this->assertEquals(300.00, $transaction->balance_after);
     93â–•     }
     94â–• 
     95â–•     #[\PHPUnit\Framework\Attributes\Test]

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m91[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\WalletServiceTest[22m [90m>[39m lock funds increases locked balance                                           
[39;1m  Failed asserting that 3 matches expected 300.0.[39;22m

  at [32mtests\Unit\WalletServiceTest.php[39m:[32m234[39m
    230â–•         $this->service->lockFunds($this->user, 300, 'Withdrawal pending');
    231â–• 
    232â–•         $wallet = $this->wallet->fresh();
    233â–•         $this->assertEquals(1000.00, $wallet->balance); // Balance unchanged
  âžœ 234â–•         $this->assertEquals(300.00, $wallet->locked_balance); // Locked increased
    235â–•     }
    236â–• 
    237â–•     #[\PHPUnit\Framework\Attributes\Test]
    238â–•     public function unlock_funds_decreases_locked_balance()

  [33m1   [39m[39;1mtests\Unit\WalletServiceTest.php[39;22m:[39;1m234[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase calculates extra allocation percentage         [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5282, 35413, 100000, 80000, 30, 2026-02-22 17:47:07, manual_entry, Test purchase for unit testing, test-document-ref-001, 130000, 20, 130000.00, 2026-02-22 17:47:07, 2026-02-22 17:47:07))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase calculates discount percentage                 [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5283, 35414, 100000, 80000, 25, 2026-02-22 17:47:07, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:07, 2026-02-22 17:47:07))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase calculates gross margin                        [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5285, 35416, 100000, 80000, 25, 2026-02-22 17:47:08, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:08, 2026-02-22 17:47:08))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase belongs to product                             [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5286, 35417, 100000, 80000, 25, 2026-02-22 17:47:08, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:08, 2026-02-22 17:47:08))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase tracks allocated amount                        [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5289, 35420, 100000, 80000, 25, 2026-02-22 17:47:08, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:08, 2026-02-22 17:47:08))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase calculates gross margin percentage             [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5290, 35421, 100000, 80000, 25, 2026-02-22 17:47:08, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:08, 2026-02-22 17:47:08))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase calculates available amount                    [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5292, 35423, 100000, 80000, 25, 2026-02-22 17:47:08, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:08, 2026-02-22 17:47:08))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m company listing with valid listing id succeeds               [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `company_share_listing_id`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5293, 35424, 100000, 80000, 25, 2026-02-22 17:47:09, company_listing, 1, 125000, 20, 125000.00, 2026-02-22 17:47:09, 2026-02-22 17:47:09))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m bulk purchase calculates total value received                [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5296, 35427, 100000, 80000, 25, 2026-02-22 17:47:09, manual_entry, Test purchase for unit testing, test-document-ref-001, 125000, 20, 125000.00, 2026-02-22 17:47:09, 2026-02-22 17:47:09))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BulkPurchaseTest[22m [90m>[39m manual entry with valid provenance succeeds                  [41;1m QueryException [49;22m  
[39;1m  SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value (Connection: mysql, SQL: insert into `bulk_purchases` (`product_id`, `admin_id`, `face_value_purchased`, `actual_cost_paid`, `extra_allocation_percentage`, `purchase_date`, `source_type`, `manual_entry_reason`, `source_documentation`, `total_value_received`, `discount_percentage`, `value_remaining`, `updated_at`, `created_at`) values (5298, 35429, 100000, 80000, 25, 2026-02-22 17:47:09, manual_entry, Bulk inventory acquisition from secondary market, invoice-2024-001.pdf, 125000, 20, 125000.00, 2026-02-22 17:47:09, 2026-02-22 17:47:09))[39;22m

  at [32mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39m:[32m825[39m
    821â–•                     $this->getName(), $query, $this->prepareBindings($bindings), $e
    822â–•                 );
    823â–•             }
    824â–• 
  âžœ 825â–•             throw new QueryException(
    826â–•                 $this->getName(), $query, $this->prepareBindings($bindings), $e
    827â–•             );
    828â–•         }
    829â–•     }

  [33m1   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\Connection.php[39;22m:[39;1m825[39;22m

  [33m2   [39m[39;1mvendor\laravel\framework\src\Illuminate\Database\MySqlConnection.php[39;22m:[39;1m53[39;22m
  [90m    NunoMaduro\Collision\Exceptions\TestException::("SQLSTATE[HY000]: General error: 1364 Field 'company_id' doesn't have a default value")[39m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorTest[22m [90m>[39m it multiplies bonuses based on referral tier            [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7290 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorTest.php[39;22m:[39;1m81[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorTest[22m [90m>[39m it does not award progressive bonus before start month  [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7291 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorTest.php[39;22m:[39;1m48[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorTest[22m [90m>[39m it awards milestone bonus only on exact month           [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7292 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorTest.php[39;22m:[39;1m101[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\BonusCalculatorTest[22m [90m>[39m it awards correct progressive bonus on month 4          [41;1m RuntimeException [49;22m  
[39;1m  Subscription #7293 does not have a valid bonus contract snapshot. Bonus calculation HALTED. This subscription requires remediation.[39;22m

  at [32mapp\Services\BonusCalculatorService.php[39m:[32m116[39m
    112â–• 
    113â–•         // V-CONTRACT-HARDENING-CORRECTIVE: Verify subscription has valid snapshot
    114â–•         if (!$subscription->hasValidSnapshot()) {
    115â–•             Log::error("Subscription {$subscription->id} missing or invalid config snapshot - HALTING bonus calculation");
  âžœ 116â–•             throw new \RuntimeException(
    117â–•                 "Subscription #{$subscription->id} does not have a valid bonus contract snapshot. " .
    118â–•                 "Bonus calculation HALTED. This subscription requires remediation."
    119â–•             );
    120â–•         }

  [33m1   [39m[39;1mapp\Services\BonusCalculatorService.php[39;22m:[39;1m116[39;22m
  [33m2   [39m[39;1mtests\Unit\BonusCalculatorTest.php[39;22m:[39;1m62[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AdminRoutesSecurityTest[22m [90m>[39m unauthorized access to admin routes fails                               
[39;1m  Failed asserting that an array contains 403.[39;22m

  at [32mtests\Unit\AdminRoutesSecurityTest.php[39m:[32m59[39m
     55â–•         foreach ($adminRoutes as $route) {
     56â–•             // 1. Test with no user (guest)
     57â–•             $response = $this->client->request('GET', $route);
     58â–•             // Expecting a 401 Unauthorized or a 302 Redirect to /login
  âžœ  59â–•             $this->assertContains($response->getStatusCode(), [401, 302]);
     60â–• 
     61â–•             // 2. Test with a regular user
     62â–•             $this->client->loginUser($this->regularUser);
     63â–•             $response = $this->client->request('GET', $route);

  [33m1   [39m[39;1mtests\Unit\AdminRoutesSecurityTest.php[39;22m:[39;1m59[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocate bonus and investment deducts from same poâ€¦ [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocation distribution respects limits             [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocation logs audit trail on failure              [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocate to user deducts from bulk purchase         [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocate to user creates investment record          [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocation logs audit trail on success              [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m

  [31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[39m  
  [41;1m FAILED [49;22m [1mTests\Unit\AllocationServiceTest[22m [90m>[39m allocate to user handles insufficient inventory     [41;1m ArgumentCountError [49;22m  
[39;1m  Too few arguments to function App\Services\AllocationService::__construct(), 0 passed in C:\PreIPO\backend\tests\Unit\AllocationServiceTest.php on line 27 and exactly 4 expected[39;22m

  at [32mapp\Services\AllocationService.php[39m:[32m38[39m
     34â–•     protected $walletService;
     35â–•     protected $conservationService;
     36â–•     protected $riskGuard;
     37â–• 
  âžœ  38â–•     public function __construct(
     39â–•         InventoryService $inventoryService,
     40â–•         WalletService $walletService,
     41â–•         InventoryConservationService $conservationService,
     42â–•         RiskGuardService $riskGuard

  [33m1   [39m[39;1mapp\Services\AllocationService.php[39;22m:[39;1m38[39;22m
  [33m2   [39m[39;1mtests\Unit\AllocationServiceTest.php[39;22m:[39;1m27[39;22m


  [90mTests:[39m    [33;1m2 deprecated[39;22m[90m,[39m[39m [39m[31;1m414 failed[39;22m[90m,[39m[39m [39m[33;1m4 risky[39;22m[90m,[39m[39m [39m[33;1m5 skipped[39;22m[90m,[39m[39m [39m[32;1m482 passed[39;22m[90m (1491 assertions)[39m
  [90mDuration:[39m [39m373.85s[39m
  [90mRandom Order Seed:[39m [39m1771782060[39m

